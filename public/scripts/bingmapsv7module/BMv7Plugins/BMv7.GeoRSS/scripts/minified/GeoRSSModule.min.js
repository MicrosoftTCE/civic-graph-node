Microsoft.Maps.Pushpin.prototype.Metadata=null;Microsoft.Maps.Polyline.prototype.Metadata=null;Microsoft.Maps.Polygon.prototype.Metadata=null;var GeoRSSModule=function(){var j=[],k=null,g={pushpinOptions:null,polylineOptions:null,polygonOptions:null};function b(m){var l=new Microsoft.Maps.EntityCollection();$(m).find("item").each(function(){var o=e($(this));if(o!=null){l.push(o)}});$(m).find("entry").each(function(){var o=e($(this));if(o!=null){l.push(o)}});var n;if(j!=null&&j.length>0){n=Microsoft.Maps.LocationRect.fromLocations(j)}else{n=new Microsoft.Maps.LocationRect(new Microsoft.Maps.Location(0,0),360,180)}if(k!=null){k(l,n)}}function e(m){var r=null;var q,s,p,o,t=false;var n=null;m.children().each(function(){var w=this.tagName.toLowerCase();switch(w){case"title":q=$(this).text();break;case"content":case"summary":case"description":s=$(this).text();break;case"icon":case"mappoint:icon":p=$(this).text();break;case"link":o=$(this).text();break;case"geo:lat":var A=parseFloat($(this).text());if(r==null){r=A}else{r=new Microsoft.Maps.Location(A,r);j.push(r);n=new Microsoft.Maps.Pushpin(r);t=true}break;case"geo:lon":case"geo:long":var A=parseFloat($(this).text());if(r==null){r=A}else{r=new Microsoft.Maps.Location(r,A);j.push(r);n=new Microsoft.Maps.Pushpin(r);t=true}break;case"geo:point":var y,z;m.children().each(function(){if(this.tagName.toLowerCase()=="geo:lat"){y=parseFloat($(this).text())}else{if(this.tagName.toLowerCase()=="geo:long"){z=parseFloat($(this).text())}}});if(y!=null&&z!=null){r=new Microsoft.Maps.Location(y,z);j.push(r);n=new Microsoft.Maps.Pushpin(r);t=true}break;case"georss:point":r=a($(this).text());if(r!=null){j.push(r);n=new Microsoft.Maps.Pushpin(r);t=true}break;case"georss:line":r=f($(this).text(),2);if(r!=null&&r.length>=2){j=j.concat(r);n=new Microsoft.Maps.Polyline(r,g.polylineOptions)}break;case"georss:polygon":r=f($(this).text(),2);if(r!=null&&r.length>=3){j=j.concat(r);n=new Microsoft.Maps.Polygon(r,g.polygonOptions)}break;case"georss:where":var u=i(this.firstChild);n=u.shape;t=u.isPushpin;break;case"georss:circle":var x=$.trim($(this).text().replace(/,/g," ").replace(/[\s]{2,}/g," ")).split(" ");if(x.length>2){r=d.GenerateRegularPolygon(new Microsoft.Maps.Location(parseFloat(x[0]),parseFloat(x[1])),parseFloat(x[2]),d.Constants.EARTH_RADIUS_METERS,25,0);j=j.concat(r);n=new Microsoft.Maps.Polygon(r,g.polygonOptions)}break;default:if(w.match("^gml:")=="gml:"){var u=i(this);n=u.shape;t=u.isPushpin}break}});if(n!=null){n.Metadata={title:q,description:s,icon:p,link:o};var l=null;if(t){l=g.pushpinOptions;if(p!=null&&p!=""){if(l!=null){l.icon=p}else{l={icon:p}}}}if(l!=null){n.setOptions(l)}}return n}function i(o){var p=null,n=false;if(o!=null&&o.tagName==null){if(o.nextSibling.tagName!=null){o=o.nextSibling}else{o==null}}if(o!=null){switch(o.tagName.toLowerCase()){case"gml:point":var r=null;$(o).children().each(function(){if(this.tagName.toLowerCase()=="gml:pos"||this.tagName.toLowerCase()=="gml:coordinates"){r=a($(this).text())}});if(r!=null){j.push(r);p=new Microsoft.Maps.Pushpin(r);n=true}break;case"gml:linestring":var l=[];$(o).children().each(function(){var s=c(this);if(s!=null&&s.length>=2){l.push(s)}});if(l.length>0){j=j.concat(l[0]);p=new Microsoft.Maps.Polyline(l[0],g.polylineOptions)}break;case"gml:polygon":var q=[],m=[];$(o).children().each(function(){switch(this.tagName.toLowerCase()){case"gml:exterior":case"gml:outerboundaryis":var s=h(this);if(s!=null&&s.length>=3){q=s}break;case"gml:interior":case"gml:innerboundaryis":var s=h(this);if(s!=null&&s.length>=3){m.push(s)}break}});if(q.length>0){j=j.concat(q);p=new Microsoft.Maps.Polygon([q].concat(m),g.polygonOptions)}break;break;default:break}}return{shape:p,isPushpin:n}}function h(l){var m=null;$(l).children().each(function(){if(this.tagName.toLowerCase()=="gml:linearring"){$(this).children().each(function(){var n=c(this);if(n!=null&&n.length>=3){m=n}})}});return m}function c(l){if(l.tagName.toLowerCase()=="gml:poslist"||l.tagName.toLowerCase()=="gml:coordinates"){var m=$(l).attr("dimension");if(m!=null&&m!=""){m=parseInt(m);if(m==null||m<1){m=2}}else{m=2}return f($(l).text(),m)}return null}function f(m,o){if(o==null||o<1){o=2}var l=$.trim(m.replace(/,/g," ").replace(/[\s]{2,}/g," ")).split(" ");if(l.length>1){var p=[];for(var n=0;n<l.length;n=n+o){p.push(new Microsoft.Maps.Location(parseFloat(l[n]),parseFloat(l[n+1])))}return p}return null}function a(m){var l=$.trim(m.replace(/,/g," ").replace(/[\s]{2,}/g," ")).split(" ");if(l.length>1){return new Microsoft.Maps.Location(parseFloat(l[0]),parseFloat(l[1]))}return null}var d=new function(){function l(n){return n*Math.PI/180}function m(n){return n*180/Math.PI}this.Constants={EARTH_RADIUS_METERS:6378100,EARTH_RADIUS_KM:6378.1,EARTH_RADIUS_MILES:3963.1676,EARTH_RADIUS_FEET:20925524.9};this.CalculateCoord=function(t,q,o,v){var p=l(t.latitude),s=l(t.longitude),u=o/v;var n=Math.asin(Math.sin(p)*Math.cos(u)+Math.cos(p)*Math.sin(u)*Math.cos(l(q)));var r=s+Math.atan2(Math.sin(l(q))*Math.sin(u)*Math.cos(p),Math.cos(u)-Math.sin(p)*Math.sin(n));return new Microsoft.Maps.Location(m(n),m(r))};this.GenerateRegularPolygon=function(u,n,o,s,t){var r=[],p=360/s;for(var q=0;q<=s;q++){r.push(d.CalculateCoord(u,(q*p+t)%360,n,o))}return r};this.HaversineDistance=function(t,s,x){var p=l(t.latitude),r=l(t.longitude),o=l(s.latitude),q=l(s.longitude);var u=o-p,n=q-r,v=Math.pow(Math.sin(u/2),2)+Math.cos(p)*Math.cos(o)*Math.pow(Math.sin(n/2),2),w=2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v));return x*w}};this.ImportGeoRSS=function(m,n,l){k=n;if(l!=null){for(attrname in l){g[attrname]=l[attrname]}}$.ajax({type:"GET",url:m,dataType:"xml",success:function(o){b(o)},error:function(q,o,p){alert(p.description)}})}};(function(){var a=new Microsoft.Maps.Polygon();if(!a.getRings){Microsoft.Maps.loadModule("Microsoft.Maps.AdvancedShapes",{callback:function(){Microsoft.Maps.moduleLoaded("GeoRSSModule")}})}else{Microsoft.Maps.moduleLoaded("GeoRSSModule")}})();