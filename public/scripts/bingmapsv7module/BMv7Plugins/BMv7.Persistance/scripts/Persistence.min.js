var Persistence=function(b,k,i,q,d){var o=this;var g=b;var n=k?true:false;var h=i;var j=q;var f=(n&&d)?true:false;var a="MapPersistence=";var p="";function m(){if(!l()&&!f){var r=document.cookie.split(";");for(var s=0;s<r.length;s++){var t=r[s];while(t.charAt(0)==" "){t=t.substring(1,t.length)}if(t.indexOf(a)==0){document.location.hash=decodeURI(t.substring(a.length,t.length));s=r.length}}l()}Microsoft.Maps.Events.addThrottledHandler(g,"viewchangeend",e,300);Microsoft.Maps.Events.addHandler(g,"imagerychanged",e);setInterval(function(){o.TimerTick()},300);if(n){window.onbeforeunload=function(u){c()}}delete m}function e(){var t=b.getCenter();var v=b.getHeading();var s=t.latitude.toFixed(5)+","+t.longitude.toFixed(5);if(v&&v!=0){s=s+","+v.toFixed(0)}s=s+"/"+b.getZoom().toFixed(2)+"/"+b.getImageryId();var u=true;var r=b.getOptions();if(r&&r.labelOverlay&&r.labelOverlay==1){u=false}if(u){s=s+"Labels"}if(j){s=s+"/"+j}if(p!=s){p=s;document.location.hash=p}}function l(){var x=document.location.hash;if(x&&p!=x.substring(1)){p=x.substring(1);var y=x.substring(1).split("/");if(y.length>2){try{var t=y[0].split(",");var w=parseFloat(t[0]);var r=parseFloat(t[1]);var B=0;if(t.length>2){B=parseInt(t[2])}var A=parseFloat(y[1]);var u=Microsoft.Maps.MapTypeId.auto;var s=y[2].toLowerCase();var z=Microsoft.Maps.LabelOverlay.hidden;if(s.search("labels")>=0){z=Microsoft.Maps.LabelOverlay.visible;s=s.replace("labels","")}switch(s){case"automatic":u=Microsoft.Maps.MapTypeId.auto;break;case"road":u=Microsoft.Maps.MapTypeId.road;break;case"aerial":u=Microsoft.Maps.MapTypeId.aerial;break;case"birdseye":case"enhancedbirdseye":case"nativebirdseye":u=Microsoft.Maps.MapTypeId.birdseye;break}b.setView({zoom:A,center:new Microsoft.Maps.Location(w,r),mapTypeId:u,heading:B,animate:false,labelOverlay:z});if(y.length>3){j=x.substring(4+y[0].length+y[1].length+y[2].length);if(h){h(j)}}return true}catch(v){}}}return false}function c(){var s=new Date();s.setTime(s.getTime()+(7*24*60*60*1000));var r="; expires="+s.toGMTString();document.cookie=a+encodeURI(p)+r+"; path=/"}this.SetUserParameter=function(r){j=r;e()};this.TimerTick=function(){l()};m()};Microsoft.Maps.moduleLoaded("PersistenceModule");