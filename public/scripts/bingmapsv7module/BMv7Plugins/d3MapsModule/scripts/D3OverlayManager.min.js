var D3OverlayManager=function(e){function t(){n=e.getRootElement(),n.childNodes.length>=3&&n.childNodes[2].childNodes.length>=2?(r=document.createElement("div"),r.style.position="absolute",r.style.top="0px",r.style.left="0px",n.childNodes[2].childNodes[1].appendChild(r),l=e.getCenter(),s=e.getZoom(),i=e.getWidth(),a=e.getHeight(),d=d3.geo.path().projection(o),Microsoft.Maps.Events.addHandler(e,"viewchange",function(){var t=e.getZoom();if(t!=s)r.style.display="none";else{r.style.display="";var o=e.tryLocationToPixel(l,Microsoft.Maps.PixelReference.viewport);r.style.top=o.y+"px",r.style.left=o.x+"px"}}),Microsoft.Maps.Events.addHandler(e,"viewchangeend",function(){r.style.display="",r.style.top="0px",r.style.left="0px",c=256*Math.pow(2,e.getZoom()),v={x:0,y:0},(a!=e.getHeight()||i!=e.getWidth())&&(i=e.getWidth(),a=e.getHeight());for(var t=0;t<g.length;t++)g[t].svg&&(g[t].svg.attr("width",i),g[t].svg.attr("height",a),g[t].svg[0][0].style.left=-i/2+"px",g[t].svg[0][0].style.top=-a/2+"px",g[t].svg.selectAll("path").attr("d",d));l=e.getCenter(),s=e.getZoom()})):setTimeout(t,100)}function o(t){var o=new Microsoft.Maps.Location(t[1],t[0]),l=e.tryLocationToPixel(o,Microsoft.Maps.PixelReference.control);if(null!=v){var s=l.x-v;Math.abs(s)>.9*c&&(s>0?l.x-=c:l.x+=c)}return v=l.x,[l.x,l.y]}var l,s,i,a,n,r,d=null,g=[],p=0,c=512,v=null;this.addLayer=function(e){function t(){r?(o.svg=d3.select(r).append("svg").attr("width",i).attr("height",a),o.svg[0][0].style.position="relative",o.svg[0][0].style.left=-i/2+"px",o.svg[0][0].style.top=-a/2+"px",e&&e.loaded&&e.loaded(o.svg,d)):setTimeout(t,100)}var o=(p++,{id:p,options:e});return t(),g.push(o),o},this.removeLayer=function(e){for(var t=0;t<g.length;t++)if(g[t].id==e.id){r.removeChild(e.svg),_layer.splice(t,1);break}},t()};Microsoft.Maps.moduleLoaded("D3OverlayModule");