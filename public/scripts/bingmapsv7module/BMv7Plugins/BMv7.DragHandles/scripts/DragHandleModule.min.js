function dragHandleModule(n,t){function p(){var o,t;if(f.toString()!="[Polyline]"&&f.toString()!="[Polygon]")throw"Module can only be used for shapes that are polylines or polygons";u=f.getLocations(),e=new Microsoft.Maps.EntityCollection;switch(f.toString()){case"[Polyline]":s=new Microsoft.Maps.Polyline(u,{strokeColor:r.shapeMaskStrokeColor,strokeThickness:r.shapeMaskStrokeThickness,strokeDashArray:r.shapeMaskStrokeDashArray});break;case"[Polygon]":s=new Microsoft.Maps.Polygon(u,{fillColor:r.shapeMaskFillColor,strokeColor:r.shapeMaskStrokeColor,strokeThickness:r.shapeMaskStrokeThickness,strokeDashArray:r.shapeMaskStrokeDashArray})}for(o=1,f.toString()=="[Polygon]"&&(o=2),i=0;i<=u.length-o;i++)t=new Microsoft.Maps.Pushpin(u[i],{draggable:!0,icon:r.DragHandleImage,height:r.DragHandleImageHeight,width:r.DragHandleImageWidth,anchor:r.DragHandleImageAnchor,typeName:"DHM_DragHandle"}),Microsoft.Maps.Events.addHandler(t,"dragstart",c),Microsoft.Maps.Events.addHandler(t,"drag",a),Microsoft.Maps.Events.addHandler(t,"dragend",v),Microsoft.Maps.Events.addHandler(t,"mouseover",w),Microsoft.Maps.Events.addHandler(t,"mouseout",l),e.push(t);e.push(s),n.entities.push(e)}function w(n){n.target.setOptions({icon:r.DragHandleImageActive})}function l(n){n.target.setOptions({icon:r.DragHandleImage})}function c(n){var t=n.entity.getLocation();for(n.entity.setOptions({icon:r.DragHandleImageActive}),i=0;i<=u.length-1;i++)if(t==u[i]){h=i;break}}function a(n){var t=n.entity.getLocation();u[h]=t,h==0&&f.toString()=="[Polygon]"&&(u[u.length-1]=t),s.setLocations(u)}function v(n){n.entity.setOptions({icon:r.DragHandleImage}),f.setLocations(u)}var b=n,f,h,u,s,e,y="1.1",r={DragHandleImage:"http://www.garzilla.net/vemaps/images/DragHandleWhite.gif",DragHandleImageActive:"http://www.garzilla.net/vemaps/images/DragHandleGreen.gif",DragHandleImageHeight:10,DragHandleImageWidth:10,DragHandleImageAnchor:new Microsoft.Maps.Point(5,5),shapeMaskStrokeColor:new Microsoft.Maps.Color(200,100,100,100),shapeMaskFillColor:new Microsoft.Maps.Color(0,0,0,0),shapeMaskStrokeThickness:2,shapeMaskStrokeDashArray:"2 2"},o;if(t)for(optionName in t)r[optionName]=t[optionName];o=new Image,o.src=r.DragHandleImage,o=new Image,o.src=r.DragHandleImageActive,o=null,this.dispose=function(){n.entities.remove(e),f=null},this.version=function(){return y},this.edit=function(n){f=n,p()}}Microsoft.Maps.moduleLoaded("DragHandles")