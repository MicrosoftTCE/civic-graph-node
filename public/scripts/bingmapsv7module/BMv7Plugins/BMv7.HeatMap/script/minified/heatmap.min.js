var HeatMapLayer=function(e,t,a){function n(){var e=p.getRootElement();if(e.childNodes.length>=3&&e.childNodes[2].childNodes.length>=2){c=document.createElement("canvas"),c.style.position="relative";var l=document.createElement("div");l.style.position="absolute",l.style.left="0px",l.style.top="0px",l.appendChild(c),e.childNodes[2].childNodes[1].appendChild(l),r(a),d(t),u=o(v.colourgradient),h=Microsoft.Maps.Events.addHandler(p,"viewchangestart",i),g=Microsoft.Maps.Events.addHandler(p,"viewchangeend",s),s(),delete n}else setTimeout(n,100)}function i(){var e=c.getContext("2d");e.clearRect(0,0,c.width,c.height)}function o(e){var t=document.createElement("canvas").getContext("2d"),a=t.createLinearGradient(0,0,256,0);for(var n in e)a.addColorStop(n,e[n]);return t.fillStyle=a,t.fillRect(0,0,256,1),t.getImageData(0,0,256,1).data}function l(){for(var e=c.getContext("2d"),t=e.getImageData(0,0,c.width,c.height),a=t.data,n=0,i=a.length;i>n;){var o=4*a[n+3];0!=o&&(a[n]=u[o],a[n+1]=u[o+1],a[n+2]=u[o+2]),n+=4}e.putImageData(t,0,0)}function r(e){for(attrname in e)v[attrname]=e[attrname],"colourgradient"==attrname&&(u=o(v.colourgradient))}function d(e){f=e}function s(){c.height=p.getHeight(),c.width=p.getWidth(),c.style.top=-c.height/2+"px",c.style.left=-c.width/2+"px",radiusInPixel="pixels"==v.unit?v.radius:v.radius/p.getMetersPerPixel();for(var e=c.getContext("2d"),t=p.tryLocationToPixel(f,Microsoft.Maps.PixelReference.control),a="rgba(0, 0, 0, "+v.intensity+")",n=256*Math.pow(2,p.getZoom()),i=0,o=t.length;o>i;i++){var r=t[i].x,d=t[i].y;0>r&&(r+=n*Math.ceil(Math.abs(r/n)));var s=e.createRadialGradient(r,d,0,r,d,radiusInPixel);s.addColorStop(0,a),s.addColorStop(1,"transparent"),e.fillStyle=s,e.fillRect(r-radiusInPixel,d-radiusInPixel,2*radiusInPixel,2*radiusInPixel)}l(),v.callback&&v.callback()}var c,u,h,g,p=e,f=[],v={intensity:.5,radius:1e3,unit:"meters",colourgradient:{"0.00":"rgba(255,0,255,20)",.25:"rgba(0,0,255,40)","0.50":"rgba(0,255,0,80)",.75:"rgba(255,255,0,120)","1.00":"rgba(255,0,0,150)"},callback:null};this.Show=function(){c&&(c.style.display="")},this.Hide=function(){c&&(c.style.display="none")},this.SetOptions=function(e,t){r(e),t&&(i(),s())},this.SetPoints=function(e){i(),d(e),s()},this.Remove=function(){c.parentNode.parentNode.removeChild(c.parentNode),h&&Microsoft.Maps.Events.removeHandler(h),g&&Microsoft.Maps.Events.removeHandler(g),f=null,u=null,c=null,v=null,h=null,g=null},n()};Microsoft.Maps.moduleLoaded("HeatMapModule");