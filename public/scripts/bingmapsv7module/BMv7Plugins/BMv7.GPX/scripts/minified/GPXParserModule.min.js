Microsoft.Maps.Pushpin.prototype.Metadata=null;Microsoft.Maps.Polyline.prototype.Metadata=null;Microsoft.Maps.Polygon.prototype.Metadata=null;Microsoft.Maps.EntityCollection.prototype.Metadata=null;var GPXParser=function(){var e={pushpinOptions:{},routeOptions:{strokeColor:new Microsoft.Maps.Color(200,255,165,0),strokeThickness:5},trackOptions:{strokeColor:new Microsoft.Maps.Color(200,255,165,0),strokeThickness:5}};function l(u,t){var q={};for(var s in u){try{if(u[s].constructor==Object){q[s]=l(q[s],u[s])}else{q[s]=u[s]}}catch(r){q[s]=u[s]}}for(var s in t){try{if(t[s].constructor==Object){q[s]=l(q[s],t[s])}else{q[s]=t[s]}}catch(r){q[s]=t[s]}}return q}function o(w,x){var y=new Microsoft.Maps.EntityCollection();var q=w.getElementsByTagName("metadata"),t,s,v,r,u;if(q.length==0){q=w.getElementsByTagName("gpx")}if(q!=null&&q.length>0){y.Metadata=b(q[0]);if(y.Metadata.bounds!=null&&y.Metadata.bounds!=undefined){y.Metadata.LocationRect=new Microsoft.Maps.LocationRect.fromEdges(y.Metadata.bounds.maxlat,y.Metadata.bounds.minlon,y.Metadata.bounds.minlat,y.Metadata.bounds.maxlon)}}q=w.getElementsByTagName("trk");r=q.length;for(t=0;t<r;t++){v=m(q[t],x);for(s=0;s<v.length;s++){y.push(v[s])}}q=w.getElementsByTagName("rte");r=q.length;for(t=0;t<r;t++){v=g(q[t],x);if(v!=null){y.push(v)}}q=w.getElementsByTagName("wpt");r=q.length;for(t=0;t<r;t++){u=f(q[t]);if(u!=null){v=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(u.lat,u.lon),x.pushpinOptions);v.Metadata=u;y.push(v)}}return y}function g(x,t){var q={waypoints:[]},w=[];if(x!=null){var v,r;for(var u=0;u<x.attributes.length;u++){v=x.attributes[u].nodeName;switch(v){case"number":q.number=j(x.attributes[u]);break;default:break}}for(var u=0;u<x.childNodes.length;u++){v=x.childNodes[u].nodeName;switch(v){case"name":case"cmt":case"desc":case"src":case"type":case"number":q[v]=j(x.childNodes[u]);break;case"link":if(q.link==null||q.link==undefined){q.link=[]}q.link.push(i(x.childNodes[u]));break;case"rtept":r=f(x.childNodes[u]);q.waypoints.push(r);w.push(new Microsoft.Maps.Location(r.lat,r.lon));break;break;default:break}}}if(w.length>=2){var s=new Microsoft.Maps.Polyline(w,t.routeOptions);s.Metadata=q;return s}return null}function m(x,t){var q={},s=[];if(x!=null){var v;for(var u=0;u<x.attributes.length;u++){v=x.attributes[u].nodeName;switch(v){case"number":q.number=j(x.attributes[u]);break;default:break}}for(var u=0;u<x.childNodes.length;u++){v=x.childNodes[u].nodeName;switch(v){case"name":case"cmt":case"desc":case"src":case"type":case"number":q[v]=j(x.childNodes[u]);break;case"link":if(q.link==null||q.link==undefined){q.link=[]}q.link.push(i(x.childNodes[u]));break;case"trkseg":s.push(k(x.childNodes[u]));break;default:break}}}if(s.length>=1){var w=[],r;for(var u=0;u<s.length;u++){r=new Microsoft.Maps.Polyline(s[u].points,t.trackOptions);r.Metadata=q;r.Metadata.waypoints=s[u].waypoints;w.push(r)}return w}return[]}function k(u){var t={points:[],waypoints:[]};if(u!=null){var s,q;for(var r=0;r<u.childNodes.length;r++){s=u.childNodes[r].nodeName;switch(s){case"trkpt":q=f(u.childNodes[r]);t.waypoints.push(q);t.points.push(new Microsoft.Maps.Location(q.lat,q.lon));break;default:break}}}return t}function f(t){var q={};if(t!=null){var s;for(var r=0;r<t.attributes.length;r++){s=t.attributes[r].nodeName;switch(s){case"lat":case"lon":q[s]=p(j(t.attributes[r]),6);break;case"eleSpecified":case"timeSpecified":case"magvarSpecified":case"geoidheightSpecified":case"fixSpecified":case"magvarSpecified":case"hdopSpecified":case"vdopSpecified":case"pdopSpecified":case"ageofdgpsdataSpecified":case"magvarSpecified":q[s]=a(j(t.attributes[r]));break;case"sat":case"dgpsid":q[s]=j(t.attributes[r]);break;default:break}}for(var r=0;r<t.childNodes.length;r++){s=t.childNodes[r].nodeName;switch(s){case"ele":case"magvar":case"geoidheight":case"hdop":case"vdop":case"pdop":case"ageofdgpsdata":q[s]=p(j(t.childNodes[r]));break;case"name":case"cmt":case"desc":case"src":case"sym":case"time":case"type":q[s]=j(t.childNodes[r]);break;case"link":if(q.link==null||q.link==undefined){q.link=[]}q.link.push(i(t.childNodes[r]));break;default:break}}}return q}function b(t){var s={};if(t!=null){var r;for(var q=0;q<t.childNodes.length;q++){r=t.childNodes[q].nodeName;switch(r){case"name":case"desc":case"time":case"keywords":s[r]=j(t.childNodes[q]);break;case"author":s.author=h(t.childNodes[q]);break;case"copyright":s.copyright=n(t.childNodes[q]);break;case"link":if(s.link==null||s.link==undefined){s.link=[]}s.link.push(i(t.childNodes[q]));break;case"bounds":s.bounds=c(t.childNodes[q]);break;default:break}}}return s}function h(t){var q={};if(t!=null){var s;for(var r=0;r<t.childNodes.length;r++){s=t.childNodes[r].nodeName;switch(s){case"name":q.name=j(t.childNodes[r]);break;case"email":q.email=d(t.childNodes[r]);break;case"link":q.link=i(t.childNodes[r]);break;default:break}}}return q}function d(s){var t={};if(s!=null){var r;for(var q=0;q<s.attributes.length;q++){r=s.attributes[q].nodeName;switch(r){case"id":case"domain":t[r]=j(s.attributes[q]);break;default:break}}}return t}function n(t){var s={};if(t!=null){var r;for(var q=0;q<t.attributes.length;q++){r=t.attributes[q].nodeName;switch(r){case"author":s.author=j(t.attributes[q]);break;default:break}}for(var q=0;q<t.childNodes.length;q++){r=t.childNodes[q].nodeName;switch(r){case"year":case"license":s[r]=j(t.childNodes[q]);break;default:break}}}return s}function i(t){var s={};if(t!=null){var r;for(var q=0;q<t.attributes.length;q++){r=t.attributes[q].nodeName;switch(r){case"href":s.href=j(t.attributes[q]);break;default:break}}for(var q=0;q<t.childNodes.length;q++){r=t.childNodes[q].nodeName;switch(r){case"text":case"type":s[r]=j(t.childNodes[q]);break;default:break}}}return s}function c(t){var q={};if(t!=null){var s;for(var r=0;r<t.attributes.length;r++){s=t.attributes[r].nodeName;switch(s){case"minlat":case"minlon":case"maxlat":case"maxlon":q[s]=p(j(t.attributes[r]),6);break;default:break}}}return q}function p(q,t){if(q!=null&&q!=undefined){try{if(t!=null){var s=Math.pow(10,t);return Math.round(parseFloat(q)*s)/s}else{return parseFloat(q)}}catch(r){}}return 0}function a(q){try{switch(q.toLowerCase()){case"true":case"yes":case"1":return true;case"false":case"no":case"0":case null:return false;default:return Boolean(q)}}catch(r){}return false}function j(q){if(q.text){return q.text}else{if(q.textContent){return q.textContent}else{if(q.value){return q.value}else{if(q.nodeValue){return q.nodeValue}}}}return q}this.Parse=function(s,u,r){r=l(e,r);var q;if(window.XMLHttpRequest){q=new XMLHttpRequest()}else{if(window.ActiveXObject){try{q=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{q=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){throw (t)}}}}q.open("GET",s,false);q.onreadystatechange=function(){if(q.readyState==4){var v=q.responseXML;u(o(v,r))}};q.send()}};Microsoft.Maps.moduleLoaded("GPXParserModule");