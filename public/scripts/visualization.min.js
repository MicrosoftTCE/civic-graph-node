!function(){function a(){for(var a={},b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("undefined"==typeof a[e[0]])a[e[0]]=e[1];else if("string"==typeof a[e[0]]){var f=[a[e[0]],e[1]];a[e[0]]=f}else a[e[0]].push(e[1])}return a}function b(){function a(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=parseFloat(c.attr("dy")),i=d3.select(this)[0][0].__data__,j=c.text(null).append("tspan").attr("x",0).attr("y",function(){return null!==i.employees?J(i.employees)+10:17}).attr("dy",h+"em");a=d.pop();)e.push(a),j.text(e.join(" ")),j.node().getComputedTextLength()>b&&(e.pop(),j.text(e.join(" ")),e=[a],f++,j=c.append("tspan").attr("x",0).attr("y",function(){return null!==i.employees?J(i.employees)+5:12}).attr("dy",f*g+h+"em").text(a))})}function b(a){return"translate("+a.x+","+a.y+")"}function c(a,b){return"translate("+a+","+b+")"}function d(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var e,f,g,h,i,j,k,l,m,n,o,p=1e3,q=1e3,r={},t={},u={},v={},w=1,y={},z={},A={},B=[],C=[],D=[],E=d3.select(".content").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("id","network").attr("height",q).attr("width",p).style("top","-50px").style("position","relative");d3.select("body > nav > nav > div").append("div").attr("id","editBox").append("p").text("Edit").style("color","#2e92cf");var F=p/q,G=$("#network"),H=G.parent();$(window).on("resize",function(){var a=H.width();G.attr("width",a),G.attr("height",Math.round(a/F))}).trigger("resize");var I="0 0 "+p+" "+q;E.attr("viewBox",I).attr("preserveAspectRatio","xMidYMid");var J=d3.scale.sqrt().domain([10,13e4]).range([10,50]),K=d3.scale.sqrt().domain([10,1e6]).range([10,50]);d3.json("/athena",function(x,F){function G(a){d3.select(this).classed("fixed",function(a){a.fixed=!1}),d3.select(this).on("mousedown.drag",null);{var b=(d3.select(this).data()[0],parseInt(E.style("width").substring(0,(E.style("width").length+1)/2))),c=parseInt(E.style("height").substring(0,(E.style("height").length+1)/2));parseInt(b/2),parseInt(c/2)}multiplierX=b/p,multiplierY=c/q,scaledDX=multiplierX*a.x,scaledDY=multiplierY*a.y,y=jQuery.extend(!0,{},a),y.x=p/2-10,y.y=q/2-60;d3.layout.force().nodes(ub).size([p,q]).links(zb).linkStrength(0).charge(function(a){return 1===a.render?null!==a.employees?-6*J(a.employees):-25:0}).linkDistance(50).on("tick",tb).start()}function H(a){s=M(a),webform=L(a),d3.select("#edit").html(webform),d3.select("#info").html(s).style("list-style","square"),d3.selectAll("#editCurrentInfo").on("click",function(){I(a)}).on("mouseover",function(){return d3.select(this).style("cursor","pointer"),d3.select("#editBox").style("visibility","visible")}).on("mousemove",function(){return d3.select("#editBox").style("top",d3.event.pageY+4+"px").style("left",d3.event.pageX+16+"px")}).on("mouseout",function(){return d3.select("#editBox").style("visibility","hidden")})}function I(a){N(),ib(a)}function L(){var a="";return a+='<h1 id="edit-add-info"><i class="icon-plus on-left"></i>Add Information</h1>'}function M(a){var b="";if(b+='<div style="height:30px"><a style="float:right;"><i id="editCurrentInfo" class="icon-pencil on-left"></i></a></div>',b+='<h1><a href="'+a.url+'" target="_blank">'+a.name+"</a></h1>",b+="<h6>Type of Entity: </h6> <h5>"+a.type+"</h5>",null!==a.location){b+="<br/><h6> Location:  </h6>";var c=[];if(-1!==a.location.indexOf("; ")){b+="<br/> <h5><ul>",c=a.location.split("; ");for(var e=0;e<c.length;e++)b+='<li style="display:block;"><h5><a class="click-location" style="cursor:pointer;">'+c[e]+"</h5></a></li>"}else b+="<h5><ul>",b+='<li style="display:inline-block;"><h5><a class="click-location" style="cursor:pointer;">'+a.location+"</h5></a></li>";b+="</h5></ul><br/>"}else b+="<br/><h6> Location:  </h6> <h5>N/A</h5><br/>";if("Individual"!==a.type&&(b+=null!==a.employees?"<h6>Employees: </h6> <h5>"+d(a.employees.toString())+"</h5><br/>":"<h6>Employees: </h6> <h5>N/A</h5><br/>"),null===a.twitter_handle)b+="<h6>Twitter:  </h6> <h5>N/A</h5><br/>",b+="<h6>Twitter Followers: </h6> <h5>N/A</h5><br/>";else{var f=a.twitter_handle.replace("@","");f="https://twitter.com/"+f,b+='<h6>Twitter:  </h6> <h5><a href="'+f+'" target="_blank">'+a.twitter_handle+"</h5></a><br/>",b+=null!==a.followers?"<h6>Twitter Followers:  </h6> <h5>"+d(a.followers.toString())+"</h5><br/>":"<h6>Twitter Followers:  </h6> <h5>N/A</h5><br/>"}if(null!==a.key_people){b+="<br/><h6>Key People:</h6><ul><h5>";for(var e=0;e<a.key_people.length;e++)b+='<li><a href="http://www.bing.com/search?q='+a.key_people[e].name.replace(" ","%20")+"%20"+a.nickname.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.key_people[e].name+"</a></li>";b+="</h5></ul>"}return null===a.funding_received?b+="<br/><h6>No known funding received.</h6><br/>":(b+="<br/><h6>Received funding from:</h6><ul>",a.funding_received.forEach(function(a){b+=0===a.amount||null===a.amount?'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>",null===a.year}),b+="</ul>"),null===a.funding_given?b+="<br/><h6>No known funding provided.</h6><br/>":(b+="<br/><h6>Gave funding to:</h6><ul>",a.funding_given.forEach(function(a){b+=0===a.amount||null===a.amount?'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>",null===a.year}),b+="</ul>"),null===a.investments_received?b+="<br/><h6>No known investments received.</h6><br/>":(b+="<br/><h6>Received investments from:</h6><ul>",a.investments_received.forEach(function(a){b+=0===a.amount||null===a.amount?'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>",null===a.year}),b+="</ul>"),null===a.investments_made?b+="<br/><h6>No known investments made.</h6><br/>":(b+="<br/><h6>Invested in:</h6><ul>",a.investments_made.forEach(function(a){b+=0===a.amount||null===a.amount?'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>",null===a.year}),b+="</ul>"),null===a.collaborations?b+="<br/><h6>No known collaborations.</h6><br/>":(b+="<br/><h6>Collaborated with:</h6><ul>",a.collaborations.forEach(function(a){b+='<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+"</a></h5></li>"}),b+="</ul>"),null===a.data?b+="<br/><h6>No known external data usage.</h6><br/>":(b+="<br/><h6>Obtained data from:</h6><ul>",a.data.forEach(function(a){b+='<li><h5><a href="http://www.bing.com/search?q='+a.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+a.entity+"</a></h5></li>"}),b+="</ul>"),null===a.revenue?b+="<br/><h6>No known revenue information.</h6><br/>":(b+="<br/><h6>Revenue:</h6><ul>",a.revenue.forEach(function(a){b+=0===a.amount||null===a.amount?null===a.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+a.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===a.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>":"<li><h5>"+a.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>"}),b+="</ul>"),null===a.expenses?b+="<br/><h6>No known expenses information.</h6><br/>":(b+="<br/><h6>Expenses:</h6><ul>",a.expenses.forEach(function(a){b+=0===a.amount||null===a.amount?null===a.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+a.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===a.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>":"<li><h5>"+a.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+d(a.amount.toString())+"</strong></li>"}),b+="</ul>"),eb(a),b}function N(){d3.select("#edit-add-info").html('<i class=" icon-file on-left"></i>Reset Form').on("click",N),Hb.on("mouseover",null),sa=eb(),d3.select("#info").html(sa),d3.select("datalist#list-name").html(n),d3.select("input#name").on("keyup",function(){T(this.value)}),d3.select("datalist#list-location").html(o),d3.select("input#location").on("keyup",function(){U(this.value)}),d3.select('#key-people-0 input[name="kpeople"]').on("keyup",function(){V(0)}),R("#funding-0 datalist"),d3.select('#funding-0 input[name="fund"]').on("keyup",function(){W(0),S(this.value,"#funding-0 input")}),R("#investing-0 datalist"),d3.select('#investing-0 input[name="invest"]').on("keyup",function(){X(0),S(this.value,"#investing-0 input")}),R("#fundinggiven-0 datalist"),d3.select('#fundinggiven-0 input[name="fundgiven"]').on("keyup",function(){Y(0),S(this.value,"#fundinggiven-0 input")}),R("#investmentmade-0 datalist"),d3.select('#investmentmade-0 input[name="investmade"]').on("keyup",function(){Z(0),S(this.value,"#investmentmade-0 input")}),R("#data-0 datalist"),d3.select('#data-0 input[name="data"]').on("keyup",function(){ab(0),S(this.value,"#data-0 input")}),d3.select("#toFormC").on("click",function(){hb()}),d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),Q()})}function O(){var a={type:null,categories:null,name:null,nickname:null,location:null,url:null,employees:null,key_people:null,twitter_handle:null,followers:null,relations:null,funding_received:null,investments_received:null,funding_given:null,investments_made:null,collaborations:null,data:null,revenue:null,expenses:null,influence:null};if(""===$('input[name="name"]').val()&&""===$('input[name="location"]').val())return{name:null,location:null,errorMessage:"The entity name and location have not been filled out."};if(""===$('input[name="name"]').val())return{name:null,errorMessage:"The entity name has not been filled out."};if(""===$('input[name="location"]').val())return{location:null,errorMessage:"The location has not been filled out."};a.type=$("input#rb_forpro").is(":checked")?"For-Profit":$("input#rb_nonpro").is(":checked")?"Non-Profit":$("input#rb_gov").is(":checked")?"Government":"Individual",a.name=d3.select(".webform-content input[name='name']")[0][0].value,a.categories=[],d3.selectAll(".webform-categories input").filter(function(){if(this.checked===!0)switch(this.value){case"General":a.categories.push("General Civic Tech");break;case"DataAnalytics":a.categories.push("Data & Analytics");break;case"EconGrowthEdu":a.categories.push("Jobs & Education");break;case"SRCities":a.categories.push("Smart & Resilient Cities");break;case"SocialServ":a.categories.push("Social Services");break;case"GovTech":a.categories.push("GovTech")}}),0===a.categories.length&&(a.categories=null),a.location=d3.select("input[name='location']")[0][0].value,a.url="",a.url=""===d3.select("input[name='website']")[0][0].value?null:d3.select("input[name='website']")[0][0].value,a.employees="",a.employees=""===d3.select("input[name='employees']")[0][0].value?null:parseInt(d3.select("input[name='employees']")[0][0].value),a.key_people=[],d3.selectAll(".kpeople").filter(function(){""!==this.value&&a.key_people.push(this.value)}),0===a.key_people.length&&(a.key_people=null),a.funding_received=[];var b;d3.selectAll(".fund-input .funder").filter(function(c,d){this.value&&(d3.selectAll(".fund_amt")[0][d].value?(b=d3.selectAll(".fund_amt")[0][d].value,a.funding_received.push(d3.selectAll(".fund_year")[0][d].value?{name:this.value,amount:b,year:d3.selectAll(".fund_year")[0][d].value}:{name:this.value,amount:b,year:null})):(b=null,a.funding_received.push(d3.selectAll(".fund_year")[0][d].value?{name:this.value,amount:b,year:d3.selectAll(".fund_year")[0][d].value}:{name:this.value,amount:b,year:null})))}),0===a.funding_received.length&&(a.funding_received=null),a.funding_given=[];var c;d3.selectAll(".fundgiven-input .fundee").filter(function(b,d){this.value&&(d3.selectAll(".fundgiven_amt")[0][d].value?(c=d3.selectAll(".fundgiven_amt")[0][d].value,a.funding_given.push(d3.selectAll(".fundgiven_year")[0][d].value?{name:this.value,amount:c,year:d3.selectAll(".fundgiven_year")[0][d].value}:{name:this.value,amount:c,year:null})):(c=null,a.funding_given.push(d3.selectAll(".fundgiven_year")[0][d].value?{name:this.value,amount:c,year:d3.selectAll(".fundgiven_year")[0][d].value}:{name:this.value,amount:c,year:null})))}),0===a.funding_given.length&&(a.funding_given=null),a.investments_received=[];var d;d3.selectAll(".invest-input .investor").filter(function(b,c){this.value&&(d3.selectAll(".invest_amt")[0][c].value?(d=d3.selectAll(".invest_amt")[0][c].value,a.investments_received.push(d3.selectAll(".invest_year")[0][c].value?{name:this.value,amount:d,year:d3.selectAll(".invest_year")[0][c].value}:{name:this.value,amount:d,year:null})):(d=null,a.investments_received.push(d3.selectAll(".invest_year")[0][c].value?{name:this.value,amount:d,year:d3.selectAll(".invest_year")[0][c].value}:{name:this.value,amount:d,year:null})))}),0===a.investments_received.length&&(a.investments_received=null),a.investments_made=[];var e;return d3.selectAll(".investmade-input .investee").filter(function(b,c){this.value&&(d3.selectAll(".investmade_amt")[0][c].value?(e=d3.selectAll(".investmade_amt")[0][c].value,a.investments_made.push(d3.selectAll(".investmade_year")[0][c].value?{name:this.value,amount:e,year:d3.selectAll(".investmade_year")[0][c].value}:{name:this.value,amount:e,year:null})):(e=null,a.investments_made.push(d3.selectAll(".investmade_year")[0][c].value?{name:this.value,amount:e,year:d3.selectAll(".investmade_year")[0][c].value}:{name:this.value,amount:e,year:null})))}),0===a.investments_made.length&&(a.investments_made=null),a.data=[],d3.selectAll(".data-entity").filter(function(){""!==this.value&&a.data.push(this.value)}),0===a.data.length&&(a.data=null),a}function P(a){a.nickname=d3.select(".webform-content input[name='nickname']")[0][0].value,a.nickname||(a.nickname=a.name),a.twitter_handle=d3.select(".webform-content input[name='twitterhandle']")[0][0].value,a.twitter_handle||(a.twitter_handle=null),a.influence=$(".webform-influence input#rb_local").is(":checked")?"local":"global",a.collaborations=[],d3.selectAll(".collaborator").filter(function(){this.value&&a.collaborations.push(this.value)}),0===a.collaborations.length&&(a.collaborations=null),a.revenue=[];var b;d3.selectAll(".revenue-input .revenue_amt").filter(function(c,d){this.value&&(b=d3.selectAll(".revenue-input .revenue_year")[0][d].value,a.revenue.push(b?{amount:this.value,year:b}:{amount:this.value,year:null}))}),0===a.revenue.length&&(a.revenue=null),a.expenses=[];var c;return d3.selectAll(".expense-input .expense_amt").filter(function(b,d){this.value&&(c=d3.selectAll(".expense-input .expense_year")[0][d].value,a.expenses.push(c?{amount:this.value,year:c}:{amount:this.value,year:null}))}),0===a.expenses.length&&(a.expenses=null),a}function Q(){var a=O();a.location&&a.name?(counterKey=0,counterK=0,counterFund=0,counterF=0,s='<h2 id="webform-head">Information</h2><hr/><div class="webform-content"><div class="input-control text" data-role="input-control"><input type="text" name="name" id="name" placeholder="Name of Entity"/></div><h3 class="form-header">Entity Type</h3><div class="webform-entities"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span><h4 class="webform-labels">For-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span><h4 class="webform-labels">Non-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span><h4 class="webform-labels">Government</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span><h4 class="webform-labels">Individual</h4></label></div></div><div class="input-control text" data-role="input-control"><input type="text" name="location" id="location" placeholder="City, State"/></div>',s+='<hr/><div class = "input-control text" data-role="input-control"><input type="text" name="nickname" id="nickname" placeholder="Nickname/Abbr."/></div><div class = "input-control text" data-role="input-control"><input type="text" name="twitterhandle" id="twitterhandle" placeholder="Twitter Handle"/></div><h3 class="form-header" style="display:inline-block;">Circle of Influence: </h3><div class="webform-influence"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_local" type="radio" name="influence-type" value="Local Influence" checked="checked"/><span class="check"></span><h4 class="webform-labels">Local Influence</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_global" type="radio" name="influence-type" value="Global Influence" checked="checked"/><span class="check"></span><h4 class="webform-labels">Global Influence</h4></label></div></div><h3 class="form-header">Collaboration</h3><div id="collaboration-0" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div><h3 class="form-header">Revenue</h3><div id="revenue-0"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Expenses</h3><div id="expense-0"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><button type="button" id="submit-B" href="javascript: check_empty()">Submit</button></div>',d3.select("#info").html(s),R("#collaboration-0 datalist"),d3.selectAll("#name").text(function(){this.value=a.name}).attr("disabled",!0),d3.selectAll("#location").text(function(){this.value=a.location}).attr("disabled",!0).style("margin-top","10px"),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===a.type?!0:!1,this.disabled=!0}),d3.selectAll('input[name="collaboration"]').on("keyup",function(){bb(0),S(this.value,"#collaboration-0 input")}),d3.selectAll('input[name="revenue_amt"]').on("keyup",function(){cb(0)}),d3.selectAll('input[name="expense_amt"]').on("keyup",function(){db(0)}),d3.selectAll("#submit-B").on("click",function(){gb(a)})):a.name||a.location?a.name?d3.select("#location").style("border-color","#e51400"):d3.select("#name").style("border-color","#e51400"):(d3.select("#name").style("border-color","#e51400"),d3.select("#location").style("border-color","#e51400"))}function R(a){d3.select(a).html(n)}function S(a,b){a.toLowerCase()in z&&d3.selectAll(b).text(function(){this.value=z[a].name})}function T(a){a=a.toLowerCase(),a in z&&(N(),ib(z[a]))}function U(a){a.toLowerCase()in A&&d3.selectAll("#location").text(function(){this.value=A[a][0].location})}function V(a){""!==$("#key-people-"+a+' input[name="kpeople"]').val()&&(d3.select("#key-people-"+a+' input[name="kpeople"]').on("keyup",null),a++,$("#key-people-"+(a-1)).after('<div id="key-people-'+a+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div>'),d3.select("#key-people-"+a+" input[name='kpeople']").on("keyup",function(){V(a)}))}function W(a){""!==$("#funding-"+a+' input[name="fund"]').val()&&(d3.select("#funding-"+a+' input[name="fund"]').on("keyup",function(){S(this.value,"#funding-"+(a-1)+' input[name="fund"]')}),a++,$("#funding-"+(a-1)).after('<div id="funding-'+a+'"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#funding-"+a+" datalist"),d3.select("#funding-"+a+" input[name='fund']").on("keyup",function(){W(a)}))}function X(a){""!==$("#investing-"+a+' input[name="invest"]').val()&&(d3.select("#investing-"+a+' input[name="invest"]').on("keyup",function(){S(this.value,"#investing-"+(a-1)+' input[name="invest"]')}),a++,$("#investing-"+(a-1)).after('<div id="investing-'+a+'"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#investing-"+a+" datalist"),d3.select("#investing-"+a+" input[name='invest']").on("keyup",function(){X(a)}))}function Y(a){""!==$("#fundinggiven-"+a+' input[name="fundgiven"]').val()&&(d3.select("#fundinggiven-"+a+' input[name="fundgiven"]').on("keyup",function(){S(this.value,"#fundinggiven-"+(a-1)+' input[name="fundgiven"]')}),a++,$("#fundinggiven-"+(a-1)).after('<div id="fundinggiven-'+a+'"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#fundinggiven-"+a+" datalist"),d3.select("#fundinggiven-"+a+" input[name='fundgiven']").on("keyup",function(){Y(a)}))}function Z(a){""!==$("#investmentmade-"+a+' input[name="investmade"]').val()&&(d3.select("#investmentmade-"+a+' input[name="investmade"]').on("keyup",function(){S(this.value,"#investmentmade-"+(a-1)+' input[name="investmade"]')}),a++,$("#investmentmade-"+(a-1)).after('<div id="investmentmade-'+a+'"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#investmentmade-"+a+" datalist"),d3.select("#investmentmade-"+a+" input[name='investmade']").on("keyup",function(){Z(a)}))}function ab(a){""!==$("#data-"+a+' input[name="data"]').val()&&(d3.select("#data-"+a+' input[name="data"]').on("keyup",function(){S(this.value,"#data-"+(a-1)+' input[name="data"]')}),a++,$("#data-"+(a-1)).after('<div id="data-'+a+'" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div>'),R("#data-"+a+" datalist"),d3.select("#data-"+a+" input[name='data']").on("keyup",function(){ab(a)}))}function bb(a){""!==$("#collaboration-"+a+' input[name="collaboration"]').val()&&(d3.select("#collaboration-"+a+' input[name="collaboration"]').on("keyup",function(){S(this.value,"#collaboration-"+(a-1)+' input[name="collaboration"]')}),a++,$("#collaboration-"+(a-1)).after('<div id="collaboration-'+a+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div>'),R("#collaboration-"+a+" datalist"),d3.select("#collaboration-"+a+" input[name='collaboration']").on("keyup",function(){bb(a)}))}function cb(a){""!==$("#revenue-"+a+' input[name="revenue_amt"]').val()&&(d3.select("#revenue-"+a+' input[name="revenue_amt"]').on("keyup",null),a++,$("#revenue-"+(a-1)).after('<div id="revenue-'+a+'"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#revenue-"+a+" input[name=revenue_amt]").on("keyup",function(){cb(a)}))}function db(a){""!==$("#expense-"+a+' input[name="expense_amt"]').val()&&(d3.select("#expense-"+a+' input[name="expense_amt"]').on("keyup",null),a++,$("#expense-"+(a-1)).after('<div id="expense-'+a+'"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#expense-"+a+" input[name=expense_amt]").on("keyup",function(){db(a)}))}function eb(){return s='<h2 id="webform-head">Information</h2><hr/><div class="webform-content"><div class="input-control text" data-role="input-control"><input type="text" name="name" id="name" placeholder="Name of Entity" list="list-name"/><datalist id="list-name"></datalist></div><h3 class="form-header">What type of entity?</h3><div class="webform-entities"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span><h4 class="webform-labels">For-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span><h4 class="webform-labels">Non-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span><h4 class="webform-labels">Government</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span><h4 class="webform-labels">Individual</h4></label></div></div><h3 class="form-header">What kind of work do they do?</h3><h4>(Select All That Apply)</h4><div class="webform-categories"><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_gen" type="checkbox" name="gen" data-show="general" value="General"/><span class="check"></span><h4 class="webform-labels">General Civic Tech</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_datat" type="checkbox" name="datat" data-show="datalytics" value="DataAnalytics"/><span class="check"></span><h4 class="webform-labels">Data & Analytics</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_eced" type="checkbox" name="eced" data-show="econedu" value="EconGrowthEdu"/><span class="check"></span><h4 class="webform-labels">Jobs & Education</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_src" type="checkbox" name="srcities" data-show="srcities" value="SRCities"/><span class="check"></span><h4 class="webform-labels">Smart & Resilient Cities</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_socs" type="checkbox" name="socserv" data-show="socserv" value="SocialServ"/><span class="check"></span><h4 class="webform-labels">Social Services</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_govt" type="checkbox" name="govtech" data-show="govtech" value="GovTech"/><span class="check"></span><h4 class="webform-labels">GovTech</h4></label></div></div><div class="input-control text" data-role="input-control"><input type="text" name="location" id="location" placeholder="City, State" list="list-location"/><datalist id="list-location"></datalist></div><div class="input-control text" data-role="input-control"><input type="text" name="website" id="website" placeholder="Website"/></div><h3 class="form-header" style="display:inline-block;">Number of Employees</h3><div class="input-control text" data-role="input-control" style="width:27% !important; display:inline-block; float:right; margin-top: 2%;"><input type="text" name="employees" id="employee" maxlength="6" style="width:100% !important;"/></div><h3 class="form-header">Key People?</h3><div id="key-people-0" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div><h3 class="form-header">Who funds them via grants?</h3><div id="funding-0"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who invests in them via equity stakes (stock)?</h3><div id="investing-0"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they fund via grants?</h3><div id="fundinggiven-0"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they invest in via equity stakes (stock)?</h3><div id="investmentmade-0"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who provides them with data?</h3><div id="data-0" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div><div id="nextPhase"><button type="button" id="submit-A" href="javascript: check_empty()">Next</button></div></div><hr/><div class="webform-footer"><span id="">Some entities lack adequate information. Would you like to help?</span><br/><span id="toFormC">Click here!</span></div>',s
}function fb(){var a=0,b=[];e.forEach(function(c){_.object(_.map(c,function(b,c){return null===b&&a++,[c,b]}));"Individual"===c.type&&(a-=4),b.push({name:c.name,nullFields:a}),a=0});var c=_.max(b,function(a){return a.nullFields}),d=[];b.forEach(function(a){if(a.nullFields<=c.nullFields&&a.nullFields>=c.nullFields-7){var b=_.find(e,function(b){return a.name===b.name});d.push(b)}});for(var f=[];f.length<5;){var g=Math.floor(Math.random()*d.length);-1===f.indexOf(d[g])&&f.push(d[g])}return f}function gb(a){var b=P(a);hb(),console.log(b),console.log($.param(b)),$.ajax({type:"POST",data:$.param(b),url:"/database/save",crossDomain:!0}).done(function(){})}function hb(){var a="";a+='<h2 id="webform-head">Information</h2><hr/><div style="text-align:center;" class="webform-content"><p>Thank you for contributing to Civic Graph! Refresh the page to view your changes (it might take a few moments).</p><p>Would you like to add or edit more info?</p>',a+='<ul id="suggestions">';var b=fb();b.forEach(function(b){a+='<li><a style="cursor:pointer;">'+b.name+"</a></li>"}),a+="</ul></div>",d3.select("#info").html(a),d3.selectAll("#info ul a").on("click",function(a,c){qb(b[c]),N(),ib(b[c])})}function ib(a){if(d3.selectAll("#name").text(function(){this.value=a.name}),d3.selectAll("#location").text(function(){this.value=a.location}),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===a.type?!0:!1}),null!==a.categories&&d3.selectAll(".webform-categories input").filter(function(b,c){this.checked=a.categories.indexOf(d3.selectAll(".webform-categories h4")[0][c].textContent)>-1?!0:!1}),d3.selectAll("#website").text(function(){this.value=a.url}),d3.selectAll("#employee").text(function(){this.value=a.employees}),null!==a.key_people){for(var b=a.key_people,c=0;c<b.length;c++)$("#key-people-"+c).after('<div id="key-people-'+(c+1)+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name""/></div>'),d3.select("#key-people-"+c+' input[name="kpeople"]').on("keyup",null),d3.select("#key-people-"+c+' input[name="kpeople"]').text(function(){this.value=b[c].name});d3.select("#key-people-"+b.length+' input[name="kpeople"]').on("keyup",function(){V(b.length)})}if(null!==a.funding_received){var d=a.funding_received;d.forEach(function(a,b){$("#funding-"+b).after('<div id="funding-'+(b+1)+'"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#funding-"+b+" datalist"),d3.select("#funding-"+b+' input[name="fund"]').on("keyup",function(){S(this.value,"#funding-"+b+' input[name="fund"]')}),d3.select("#funding-"+b+' input[name="fund"]').text(function(){this.value=a.entity}),d3.select("#funding-"+b+' input[name="fund_amt"]').text(function(){this.value=a.amount}),d3.select("#funding-"+b+' input[name="fund_year"]').text(function(){this.value=a.year})}),d3.select("#funding-"+d.length+" input[name='fund']").on("keyup",function(){W(d.length)})}if(null!==a.funding_given){var e=a.funding_given;e.forEach(function(a,b){$("#fundinggiven-"+b).after('<div id="fundinggiven-'+(b+1)+'"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#fundinggiven-"+b+" datalist"),d3.select("#fundinggiven-"+b+' input[name="fundgiven"]').on("keyup",function(){S(this.value,"#fundinggiven-"+b+' input[name="fundgiven"]')}),d3.select("#fundinggiven-"+b+' input[name="fundgiven"]').text(function(){this.value=a.entity}),d3.select("#fundinggiven-"+b+' input[name="fundgiven_amt"]').text(function(){this.value=a.amount}),d3.select("#fundinggiven-"+b+' input[name="fundgiven_year"]').text(function(){this.value=a.year})}),d3.select("#fundinggiven-"+e.length+" input[name='fundgiven']").on("keyup",function(){Y(e.length)})}if(null!==a.investments_received){var f=a.investments_received;f.forEach(function(a,b){$("#investing-"+b).after('<div id="investing-'+(b+1)+'"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#investing-"+b+" datalist"),d3.select("#investing-"+b+' input[name="invest"]').on("keyup",function(){S(this.value,"#investing-"+b+' input[name="invest"]')}),d3.select("#investing-"+b+' input[name="invest"]').text(function(){this.value=a.entity}),d3.select("#investing-"+b+' input[name="invest_amt"]').text(function(){this.value=a.amount}),d3.select("#investing-"+b+' input[name="invest_year"]').text(function(){this.value=a.year})}),d3.select("#investing-"+f.length+" input[name='invest']").on("keyup",function(){X(f.length)})}if(null!==a.investments_made){var g=a.investments_made;g.forEach(function(a,b){$("#investmentmade-"+b).after('<div id="investmentmade-'+(b+1)+'"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),R("#investmentmade-"+b+" datalist"),d3.select("#investmentmade-"+b+' input[name="investmade"]').on("keyup",function(){S(this.value,"#investmentmade-"+b+' input[name="investmade"]')}),d3.select("#investmentmade-"+b+' input[name="investmade"]').text(function(){this.value=a.entity}),d3.select("#investmentmade-"+b+' input[name="investmade_amt"]').text(function(){this.value=a.amount}),d3.select("#investmentmade-"+b+' input[name="investmade_year"]').text(function(){this.value=a.year})}),d3.select("#investmentmade-"+g.length+" input[name='investmade']").on("keyup",function(){Z(g.length)})}if(null!==a.data){var h=a.data;h.forEach(function(a,b){$("#data-"+b).after('<div id="data-'+(b+1)+'" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div>'),R("#data-"+b+" datalist"),d3.select("#data-"+b+' input[name="data"]').on("keyup",function(){S(this.value,"#data-"+b+' input[name="data"]')}),d3.select("#data-"+b+' input[name="data"]').text(function(){this.value=a.entity})}),d3.select("#data-"+h.length+" input[name='data']").on("keyup",function(){ab(h.length)})}d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),Q(),jb(a)})}function jb(a){if(d3.selectAll("#nickname").text(function(){this.value=a.nickname}),d3.selectAll("#twitterhandle").text(function(){this.value=a.twitter_handle}),d3.selectAll('input[name="influence-type"]').filter(function(){this.checked="local"===a.influence&&"Local Influence"===this.value?!0:"global"===a.influence&&"Global Influence"===this.value?!0:!1}),null!==a.collaborations){var b=a.collaborations;b.forEach(function(a,b){$("#collaboration-"+b).after('<div id="collaboration-'+(b+1)+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div>'),R("#collaboration-"+b+" datalist"),d3.select("#collaboration-"+b+' input[name="collaboration"]').on("keyup",function(){S(this.value,"#collaboration-"+b+' input[name="collaboration"]')}),d3.select("#collaboration-"+b+' input[name="collaboration"]').text(function(){this.value=a.entity})}),d3.select("#collaboration-"+b.length+' input[name="collaboration"]').on("keyup",function(){bb(b.length)})}if(null!==a.expenses){var c=a.expenses;c.forEach(function(a,b){$("#expense-"+b).after('<div id="expense-'+(b+1)+'"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#expense-"+b+' input[name="expense_amt"]').on("keyup",null),d3.select("#expense-"+b+' input[name="expense_amt"]').text(function(){this.value=a.amount}),d3.select("#expense-"+b+' input[name="expense_year"]').text(function(){this.value=a.year})}),d3.select("#expense-"+c.length+' input[name="expense_amt"]').on("keyup",function(){db(c.length)})}if(null!==a.revenue){var d=a.revenue;d.forEach(function(a,b){$("#revenue-"+b).after('<div id="revenue-'+(b+1)+'"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#revenue-"+b+' input[name="revenue_amt"]').on("keyup",null),d3.select("#revenue-"+b+' input[name="revenue_amt"]').text(function(){this.value=a.amount}),d3.select("#revenue-"+b+' input[name="revenue_year"]').text(function(){this.value=a.year})}),d3.select("#revenue-"+d.length+' input[name="revenue_amt"]').on("keyup",function(){cb(d.length)})}}function kb(){for(var a="",b=[0,0,0,0],c=[],d=[],f=[],g=[],h=0;h<e.length;h++)"Individual"===e[h].type&&(g.push(e[h].name),Lb.push(e[h]),b[3]++),"Non-Profit"===e[h].type&&(d.push(e[h].name),Jb.push(e[h]),b[1]++),"For-Profit"===e[h].type&&(c.push(e[h].name),Ib.push(e[h]),b[0]++),"Government"===e[h].type&&(f.push(e[h].name),Kb.push(e[h]),b[2]++);a+="<h3 style='padding-bottom:10px;'>The Data</h3>",d3.select("#info").html(a).style("list-style","square"),d3.select("#info").append("div").attr("id","breakdown").style("width","100%");var h=d3.scale.linear().domain([0,d3.max(b)]).range([0,$("#breakdown").width()]),i=0,j=0;d3.select("#breakdown").selectAll("div").data(b).enter().append("div").style("width",function(a){return h(a)/5+"%"}).style("height","20px").style("font","8px sans-serif").style("background-color",function(){return 0===i?(i++,"rgb(127,186,0)"):1===i?(i++,"rgb(0,164,239)"):2===i?(i++,"rgb(242,80,34)"):3===i?(i++,"rgb(255,185,0)"):void 0}).style("text-align","right").style("padding","3px").style("margin","1px").style("color","white").text(function(){return 0===j?void j++:1===j?void j++:2===j?void j++:3===j?void j++:void 0});var k="";k+="<h3 style='padding-top:15px; color:rgb(127,186,0);'>For-Profit ("+b[0]+"):</h3> ";for(var h=0;h<c.length;h++)k+=h===c.length-1?"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+c[h]+"</a>":"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+c[h]+", </a>";k+="<h3 style='padding-top:15px; color:rgb(0,164,239);'>Non-Profit ("+b[1]+"):</h3> ";for(var h=0;h<d.length;h++)k+=h===d.length-1?"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+d[h]+"</a>":"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+d[h]+", </a>";k+="<h3 style='padding-top:15px; color:rgb(242,80,34);'>Government ("+b[2]+"):</h3> ";for(var h=0;h<f.length;h++)k+=h===f.length-1?"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+f[h]+"</a>":"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+f[h]+", </a>";k+="<h3 style='padding-top:15px; color:rgb(255,185,0);'>Individual ("+b[3]+"):</h3> ";for(var h=0;h<g.length;h++)k+=h===g.length-1?"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+g[h]+"</a>":"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+g[h]+", </a>";d3.select("#info").append("text").style("padding-bottom","20px").html(k)}function lb(){var a="";e.forEach(function(a){name=a.name.toLowerCase(),nickname=a.nickname.toLowerCase();var b=a.location.split("; ");name in z||(z[name]=a,B.push(a.name)),nickname in z||(z[nickname]=a,B.push(a.nickname)),b.forEach(function(b){var c=b.toLowerCase();c in A?A[c].push(a):(A[c]=[],A[c].push(a),C.push(b))})}),B=_.sortBy(B,function(a){return a.toLowerCase()}),C=_.sortBy(C,function(a){return a.toLowerCase()}),D=_.sortBy(B.concat(C),function(a){return a});for(var b=0;b<D.length;b++)a+='<option value="'+D[b]+'">';d3.select(".filter-name-location datalist").html(a)}function mb(a){a=a.toLowerCase(),a in z&&qb(z[a]),a in A&&(Bb.style("opacity",function(b){return b.source.location.toLowerCase()===a&&b.target.location.toLowerCase()===a?1:.05}),Cb.style("opacity",function(b){return b.source.location.toLowerCase()===a&&b.target.location.toLowerCase()===a?1:.05}),Db.style("opacity",function(b){return b.source.location.toLowerCase()===a&&b.target.location.toLowerCase()===a?1:.05}),Eb.style("opacity",function(b){return b.source.location.toLowerCase()===a&&b.target.location.toLowerCase()===a?1:.05}),d3.selectAll("circle").style("stroke","white"),d3.selectAll(".node").style("opacity",function(b){return-1===b.location.toLowerCase().indexOf(a)?.05:1}).select("text").style("opacity",1),Hb.on("mouseout",null).on("mouseover",null).on("click",null),Hb.filter(function(a,b){return 1==Fb[0][b].style.opacity}).on("mouseover",H))}function nb(a){for(var b="",c=0;c<a.length;c++)b+='<option value="'+a[c]+'">';return b}function ob(a){var b=M(a);webform=L(a),d3.select("#edit").html(webform),d3.select("#info").html(b).style("list-style","square"),Bb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?1:.05}),Cb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?1:.05}),Db.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?1:.05}),Eb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?1:.05});var c=function(a,b){return a.target.index===b.index},d=function(a,b){return a.source.index===b.index},e={};e[a.ID]=1,l.forEach(function(b){d(b,a)&&(e[b.target.index]=1),c(b,a)&&(e[b.source.index]=1)}),m.forEach(function(b){d(b,a)&&(e[b.target.index]=1),c(b,a)&&(e[b.source.index]=1)}),j.forEach(function(b){d(b,a)&&(e[b.target.index]=1),c(b,a)&&(e[b.source.index]=1)}),k.forEach(function(b){d(b,a)&&(e[b.target.index]=1),c(b,a)&&(e[b.source.index]=1)}),d3.select(this).style("stroke","rgba(0,0,0,0.6)"),E.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(a){return a.ID in e?"1":"0.05"}).select("text").style("opacity",1),d3.select(this.parentNode).select("text").transition().duration(350).delay(0).style("opacity",1).style("font-weight","bold")}function pb(){Hb.style("stroke","white").on("mouseover",ob).on("mouseout",pb).on("click",qb),Bb.transition().duration(350).delay(0).style("stroke","rgb(111,93,168)").style("opacity","0.2").style("stroke-width","1px"),Cb.transition().duration(350).delay(0).style("stroke","rgb(38,114,114)").style("opacity","0.2").style("stroke-width","1px"),Db.transition().duration(350).delay(0).style("stroke","rgb(235,232,38)").style("opacity","0.2").style("stroke-width","1px"),Eb.transition().duration(350).delay(0).style("stroke","rgb(191,72,150)").style("opacity","0.2").style("stroke-width","1px"),d3.selectAll(".node").transition().duration(350).delay(0).style("opacity","1"),d3.selectAll(".node").selectAll("text").transition().duration(350).delay(0).style("opacity",function(a){var b;return"For-Profit"===a.type&&(b=r.hasOwnProperty(a.name)?1:0),"Non-Profit"===a.type&&(b=t.hasOwnProperty(a.name)?1:0),"Individual"===a.type&&(b=u.hasOwnProperty(a.name)?1:0),"Government"===a.type&&(b=v.hasOwnProperty(a.name)?1:0),b}).style("font-size","14px").style("font-weight","normal")}function qb(a){w=0,H(a),Bb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?"1":"0.05"}),Cb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?"1":"0.05"}),Db.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?"1":"0.05"}),Eb.transition().duration(350).delay(0).style("opacity",function(b){return a===b.source||a===b.target?"1":"0.05"}),Hb.style("stroke",function(b){return b!==a?"white":"black"}).on("mouseout",null),Hb.filter(function(b){return b!==a?b:void 0}).on("mouseover",null);var b=F.funding_connections.filter(function(b){return b.source.index===a.index||b.target.index===a.index}).map(function(b){return b.source.index===a.index?b.target.index:b.source.index}),c=F.investment_connections.filter(function(b){return b.source.index===a.index||b.target.index===a.index}).map(function(b){return b.source.index===a.index?b.target.index:b.source.index}),d=F.collaboration_connections.filter(function(b){return b.source.index===a.index||b.target.index===a.index}).map(function(b){return b.source.index===a.index?b.target.index:b.source.index}),e=F.data_connections.filter(function(b){return b.source.index===a.index||b.target.index===a.index}).map(function(b){return b.source.index===a.index?b.target.index:b.source.index});E.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(f){return b.indexOf(f.index)>-1||c.indexOf(f.index)>-1||d.indexOf(f.index)>-1||e.indexOf(f.index)>-1||f===a?1:.05}).select("text").style("opacity",1),Hb.filter(function(f){return b.indexOf(f.index)>-1||c.indexOf(f.index)>-1||d.indexOf(f.index)>-1||e.indexOf(f.index)>-1||f===a}).on("mouseover",H).on("click",function(){})}function rb(){Hb.on("mouseover",null).on("mouseout",null).on("click",null)}function sb(){d3.select(this).classed("fixed",function(a){a.fixed=!0}),Hb.on("mouseover",ob).on("mouseout",pb).on("click",qb)}function tb(a){var c=8*a.alpha;e.forEach(function(a){null!==a.type&&("Individual"===a.type&&(a.x+=c+c,a.y+=c+c),"Non-Profit"===a.type&&(a.x+=-c-c,a.y+=c+c),"For-Profit"===a.type&&(a.x+=c+c,a.y+=-c-c),"Government"===a.type&&(a.x+=-c-c,a.y+=-c-c))}),_.isEmpty(y)?(Bb.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),Cb.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),Db.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),Eb.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),Hb.attr("cx",function(a){return a.x=a.x}).attr("cy",function(a){return a.y=a.y}),Gb.attr("transform",b)):(Bb.attr("x1",function(a){return a.source===y?(a.source.x=y.x,a.source.x):a.source.x}).attr("y1",function(a){return a.source===y?(a.source.y=y.y,a.source.y):a.source.y}).attr("x2",function(a){return a.target===y?(a.target.x=y.x,a.target.x):a.target.x}).attr("y2",function(a){return a.target===y?(a.target.y=y.y,a.target.y):a.target.y}),Cb.attr("x1",function(a){return a.source===y?(a.source.x=y.x,a.source.x):a.source.x}).attr("y1",function(a){return a.source===y?(a.source.y=y.y,a.source.y):a.source.y}).attr("x2",function(a){return a.target===y?(a.target.x=y.x,a.target.x):a.target.x}).attr("y2",function(a){return a.target===y?(a.target.y=y.y,a.target.y):a.target.y}),Db.attr("x1",function(a){return a.source===y?(a.source.x=y.x,a.source.x):a.source.x}).attr("y1",function(a){return a.source===y?(a.source.y=y.y,a.source.y):a.source.y}).attr("x2",function(a){return a.target===y?(a.target.x=y.x,a.target.x):a.target.x}).attr("y2",function(a){return a.target===y?(a.target.y=y.y,a.target.y):a.target.y}),Eb.attr("x1",function(a){return a.source===y?(a.source.x=y.x,a.source.x):a.source.x}).attr("y1",function(a){return a.source===y?(a.source.y=y.y,a.source.y):a.source.y}).attr("x2",function(a){return a.target===y?(a.target.x=y.x,a.target.x):a.target.x}).attr("y2",function(a){return a.target===y?(a.target.y=y.y,a.target.y):a.target.y}),Hb.attr("cx",function(a,b){return d3.select(Hb)[0][0].data()[b].name===y.name?(a.x=y.x,a.x):a.x=a.x}).attr("cy",function(a,b){return d3.select(Hb)[0][0].data()[b].name===y.name?(a.y=y.y,a.y):a.y=a.y}),Gb.attr("transform",b))}var ub=F.nodes,vb=F.funding_connections,wb=F.investment_connections,xb=F.collaboration_connections,yb=F.data_connections,zb=vb.concat(wb).concat(xb).concat(yb);e=ub.filter(function(a){return 1===a.render}),l=vb.filter(function(a){return 1===a.render}),m=wb.filter(function(a){return 1===a.render}),j=xb.filter(function(a){return 1===a.render}),k=yb.filter(function(a){return 1===a.render});var Ab=(l.concat(m).concat(j).concat(k),d3.layout.force().nodes(ub).size([p,q]).links(zb).linkStrength(0).charge(function(a){return 1===a.render?null!==a.employees?-6*J(a.employees):-25:0}).linkDistance(50)),rb=Ab.drag().on("dragstart",rb).on("drag",rb).on("dragend",sb),Bb=E.selectAll(".fund").data(l).enter().append("line").attr("class","fund").style("stroke","rgb(111,93,168)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),Cb=E.selectAll(".invest").data(m).enter().append("line").attr("class","invest").style("stroke","rgb(38,114,114)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),Db=E.selectAll(".porucs").data(j).enter().append("line").attr("class","porucs").style("stroke","rgb(235,232,38)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),Eb=E.selectAll(".data").data(k).enter().append("line").attr("class","data").style("stroke","rgb(191,72,150)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),Fb=E.selectAll(".node").data(e).enter().append("g").attr("class","node").style("visibility","visible").on("dblclick",G).call(rb);Ab.on("tick",tb).start(),f=E.selectAll(".node").filter(function(a){return"For-Profit"===a.type}).sort(function(a,b){return a.weight-b.weight}),g=E.selectAll(".node").filter(function(a){return"Non-Profit"===a.type}).sort(function(a,b){return a.weight-b.weight}),h=E.selectAll(".node").filter(function(a){return"Individual"===a.type}).sort(function(a,b){return a.weight-b.weight}),i=E.selectAll(".node").filter(function(a){return"Government"===a.type}).sort(function(a,b){return a.weight-b.weight}),f.each(function(a,b){b>=f[0].length-5&&(r[a.name]=a.weight)}),g.each(function(a,b){b>=g[0].length-5&&(t[a.name]=a.weight)}),h.each(function(a,b){b>=h[0].length-5&&(u[a.name]=a.weight)}),i.each(function(a,b){b>=i[0].length-5&&(v[a.name]=a.weight)});var Gb=E.selectAll(".node").append("text").text(function(a){return a.nickname}).attr("x",0).attr("dy","0.1em").attr("y",function(a){return null!==a.employees?J(a.employees)+10:17}).style("opacity",function(a){var b;return"For-Profit"===a.type&&(b=r.hasOwnProperty(a.name)?1:0),"Non-Profit"===a.type&&(b=t.hasOwnProperty(a.name)?1:0),"Individual"===a.type&&(b=u.hasOwnProperty(a.name)?1:0),"Government"===a.type&&(b=v.hasOwnProperty(a.name)?1:0),b}).style("font-size","14px").style("color","#FFFFFF").style("pointer-events","none"),Hb=Fb.append("circle").attr("r",function(a){return null!==a.employees?J(a.employees):"7"}).style("fill",function(a){if(null!==a.type){if("Individual"===a.type)return"rgb(255,185,0)";if("Non-Profit"===a.type)return"rgb(0,164,239)";if("For-Profit"===a.type)return"rgb(127,186,0)";if("Government"===a.type)return"rgb(242,80,34)"}}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("stroke-width","1.5px").style("stroke","white").on("mouseover",ob).on("mouseout",pb).on("click",qb);for(Gb.call(a,80);Ab.alpha()>.025;)Ab.tick();d3.selectAll("#edit").on("click",N);var Ib=[],Jb=[],Kb=[],Lb=[];kb(),d3.selectAll(".for-profit-entity").on("click",function(a,b){qb(Ib[b])}),d3.selectAll(".non-profit-entity").on("click",function(a,b){qb(Jb[b])}),d3.selectAll(".individual-entity").on("click",function(a,b){qb(Lb[b])}),d3.selectAll(".government-entity").on("click",function(a,b){qb(Kb[b])}),d3.selectAll(".click-location").on("click",function(){mb(this.innerHTML)}),lb(),d3.selectAll("#search-text").on("keydown",function(){13===d3.event.keyCode&&mb(this.value)}).on("keyup",function(){mb(this.value)}),d3.selectAll("option").on("keydown",function(a,b){if(13===d3.event.keyCode){var c=d3.selectAll("option")[0][b].value;mb(c)}}),n=nb(B),o=nb(C);var Mb=function(){for(var a={},b=0;b<Fb[0].length;b++)"visible"===Fb[0][b].style.visibility&&(a[Fb[0][b].__data__.ID]=Fb[0][b]);return a},Nb=function(){var a=[".invest",".fund",".porucs",".data"];d3.selectAll(".group-items.connections input")[0].forEach(function(b,c){d3.selectAll("#"+b.id).on("click",function(b,c){return function(){var d=Mb();$("#"+b.id).is(":checked")?Ob(a[c],d):Pb(a[c]),Qb(a[c],d)}}(b,c))})},Ob=function(a,b){d3.selectAll(a).style("visibility",function(a){return a.source.index in b&&a.target.index in b&&"hidden"===this.style.visibility?"visible":"hidden"})},Pb=function(a){d3.selectAll(a).style("visibility",function(){return"hidden"})},Qb=function(a,b){(0===b.length||$("#cb_individ").is("checked")&&$("#cb_forpro").is("checked")&&$("#cb_nonpro").is("checked")&&$("#cb_gov").is("checked"))&&$(a).attr("checked",!1)};Nb();var Rb=function(){d3.selectAll("#cb_forpro, #cb_nonpro, #cb_gov, #cb_individ").on("click",function(){$("#cb_forpro").is(":checked")?Sb("For-Profit","visible"):Sb("For-Profit","hidden"),$("#cb_nonpro").is(":checked")?Sb("Non-Profit","visible"):Sb("Non-Profit","hidden"),$("#cb_gov").is(":checked")?Sb("Government","visible"):Sb("Government","hidden"),$("#cb_individ").is(":checked")?Sb("Individual","visible"):Sb("Individual","hidden");var a=Mb();Ub(a)})},Sb=function(a,b){d3.selectAll(".node").filter(function(b){return b.type===a?this:void 0}).style("visibility",b)},Tb=function(a,b,c,d){if(b.source.ID in c&&b.target.ID in c)switch(d){case"Funding":$("#cb_fund").is(":checked")?d3.select(a).style("visibility","visible"):d3.select(a).style("visibility","hidden");break;case"Investment":$("#cb_invest").is(":checked")?d3.select(a).style("visibility","visible"):d3.select(a).style("visibility","hidden");break;case"Collaboration":$("#cb_porucs").is(":checked")?d3.select(a).style("visibility","visible"):d3.select(a).style("visibility","hidden");break;case"Data":$("#cb_data").is(":checked")?d3.select(a).style("visibility","visible"):d3.select(a).style("visibility","hidden")}else d3.select(a).style("visibility","hidden")},Ub=function(a){Bb.filter(function(){Tb(this,this.__data__,a,"Funding")}),Cb.filter(function(){Tb(this,this.__data__,a,"Investment")}),Db.filter(function(){Tb(this,this.__data__,a,"Collaboration")}),Eb.filter(function(){Tb(this,this.__data__,a,"Data")}),Vb()},Vb=function(){var a=Bb.filter(function(){return"visible"===d3.select(this).style("visibility")}),b=Cb.filter(function(){return"visible"===d3.select(this).style("visibility")}),c=Db.filter(function(){return"visible"===d3.select(this).style("visibility")}),d=Eb.filter(function(){return"visible"===d3.select(this).style("visibility")});0===a[0].length&&$("#cb_fund").attr("checked",!1),0===b[0].length&&$("#cb_invest").attr("checked",!1),0===c[0].length&&$("#cb_porucs").attr("checked",!1),0===d[0].length&&$("#cb_data").attr("checked",!1)};Rb(),d3.selectAll("#cb_emp, #cb_numtwit").on("click",function(){document.getElementById("cb_emp").checked&&(Hb.transition().duration(350).delay(0).attr("r",function(a){return null!==a.employees?J(a.employees):"7"}),Gb.attr("transform",function(a){return null!==a.employees?c(0,-J(a.employees)):c(0,-7)})),document.getElementById("cb_numtwit").checked&&(Hb.transition().duration(350).delay(0).attr("r",function(a){return null!==a.followers?a.followers>1e6?"50":K(a.followers):"7"}),Gb.attr("transform",function(a){return null!==a.followers?c(0,-K(a.followers)):c(0,-7)}))}),d3.select("svg").on("click",function(){d3.mouse(this);if(1===w){d3.event.preventDefault(),pb(),d3.selectAll("g").classed("fixed",function(a){a.fixed=!1}),d3.selectAll("g").call(rb),y=jQuery.extend(!0,{},{});{d3.layout.force().nodes(ub).size([p,q]).links(zb).linkStrength(0).charge(function(a){return 1===a.render?null!==a.employees?-6*J(a.employees):-25:0}).linkDistance(50).on("tick",tb).start()}}w=1})})}function c(){var a=960,b=500,c=d3.geo.albers().scale(1e3).translate([a/2-40,b/2+30]),d=d3.geo.path().projection(c),e=d3.select(".content").append("svg").attr("width",a).attr("height",b).attr("id","map");d3.json("../data/us.json",function(a,b){e.insert("path",".graticule").datum(topojson.feature(b,b.objects.land)).attr("class","land").attr("d",d),e.insert("path",".graticule").datum(topojson.mesh(b,b.objects.states,function(a,b){return a!==b})).attr("class","state-boundary").attr("d",d);var f={};d3.json("../data/civicgeo.json",function(a,b){if(console.log("asdasd"),console.log(a),a)return console.warn(a);data=b,data.nodes.forEach(function(a){null!=a.coordinates&&a.coordinates.forEach(function(a){key=a[0]+":"+a[1],key in f?f[key]++:f[key]=1})});var d=0;locationData=[];for(var g in f){var h={};coor=g.split(":"),h.val=f[g],h.lat=coor[0],h.lon=coor[1],locationData[locationData.length]=h,h.val>d&&(d=h.val)}radiusScale=d3.scale.linear().domain([0,d]).range([3,10]),e.selectAll("circle").data(locationData).enter().append("circle").attr("cx",function(a){return c([a.lon,a.lat])[0]}).attr("cy",function(a){return c([a.lon,a.lat])[1]}).attr("r",function(a){return radiusScale(a.val)}).style("fill","red")})}),d3.select(self.frameElement).style("height",b+"px")}var d=a().view;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},"map"==d?(c(),document.getElementById("cb_mapview").checked=!0,document.getElementById("cb_networkview").checked=!1):"network"==d?(b(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0):(b(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0),d3.selectAll("#cb_networkview").on("click",function(){if(document.getElementById("cb_networkview").checked){b();var a=document.getElementById("map");a.parentNode.removeChild(a),console.log("asd")}}),d3.selectAll("#cb_mapview").on("click",function(){if(document.getElementById("cb_mapview").checked){var a=document.getElementById("network");a.parentNode.removeChild(a),c()}})}();