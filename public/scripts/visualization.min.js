!function(){function e(){for(var e={},t=window.location.search.substring(1),n=t.split("&"),i=0;i<n.length;i++){var l=n[i].split("=");if("undefined"==typeof e[l[0]])e[l[0]]=l[1];else if("string"==typeof e[l[0]]){var a=[e[l[0]],l[1]];e[l[0]]=a}else e[l[0]].push(l[1])}return e}function t(){function e(e,t){e.each(function(){for(var e,n=d3.select(this),i=n.text().split(/\s+/).reverse(),l=[],a=0,o=1.1,s=parseFloat(n.attr("dy")),r=d3.select(this)[0][0].__data__,c=n.text(null).append("tspan").attr("x",0).attr("y",function(){return null!==r.employees?G(r.employees)+10:17}).attr("dy",s+"em");e=i.pop();)l.push(e),c.text(l.join(" ")),c.node().getComputedTextLength()>t&&(l.pop(),c.text(l.join(" ")),l=[e],a++,c=n.append("tspan").attr("x",0).attr("y",function(){return null!==r.employees?G(r.employees)+5:12}).attr("dy",a*o+s+"em").text(e))})}function t(e){return"translate("+e.x+","+e.y+")"}function n(e,t){return"translate("+e+","+t+")"}function i(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2}var l,a,o,r,c,u,d,p,v,f,y=1e3,h=1e3,m={},g={},b={},k={},w=1,A={},E={},I={},C=[],F=[],S=[],L=d3.select(".content").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("id","network").attr("height",h).attr("width",y).style("top","-50px").style("position","relative");d3.select("body > nav > nav > div").append("div").attr("id","editBox").append("p").text("Edit").style("color","#2e92cf");var P=y/h,N=$("#network"),B=N.parent();$(window).on("resize",function(){var e=B.width();N.attr("width",e),N.attr("height",Math.round(e/P))}).trigger("resize");var q="0 0 "+y+" "+h;L.attr("viewBox",q).attr("preserveAspectRatio","xMidYMid");var G=d3.scale.sqrt().domain([10,13e4]).range([10,50]),Y=d3.scale.sqrt().domain([10,1e6]).range([10,50]);d3.json("/athena",function(x,P){function N(e){d3.select(this).classed("fixed",function(e){e.fixed=!1}),d3.select(this).on("mousedown.drag",null);{var t=(d3.select(this).data()[0],parseInt(L.style("width").substring(0,(L.style("width").length+1)/2))),n=parseInt(L.style("height").substring(0,(L.style("height").length+1)/2));parseInt(t/2),parseInt(n/2)}multiplierX=t/y,multiplierY=n/h,scaledDX=multiplierX*e.x,scaledDY=multiplierY*e.y,A=jQuery.extend(!0,{},e),A.x=y/2-10,A.y=h/2-60;d3.layout.force().nodes(bt).size([y,h]).links(At).linkStrength(0).charge(function(e){return 1===e.render?null!==e.employees?-6*G(e.employees):-25:0}).linkDistance(50).on("tick",gt).start()}function B(e){s=R(e),webform=D(e),d3.select("#edit").html(webform),d3.select("#info").html(s).style("list-style","square"),d3.selectAll("#editCurrentInfo").on("click",function(){q(e)}).on("mouseover",function(){return d3.select(this).style("cursor","pointer"),d3.select("#editBox").style("visibility","visible")}).on("mousemove",function(){return d3.select("#editBox").style("top",d3.event.pageY+4+"px").style("left",d3.event.pageX+16+"px")}).on("mouseout",function(){return d3.select("#editBox").style("visibility","hidden")})}function q(e){T(),st(e)}function D(){var e="";return e+='<h1 id="edit-add-info"><i class="icon-plus on-left"></i>Add Information</h1>'}function R(e){var t="";if(t+='<div style="height:30px"><a style="float:right;"><i id="editCurrentInfo" class="icon-pencil on-left"></i></a></div>',t+='<h1><a href="'+e.url+'" target="_blank">'+e.name+"</a></h1>",t+="<h6>Type of Entity: </h6> <h5>"+e.type+"</h5>",null!==e.location){t+="<br/><h6> Location:  </h6>";var n=[];if(-1!==e.location.indexOf("; ")){t+="<br/> <h5><ul>",n=e.location.split("; ");for(var l=0;l<n.length;l++)t+='<li style="display:block;"><h5><a class="click-location" style="cursor:pointer;">'+n[l]+"</h5></a></li>"}else t+="<h5><ul>",t+='<li style="display:inline-block;"><h5><a class="click-location" style="cursor:pointer;">'+e.location+"</h5></a></li>";t+="</h5></ul><br/>"}else t+="<br/><h6> Location:  </h6> <h5>N/A</h5><br/>";if("Individual"!==e.type&&(t+=null!==e.employees?"<h6>Employees: </h6> <h5>"+i(e.employees.toString())+"</h5><br/>":"<h6>Employees: </h6> <h5>N/A</h5><br/>"),null===e.twitter_handle)t+="<h6>Twitter:  </h6> <h5>N/A</h5><br/>",t+="<h6>Twitter Followers: </h6> <h5>N/A</h5><br/>";else{var a=e.twitter_handle.replace("@","");a="https://twitter.com/"+a,t+='<h6>Twitter:  </h6> <h5><a href="'+a+'" target="_blank">'+e.twitter_handle+"</h5></a><br/>",t+=null!==e.followers?"<h6>Twitter Followers:  </h6> <h5>"+i(e.followers.toString())+"</h5><br/>":"<h6>Twitter Followers:  </h6> <h5>N/A</h5><br/>"}if(null!==e.key_people){t+="<br/><h6>Key People:</h6><ul><h5>";for(var l=0;l<e.key_people.length;l++)t+='<li><a href="http://www.bing.com/search?q='+e.key_people[l].name.replace(" ","%20")+"%20"+e.nickname.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.key_people[l].name+"</a></li>";t+="</h5></ul>"}return null===e.funding_received?t+="<br/><h6>No known funding received.</h6><br/>":(t+="<br/><h6>Received funding from:</h6><ul>",e.funding_received.forEach(function(e){t+=0===e.amount||null===e.amount?'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>",null===e.year}),t+="</ul>"),null===e.funding_given?t+="<br/><h6>No known funding provided.</h6><br/>":(t+="<br/><h6>Gave funding to:</h6><ul>",e.funding_given.forEach(function(e){t+=0===e.amount||null===e.amount?'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>",null===e.year}),t+="</ul>"),null===e.investments_received?t+="<br/><h6>No known investments received.</h6><br/>":(t+="<br/><h6>Received investments from:</h6><ul>",e.investments_received.forEach(function(e){t+=0===e.amount||null===e.amount?'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>",null===e.year}),t+="</ul>"),null===e.investments_made?t+="<br/><h6>No known investments made.</h6><br/>":(t+="<br/><h6>Invested in:</h6><ul>",e.investments_made.forEach(function(e){t+=0===e.amount||null===e.amount?'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>",null===e.year}),t+="</ul>"),null===e.collaborations?t+="<br/><h6>No known collaborations.</h6><br/>":(t+="<br/><h6>Collaborated with:</h6><ul>",e.collaborations.forEach(function(e){t+='<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+"</a></h5></li>"}),t+="</ul>"),null===e.data?t+="<br/><h6>No known external data usage.</h6><br/>":(t+="<br/><h6>Obtained data from:</h6><ul>",e.data.forEach(function(e){t+='<li><h5><a href="http://www.bing.com/search?q='+e.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.entity+"</a></h5></li>"}),t+="</ul>"),null===e.revenue?t+="<br/><h6>No known revenue information.</h6><br/>":(t+="<br/><h6>Revenue:</h6><ul>",e.revenue.forEach(function(e){t+=0===e.amount||null===e.amount?null===e.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+e.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===e.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>":"<li><h5>"+e.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>"}),t+="</ul>"),null===e.expenses?t+="<br/><h6>No known expenses information.</h6><br/>":(t+="<br/><h6>Expenses:</h6><ul>",e.expenses.forEach(function(e){t+=0===e.amount||null===e.amount?null===e.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+e.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===e.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>":"<li><h5>"+e.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+i(e.amount.toString())+"</strong></li>"}),t+="</ul>"),it(e),t}function T(){d3.select("#edit-add-info").html('<i class=" icon-file on-left"></i>Reset Form').on("click",T),Ft.on("mouseover",null),sa=it(),d3.select("#info").html(sa),d3.select("datalist#list-name").html(v),d3.select("input#name").on("keyup",function(){M(this.value)}),d3.select("datalist#list-location").html(f),d3.select("input#location").on("keyup",function(){K(this.value)}),d3.select('#key-people-0 input[name="kpeople"]').on("keyup",function(){U(0)}),Q("#funding-0 datalist"),d3.select('#funding-0 input[name="fund"]').on("keyup",function(){X(0),W(this.value,"#funding-0 input")}),Q("#investing-0 datalist"),d3.select('#investing-0 input[name="invest"]').on("keyup",function(){H(0),W(this.value,"#investing-0 input")}),Q("#fundinggiven-0 datalist"),d3.select('#fundinggiven-0 input[name="fundgiven"]').on("keyup",function(){J(0),W(this.value,"#fundinggiven-0 input")}),Q("#investmentmade-0 datalist"),d3.select('#investmentmade-0 input[name="investmade"]').on("keyup",function(){V(0),W(this.value,"#investmentmade-0 input")}),Q("#data-0 datalist"),d3.select('#data-0 input[name="data"]').on("keyup",function(){Z(0),W(this.value,"#data-0 input")}),d3.select("#toFormC").on("click",function(){ot()}),d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),z()})}function O(){var e={type:null,categories:null,name:null,nickname:null,location:null,url:null,employees:null,key_people:null,twitter_handle:null,followers:null,relations:null,funding_received:null,investments_received:null,funding_given:null,investments_made:null,collaborations:null,data:null,revenue:null,expenses:null,influence:null};if(""===$('input[name="name"]').val()&&""===$('input[name="location"]').val())return{name:null,location:null,errorMessage:"The entity name and location have not been filled out."};if(""===$('input[name="name"]').val())return{name:null,errorMessage:"The entity name has not been filled out."};if(""===$('input[name="location"]').val())return{location:null,errorMessage:"The location has not been filled out."};e.type=$("input#rb_forpro").is(":checked")?"For-Profit":$("input#rb_nonpro").is(":checked")?"Non-Profit":$("input#rb_gov").is(":checked")?"Government":"Individual",e.name=d3.select(".webform-content input[name='name']")[0][0].value,e.categories=[],d3.selectAll(".webform-categories input").filter(function(){if(this.checked===!0)switch(this.value){case"General":e.categories.push("General Civic Tech");break;case"DataAnalytics":e.categories.push("Data & Analytics");break;case"EconGrowthEdu":e.categories.push("Jobs & Education");break;case"SRCities":e.categories.push("Smart & Resilient Cities");break;case"SocialServ":e.categories.push("Social Services");break;case"GovTech":e.categories.push("GovTech")}}),0===e.categories.length&&(e.categories=null),e.location=d3.select("input[name='location']")[0][0].value,e.url="",e.url=""===d3.select("input[name='website']")[0][0].value?null:d3.select("input[name='website']")[0][0].value,e.employees="",e.employees=""===d3.select("input[name='employees']")[0][0].value?null:parseInt(d3.select("input[name='employees']")[0][0].value),e.key_people=[],d3.selectAll(".kpeople").filter(function(){""!==this.value&&e.key_people.push(this.value)}),0===e.key_people.length&&(e.key_people=null),e.funding_received=[];var t;d3.selectAll(".fund-input .funder").filter(function(n,i){this.value&&(d3.selectAll(".fund_amt")[0][i].value?(t=d3.selectAll(".fund_amt")[0][i].value,e.funding_received.push(d3.selectAll(".fund_year")[0][i].value?{name:this.value,amount:t,year:d3.selectAll(".fund_year")[0][i].value}:{name:this.value,amount:t,year:null})):(t=null,e.funding_received.push(d3.selectAll(".fund_year")[0][i].value?{name:this.value,amount:t,year:d3.selectAll(".fund_year")[0][i].value}:{name:this.value,amount:t,year:null})))}),0===e.funding_received.length&&(e.funding_received=null),e.funding_given=[];var n;d3.selectAll(".fundgiven-input .fundee").filter(function(t,i){this.value&&(d3.selectAll(".fundgiven_amt")[0][i].value?(n=d3.selectAll(".fundgiven_amt")[0][i].value,e.funding_given.push(d3.selectAll(".fundgiven_year")[0][i].value?{name:this.value,amount:n,year:d3.selectAll(".fundgiven_year")[0][i].value}:{name:this.value,amount:n,year:null})):(n=null,e.funding_given.push(d3.selectAll(".fundgiven_year")[0][i].value?{name:this.value,amount:n,year:d3.selectAll(".fundgiven_year")[0][i].value}:{name:this.value,amount:n,year:null})))}),0===e.funding_given.length&&(e.funding_given=null),e.investments_received=[];var i;d3.selectAll(".invest-input .investor").filter(function(t,n){this.value&&(d3.selectAll(".invest_amt")[0][n].value?(i=d3.selectAll(".invest_amt")[0][n].value,e.investments_received.push(d3.selectAll(".invest_year")[0][n].value?{name:this.value,amount:i,year:d3.selectAll(".invest_year")[0][n].value}:{name:this.value,amount:i,year:null})):(i=null,e.investments_received.push(d3.selectAll(".invest_year")[0][n].value?{name:this.value,amount:i,year:d3.selectAll(".invest_year")[0][n].value}:{name:this.value,amount:i,year:null})))}),0===e.investments_received.length&&(e.investments_received=null),e.investments_made=[];var l;return d3.selectAll(".investmade-input .investee").filter(function(t,n){this.value&&(d3.selectAll(".investmade_amt")[0][n].value?(l=d3.selectAll(".investmade_amt")[0][n].value,e.investments_made.push(d3.selectAll(".investmade_year")[0][n].value?{name:this.value,amount:l,year:d3.selectAll(".investmade_year")[0][n].value}:{name:this.value,amount:l,year:null})):(l=null,e.investments_made.push(d3.selectAll(".investmade_year")[0][n].value?{name:this.value,amount:l,year:d3.selectAll(".investmade_year")[0][n].value}:{name:this.value,amount:l,year:null})))}),0===e.investments_made.length&&(e.investments_made=null),e.data=[],d3.selectAll(".data-entity").filter(function(){""!==this.value&&e.data.push(this.value)}),0===e.data.length&&(e.data=null),e}function j(e){e.nickname=d3.select(".webform-content input[name='nickname']")[0][0].value,e.nickname||(e.nickname=e.name),e.twitter_handle=d3.select(".webform-content input[name='twitterhandle']")[0][0].value,e.twitter_handle||(e.twitter_handle=null),e.influence=$(".webform-influence input#rb_local").is(":checked")?"local":"global",e.collaborations=[],d3.selectAll(".collaborator").filter(function(){this.value&&e.collaborations.push(this.value)}),0===e.collaborations.length&&(e.collaborations=null),e.revenue=[];var t;d3.selectAll(".revenue-input .revenue_amt").filter(function(n,i){this.value&&(t=d3.selectAll(".revenue-input .revenue_year")[0][i].value,e.revenue.push(t?{amount:this.value,year:t}:{amount:this.value,year:null}))}),0===e.revenue.length&&(e.revenue=null),e.expenses=[];var n;return d3.selectAll(".expense-input .expense_amt").filter(function(t,i){this.value&&(n=d3.selectAll(".expense-input .expense_year")[0][i].value,e.expenses.push(n?{amount:this.value,year:n}:{amount:this.value,year:null}))}),0===e.expenses.length&&(e.expenses=null),e}function z(){var e=O();e.location&&e.name?(counterKey=0,counterK=0,counterFund=0,counterF=0,s='<h2 id="webform-head">Information</h2><hr/><div class="webform-content"><div class="input-control text" data-role="input-control"><input type="text" name="name" id="name" placeholder="Name of Entity"/></div><h3 class="form-header">Entity Type</h3><div class="webform-entities"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span><h4 class="webform-labels">For-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span><h4 class="webform-labels">Non-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span><h4 class="webform-labels">Government</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span><h4 class="webform-labels">Individual</h4></label></div></div><div class="input-control text" data-role="input-control"><input type="text" name="location" id="location" placeholder="City, State"/></div>',s+='<hr/><div class = "input-control text" data-role="input-control"><input type="text" name="nickname" id="nickname" placeholder="Nickname/Abbr."/></div><div class = "input-control text" data-role="input-control"><input type="text" name="twitterhandle" id="twitterhandle" placeholder="Twitter Handle"/></div><h3 class="form-header" style="display:inline-block;">Circle of Influence: </h3><div class="webform-influence"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_local" type="radio" name="influence-type" value="Local Influence" checked="checked"/><span class="check"></span><h4 class="webform-labels">Local Influence</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_global" type="radio" name="influence-type" value="Global Influence" checked="checked"/><span class="check"></span><h4 class="webform-labels">Global Influence</h4></label></div></div><h3 class="form-header">Collaboration</h3><div id="collaboration-0" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div><h3 class="form-header">Revenue</h3><div id="revenue-0"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Expenses</h3><div id="expense-0"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><button type="button" id="submit-B" href="javascript: check_empty()">Submit</button></div>',d3.select("#info").html(s),Q("#collaboration-0 datalist"),d3.selectAll("#name").text(function(){this.value=e.name}).attr("disabled",!0),d3.selectAll("#location").text(function(){this.value=e.location}).attr("disabled",!0).style("margin-top","10px"),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===e.type?!0:!1,this.disabled=!0}),d3.selectAll('input[name="collaboration"]').on("keyup",function(){et(0),W(this.value,"#collaboration-0 input")}),d3.selectAll('input[name="revenue_amt"]').on("keyup",function(){tt(0)}),d3.selectAll('input[name="expense_amt"]').on("keyup",function(){nt(0)}),d3.selectAll("#submit-B").on("click",function(){at(e)})):e.name||e.location?e.name?d3.select("#location").style("border-color","#e51400"):d3.select("#name").style("border-color","#e51400"):(d3.select("#name").style("border-color","#e51400"),d3.select("#location").style("border-color","#e51400"))}function Q(e){d3.select(e).html(v)}function W(e,t){e.toLowerCase()in E&&d3.selectAll(t).text(function(){this.value=E[e].name})}function M(e){e=e.toLowerCase(),e in E&&(T(),st(E[e]))}function K(e){e.toLowerCase()in I&&d3.selectAll("#location").text(function(){this.value=I[e][0].location})}function U(e){""!==$("#key-people-"+e+' input[name="kpeople"]').val()&&(d3.select("#key-people-"+e+' input[name="kpeople"]').on("keyup",null),e++,$("#key-people-"+(e-1)).after('<div id="key-people-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div>'),d3.select("#key-people-"+e+" input[name='kpeople']").on("keyup",function(){U(e)}))}function X(e){""!==$("#funding-"+e+' input[name="fund"]').val()&&(d3.select("#funding-"+e+' input[name="fund"]').on("keyup",function(){W(this.value,"#funding-"+(e-1)+' input[name="fund"]')}),e++,$("#funding-"+(e-1)).after('<div id="funding-'+e+'"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#funding-"+e+" datalist"),d3.select("#funding-"+e+" input[name='fund']").on("keyup",function(){X(e)}))}function H(e){""!==$("#investing-"+e+' input[name="invest"]').val()&&(d3.select("#investing-"+e+' input[name="invest"]').on("keyup",function(){W(this.value,"#investing-"+(e-1)+' input[name="invest"]')}),e++,$("#investing-"+(e-1)).after('<div id="investing-'+e+'"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#investing-"+e+" datalist"),d3.select("#investing-"+e+" input[name='invest']").on("keyup",function(){H(e)}))}function J(e){""!==$("#fundinggiven-"+e+' input[name="fundgiven"]').val()&&(d3.select("#fundinggiven-"+e+' input[name="fundgiven"]').on("keyup",function(){W(this.value,"#fundinggiven-"+(e-1)+' input[name="fundgiven"]')}),e++,$("#fundinggiven-"+(e-1)).after('<div id="fundinggiven-'+e+'"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#fundinggiven-"+e+" datalist"),d3.select("#fundinggiven-"+e+" input[name='fundgiven']").on("keyup",function(){J(e)}))}function V(e){""!==$("#investmentmade-"+e+' input[name="investmade"]').val()&&(d3.select("#investmentmade-"+e+' input[name="investmade"]').on("keyup",function(){W(this.value,"#investmentmade-"+(e-1)+' input[name="investmade"]')}),e++,$("#investmentmade-"+(e-1)).after('<div id="investmentmade-'+e+'"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#investmentmade-"+e+" datalist"),d3.select("#investmentmade-"+e+" input[name='investmade']").on("keyup",function(){V(e)}))}function Z(e){""!==$("#data-"+e+' input[name="data"]').val()&&(d3.select("#data-"+e+' input[name="data"]').on("keyup",function(){W(this.value,"#data-"+(e-1)+' input[name="data"]')}),e++,$("#data-"+(e-1)).after('<div id="data-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div>'),Q("#data-"+e+" datalist"),d3.select("#data-"+e+" input[name='data']").on("keyup",function(){Z(e)}))}function et(e){""!==$("#collaboration-"+e+' input[name="collaboration"]').val()&&(d3.select("#collaboration-"+e+' input[name="collaboration"]').on("keyup",function(){W(this.value,"#collaboration-"+(e-1)+' input[name="collaboration"]')}),e++,$("#collaboration-"+(e-1)).after('<div id="collaboration-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div>'),Q("#collaboration-"+e+" datalist"),d3.select("#collaboration-"+e+" input[name='collaboration']").on("keyup",function(){et(e)}))}function tt(e){""!==$("#revenue-"+e+' input[name="revenue_amt"]').val()&&(d3.select("#revenue-"+e+' input[name="revenue_amt"]').on("keyup",null),e++,$("#revenue-"+(e-1)).after('<div id="revenue-'+e+'"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#revenue-"+e+" input[name=revenue_amt]").on("keyup",function(){tt(e)}))}function nt(e){""!==$("#expense-"+e+' input[name="expense_amt"]').val()&&(d3.select("#expense-"+e+' input[name="expense_amt"]').on("keyup",null),e++,$("#expense-"+(e-1)).after('<div id="expense-'+e+'"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#expense-"+e+" input[name=expense_amt]").on("keyup",function(){nt(e)}))}function it(){return s='<h2 id="webform-head">Information</h2><hr/><div class="webform-content"><div class="input-control text" data-role="input-control"><input type="text" name="name" id="name" placeholder="Name of Entity" list="list-name"/><datalist id="list-name"></datalist></div><h3 class="form-header">What type of entity?</h3><div class="webform-entities"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span><h4 class="webform-labels">For-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span><h4 class="webform-labels">Non-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span><h4 class="webform-labels">Government</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span><h4 class="webform-labels">Individual</h4></label></div></div><h3 class="form-header">What kind of work do they do?</h3><h4>(Select All That Apply)</h4><div class="webform-categories"><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_gen" type="checkbox" name="gen" data-show="general" value="General"/><span class="check"></span><h4 class="webform-labels">General Civic Tech</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_datat" type="checkbox" name="datat" data-show="datalytics" value="DataAnalytics"/><span class="check"></span><h4 class="webform-labels">Data & Analytics</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_eced" type="checkbox" name="eced" data-show="econedu" value="EconGrowthEdu"/><span class="check"></span><h4 class="webform-labels">Jobs & Education</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_src" type="checkbox" name="srcities" data-show="srcities" value="SRCities"/><span class="check"></span><h4 class="webform-labels">Smart & Resilient Cities</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_socs" type="checkbox" name="socserv" data-show="socserv" value="SocialServ"/><span class="check"></span><h4 class="webform-labels">Social Services</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_govt" type="checkbox" name="govtech" data-show="govtech" value="GovTech"/><span class="check"></span><h4 class="webform-labels">GovTech</h4></label></div></div><div class="input-control text" data-role="input-control"><input type="text" name="location" id="location" placeholder="City, State" list="list-location"/><datalist id="list-location"></datalist></div><div class="input-control text" data-role="input-control"><input type="text" name="website" id="website" placeholder="Website"/></div><h3 class="form-header" style="display:inline-block;">Number of Employees</h3><div class="input-control text" data-role="input-control" style="width:27% !important; display:inline-block; float:right; margin-top: 2%;"><input type="text" name="employees" id="employee" maxlength="6" style="width:100% !important;"/></div><h3 class="form-header">Key People?</h3><div id="key-people-0" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div><h3 class="form-header">Who funds them via grants?</h3><div id="funding-0"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who invests in them via equity stakes (stock)?</h3><div id="investing-0"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they fund via grants?</h3><div id="fundinggiven-0"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they invest in via equity stakes (stock)?</h3><div id="investmentmade-0"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who provides them with data?</h3><div id="data-0" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div><div id="nextPhase"><button type="button" id="submit-A" href="javascript: check_empty()">Next</button></div></div><hr/><div class="webform-footer"><span id="">Some entities lack adequate information. Would you like to help?</span><br/><span id="toFormC">Click here!</span></div>',s
}function lt(){var e=0,t=[];l.forEach(function(n){_.object(_.map(n,function(t,n){return null===t&&e++,[n,t]}));"Individual"===n.type&&(e-=4),t.push({name:n.name,nullFields:e}),e=0});var n=_.max(t,function(e){return e.nullFields}),i=[];t.forEach(function(e){if(e.nullFields<=n.nullFields&&e.nullFields>=n.nullFields-7){var t=_.find(l,function(t){return e.name===t.name});i.push(t)}});for(var a=[];a.length<5;){var o=Math.floor(Math.random()*i.length);-1===a.indexOf(i[o])&&a.push(i[o])}return a}function at(e){var t=j(e);ot(),console.log(t),console.log($.param(t)),$.ajax({type:"POST",data:$.param(t),url:"/database/save",crossDomain:!0}).done(function(){})}function ot(){var e="";e+='<h2 id="webform-head">Information</h2><hr/><div style="text-align:center;" class="webform-content"><p>Thank you for contributing to Civic Graph! Refresh the page to view your changes (it might take a few moments).</p><p>Would you like to add or edit more info?</p>',e+='<ul id="suggestions">';var t=lt();t.forEach(function(t){e+='<li><a style="cursor:pointer;">'+t.name+"</a></li>"}),e+="</ul></div>",d3.select("#info").html(e),d3.selectAll("#info ul a").on("click",function(e,n){yt(t[n]),T(),st(t[n])})}function st(e){if(d3.selectAll("#name").text(function(){this.value=e.name}),d3.selectAll("#location").text(function(){this.value=e.location}),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===e.type?!0:!1}),null!==e.categories&&d3.selectAll(".webform-categories input").filter(function(t,n){this.checked=e.categories.indexOf(d3.selectAll(".webform-categories h4")[0][n].textContent)>-1?!0:!1}),d3.selectAll("#website").text(function(){this.value=e.url}),d3.selectAll("#employee").text(function(){this.value=e.employees}),null!==e.key_people){for(var t=e.key_people,n=0;n<t.length;n++)$("#key-people-"+n).after('<div id="key-people-'+(n+1)+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name""/></div>'),d3.select("#key-people-"+n+' input[name="kpeople"]').on("keyup",null),d3.select("#key-people-"+n+' input[name="kpeople"]').text(function(){this.value=t[n].name});d3.select("#key-people-"+t.length+' input[name="kpeople"]').on("keyup",function(){U(t.length)})}if(null!==e.funding_received){var i=e.funding_received;i.forEach(function(e,t){$("#funding-"+t).after('<div id="funding-'+(t+1)+'"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#funding-"+t+" datalist"),d3.select("#funding-"+t+' input[name="fund"]').on("keyup",function(){W(this.value,"#funding-"+t+' input[name="fund"]')}),d3.select("#funding-"+t+' input[name="fund"]').text(function(){this.value=e.entity}),d3.select("#funding-"+t+' input[name="fund_amt"]').text(function(){this.value=e.amount}),d3.select("#funding-"+t+' input[name="fund_year"]').text(function(){this.value=e.year})}),d3.select("#funding-"+i.length+" input[name='fund']").on("keyup",function(){X(i.length)})}if(null!==e.funding_given){var l=e.funding_given;l.forEach(function(e,t){$("#fundinggiven-"+t).after('<div id="fundinggiven-'+(t+1)+'"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#fundinggiven-"+t+" datalist"),d3.select("#fundinggiven-"+t+' input[name="fundgiven"]').on("keyup",function(){W(this.value,"#fundinggiven-"+t+' input[name="fundgiven"]')}),d3.select("#fundinggiven-"+t+' input[name="fundgiven"]').text(function(){this.value=e.entity}),d3.select("#fundinggiven-"+t+' input[name="fundgiven_amt"]').text(function(){this.value=e.amount}),d3.select("#fundinggiven-"+t+' input[name="fundgiven_year"]').text(function(){this.value=e.year})}),d3.select("#fundinggiven-"+l.length+" input[name='fundgiven']").on("keyup",function(){J(l.length)})}if(null!==e.investments_received){var a=e.investments_received;a.forEach(function(e,t){$("#investing-"+t).after('<div id="investing-'+(t+1)+'"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#investing-"+t+" datalist"),d3.select("#investing-"+t+' input[name="invest"]').on("keyup",function(){W(this.value,"#investing-"+t+' input[name="invest"]')}),d3.select("#investing-"+t+' input[name="invest"]').text(function(){this.value=e.entity}),d3.select("#investing-"+t+' input[name="invest_amt"]').text(function(){this.value=e.amount}),d3.select("#investing-"+t+' input[name="invest_year"]').text(function(){this.value=e.year})}),d3.select("#investing-"+a.length+" input[name='invest']").on("keyup",function(){H(a.length)})}if(null!==e.investments_made){var o=e.investments_made;o.forEach(function(e,t){$("#investmentmade-"+t).after('<div id="investmentmade-'+(t+1)+'"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),Q("#investmentmade-"+t+" datalist"),d3.select("#investmentmade-"+t+' input[name="investmade"]').on("keyup",function(){W(this.value,"#investmentmade-"+t+' input[name="investmade"]')}),d3.select("#investmentmade-"+t+' input[name="investmade"]').text(function(){this.value=e.entity}),d3.select("#investmentmade-"+t+' input[name="investmade_amt"]').text(function(){this.value=e.amount}),d3.select("#investmentmade-"+t+' input[name="investmade_year"]').text(function(){this.value=e.year})}),d3.select("#investmentmade-"+o.length+" input[name='investmade']").on("keyup",function(){V(o.length)})}if(null!==e.data){var s=e.data;s.forEach(function(e,t){$("#data-"+t).after('<div id="data-'+(t+1)+'" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div>'),Q("#data-"+t+" datalist"),d3.select("#data-"+t+' input[name="data"]').on("keyup",function(){W(this.value,"#data-"+t+' input[name="data"]')}),d3.select("#data-"+t+' input[name="data"]').text(function(){this.value=e.entity})}),d3.select("#data-"+s.length+" input[name='data']").on("keyup",function(){Z(s.length)})}d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),z(),rt(e)})}function rt(e){if(d3.selectAll("#nickname").text(function(){this.value=e.nickname}),d3.selectAll("#twitterhandle").text(function(){this.value=e.twitter_handle}),d3.selectAll('input[name="influence-type"]').filter(function(){this.checked="local"===e.influence&&"Local Influence"===this.value?!0:"global"===e.influence&&"Global Influence"===this.value?!0:!1}),null!==e.collaborations){var t=e.collaborations;t.forEach(function(e,t){$("#collaboration-"+t).after('<div id="collaboration-'+(t+1)+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator" list="collaborator-list"/><datalist id="collaborator-list"></datalist></div>'),Q("#collaboration-"+t+" datalist"),d3.select("#collaboration-"+t+' input[name="collaboration"]').on("keyup",function(){W(this.value,"#collaboration-"+t+' input[name="collaboration"]')}),d3.select("#collaboration-"+t+' input[name="collaboration"]').text(function(){this.value=e.entity})}),d3.select("#collaboration-"+t.length+' input[name="collaboration"]').on("keyup",function(){et(t.length)})}if(null!==e.expenses){var n=e.expenses;n.forEach(function(e,t){$("#expense-"+t).after('<div id="expense-'+(t+1)+'"><div class="expense-input input-control text" data-role="input-control"><input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#expense-"+t+' input[name="expense_amt"]').on("keyup",null),d3.select("#expense-"+t+' input[name="expense_amt"]').text(function(){this.value=e.amount}),d3.select("#expense-"+t+' input[name="expense_year"]').text(function(){this.value=e.year})}),d3.select("#expense-"+n.length+' input[name="expense_amt"]').on("keyup",function(){nt(n.length)})}if(null!==e.revenue){var i=e.revenue;i.forEach(function(e,t){$("#revenue-"+t).after('<div id="revenue-'+(t+1)+'"><div class="revenue-input input-control text" data-role="input-control"><input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/><input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div>'),d3.select("#revenue-"+t+' input[name="revenue_amt"]').on("keyup",null),d3.select("#revenue-"+t+' input[name="revenue_amt"]').text(function(){this.value=e.amount}),d3.select("#revenue-"+t+' input[name="revenue_year"]').text(function(){this.value=e.year})}),d3.select("#revenue-"+i.length+' input[name="revenue_amt"]').on("keyup",function(){tt(i.length)})}}function ct(){for(var e="",t=[0,0,0,0],n=[],i=[],a=[],o=[],s=0;s<l.length;s++)"Individual"===l[s].type&&(o.push(l[s].name),Nt.push(l[s]),t[3]++),"Non-Profit"===l[s].type&&(i.push(l[s].name),Lt.push(l[s]),t[1]++),"For-Profit"===l[s].type&&(n.push(l[s].name),St.push(l[s]),t[0]++),"Government"===l[s].type&&(a.push(l[s].name),Pt.push(l[s]),t[2]++);e+="<h3 style='padding-bottom:10px;'>The Data</h3>",d3.select("#info").html(e).style("list-style","square"),d3.select("#info").append("div").attr("id","breakdown").style("width","100%");var s=d3.scale.linear().domain([0,d3.max(t)]).range([0,$("#breakdown").width()]),r=0,c=0;d3.select("#breakdown").selectAll("div").data(t).enter().append("div").style("width",function(e){return s(e)/5+"%"}).style("height","20px").style("font","8px sans-serif").style("background-color",function(){return 0===r?(r++,"rgb(127,186,0)"):1===r?(r++,"rgb(0,164,239)"):2===r?(r++,"rgb(242,80,34)"):3===r?(r++,"rgb(255,185,0)"):void 0}).style("text-align","right").style("padding","3px").style("margin","1px").style("color","white").text(function(){return 0===c?void c++:1===c?void c++:2===c?void c++:3===c?void c++:void 0});var u="";u+="<h3 style='padding-top:15px; color:rgb(127,186,0);'>For-Profit ("+t[0]+"):</h3> ";for(var s=0;s<n.length;s++)u+=s===n.length-1?"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[s]+"</a>":"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[s]+", </a>";u+="<h3 style='padding-top:15px; color:rgb(0,164,239);'>Non-Profit ("+t[1]+"):</h3> ";for(var s=0;s<i.length;s++)u+=s===i.length-1?"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[s]+"</a>":"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[s]+", </a>";u+="<h3 style='padding-top:15px; color:rgb(242,80,34);'>Government ("+t[2]+"):</h3> ";for(var s=0;s<a.length;s++)u+=s===a.length-1?"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+a[s]+"</a>":"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+a[s]+", </a>";u+="<h3 style='padding-top:15px; color:rgb(255,185,0);'>Individual ("+t[3]+"):</h3> ";for(var s=0;s<o.length;s++)u+=s===o.length-1?"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+o[s]+"</a>":"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+o[s]+", </a>";d3.select("#info").append("text").style("padding-bottom","20px").html(u)}function ut(){var e="";l.forEach(function(e){name=e.name.toLowerCase(),nickname=e.nickname.toLowerCase();var t=e.location.split("; ");name in E||(E[name]=e,C.push(e.name)),nickname in E||(E[nickname]=e,C.push(e.nickname)),t.forEach(function(t){var n=t.toLowerCase();n in I?I[n].push(e):(I[n]=[],I[n].push(e),F.push(t))})}),C=_.sortBy(C,function(e){return e.toLowerCase()}),F=_.sortBy(F,function(e){return e.toLowerCase()}),S=_.sortBy(C.concat(F),function(e){return e});for(var t=0;t<S.length;t++)e+='<option value="'+S[t]+'">';d3.select(".filter-name-location datalist").html(e)}function dt(e){e=e.toLowerCase(),e in E&&yt(E[e]),e in I&&(fundLink.style("opacity",function(t){return t.source.location.toLowerCase()===e&&t.target.location.toLowerCase()===e?1:.05}),$t.style("opacity",function(t){return t.source.location.toLowerCase()===e&&t.target.location.toLowerCase()===e?1:.05}),porucsLink.style("opacity",function(t){return t.source.location.toLowerCase()===e&&t.target.location.toLowerCase()===e?1:.05}),It.style("opacity",function(t){return t.source.location.toLowerCase()===e&&t.target.location.toLowerCase()===e?1:.05}),d3.selectAll("circle").style("stroke","white"),d3.selectAll(".node").style("opacity",function(t){return-1===t.location.toLowerCase().indexOf(e)?.05:1}).select("text").style("opacity",1),Ft.on("mouseout",null).on("mouseover",null).on("click",null),Ft.filter(function(e,t){return 1==nodeInit[0][t].style.opacity}).on("mouseover",B))}function pt(e){for(var t="",n=0;n<e.length;n++)t+='<option value="'+e[n]+'">';return t}function vt(e){var t=R(e);webform=D(e),d3.select("#edit").html(webform),d3.select("#info").html(t).style("list-style","square"),fundLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?1:.05}),$t.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?1:.05}),porucsLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?1:.05}),It.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?1:.05});var n=function(e,t){return e.target.index===t.index},i=function(e,t){return e.source.index===t.index},l={};l[e.ID]=1,fundingConnections.forEach(function(t){i(t,e)&&(l[t.target.index]=1),n(t,e)&&(l[t.source.index]=1)}),p.forEach(function(t){i(t,e)&&(l[t.target.index]=1),n(t,e)&&(l[t.source.index]=1)}),u.forEach(function(t){i(t,e)&&(l[t.target.index]=1),n(t,e)&&(l[t.source.index]=1)}),d.forEach(function(t){i(t,e)&&(l[t.target.index]=1),n(t,e)&&(l[t.source.index]=1)}),d3.select(this).style("stroke","rgba(0,0,0,0.6)"),L.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(e){return e.ID in l?"1":"0.05"}).select("text").style("opacity",1),d3.select(this.parentNode).select("text").transition().duration(350).delay(0).style("opacity",1).style("font-weight","bold")}function ft(){Ft.style("stroke","white").on("mouseover",vt).on("mouseout",ft).on("click",yt),fundLink.transition().duration(350).delay(0).style("stroke","rgb(111,93,168)").style("opacity","0.2").style("stroke-width","1px"),$t.transition().duration(350).delay(0).style("stroke","rgb(38,114,114)").style("opacity","0.2").style("stroke-width","1px"),porucsLink.transition().duration(350).delay(0).style("stroke","rgb(235,232,38)").style("opacity","0.2").style("stroke-width","1px"),It.transition().duration(350).delay(0).style("stroke","rgb(191,72,150)").style("opacity","0.2").style("stroke-width","1px"),d3.selectAll(".node").transition().duration(350).delay(0).style("opacity","1"),d3.selectAll(".node").selectAll("text").transition().duration(350).delay(0).style("opacity",function(e){var t;return"For-Profit"===e.type&&(t=m.hasOwnProperty(e.name)?1:0),"Non-Profit"===e.type&&(t=g.hasOwnProperty(e.name)?1:0),"Individual"===e.type&&(t=b.hasOwnProperty(e.name)?1:0),"Government"===e.type&&(t=k.hasOwnProperty(e.name)?1:0),t}).style("font-size","14px").style("font-weight","normal")}function yt(e){w=0,B(e),fundLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),$t.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),porucsLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),It.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),Ft.style("stroke",function(t){return t!==e?"white":"black"}).on("mouseout",null),Ft.filter(function(t){return t!==e?t:void 0}).on("mouseover",null);var t=P.funding_connections.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),n=P.investment_connections.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),i=P.collaboration_connections.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),l=P.data_connections.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index});L.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(a){return t.indexOf(a.index)>-1||n.indexOf(a.index)>-1||i.indexOf(a.index)>-1||l.indexOf(a.index)>-1||a===e?1:.05}).select("text").style("opacity",1),Ft.filter(function(a){return t.indexOf(a.index)>-1||n.indexOf(a.index)>-1||i.indexOf(a.index)>-1||l.indexOf(a.index)>-1||a===e}).on("mouseover",B).on("click",function(){})}function ht(){Ft.on("mouseover",null).on("mouseout",null).on("click",null)}function mt(){d3.select(this).classed("fixed",function(e){e.fixed=!0}),Ft.on("mouseover",vt).on("mouseout",ft).on("click",yt)}function gt(e){var n=8*e.alpha;l.forEach(function(e){null!==e.type&&("Individual"===e.type&&(e.x+=n+n,e.y+=n+n),"Non-Profit"===e.type&&(e.x+=-n-n,e.y+=n+n),"For-Profit"===e.type&&(e.x+=n+n,e.y+=-n-n),"Government"===e.type&&(e.x+=-n-n,e.y+=-n-n))}),_.isEmpty(A)?(fundLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),$t.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),porucsLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),It.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),Ft.attr("cx",function(e){return e.x=e.x}).attr("cy",function(e){return e.y=e.y}),Ct.attr("transform",t)):(fundLink.attr("x1",function(e){return e.source===A?(e.source.x=A.x,e.source.x):e.source.x}).attr("y1",function(e){return e.source===A?(e.source.y=A.y,e.source.y):e.source.y}).attr("x2",function(e){return e.target===A?(e.target.x=A.x,e.target.x):e.target.x}).attr("y2",function(e){return e.target===A?(e.target.y=A.y,e.target.y):e.target.y}),$t.attr("x1",function(e){return e.source===A?(e.source.x=A.x,e.source.x):e.source.x}).attr("y1",function(e){return e.source===A?(e.source.y=A.y,e.source.y):e.source.y}).attr("x2",function(e){return e.target===A?(e.target.x=A.x,e.target.x):e.target.x}).attr("y2",function(e){return e.target===A?(e.target.y=A.y,e.target.y):e.target.y}),porucsLink.attr("x1",function(e){return e.source===A?(e.source.x=A.x,e.source.x):e.source.x}).attr("y1",function(e){return e.source===A?(e.source.y=A.y,e.source.y):e.source.y}).attr("x2",function(e){return e.target===A?(e.target.x=A.x,e.target.x):e.target.x}).attr("y2",function(e){return e.target===A?(e.target.y=A.y,e.target.y):e.target.y}),It.attr("x1",function(e){return e.source===A?(e.source.x=A.x,e.source.x):e.source.x}).attr("y1",function(e){return e.source===A?(e.source.y=A.y,e.source.y):e.source.y}).attr("x2",function(e){return e.target===A?(e.target.x=A.x,e.target.x):e.target.x}).attr("y2",function(e){return e.target===A?(e.target.y=A.y,e.target.y):e.target.y}),Ft.attr("cx",function(e,t){return d3.select(Ft)[0][0].data()[t].name===A.name?(e.x=A.x,e.x):e.x=e.x}).attr("cy",function(e,t){return d3.select(Ft)[0][0].data()[t].name===A.name?(e.y=A.y,e.y):e.y=e.y}),Ct.attr("transform",t))}var bt=P.nodes,xt=P.funding_connections,kt=P.investment_connections,wt=P.collaboration_connections,_t=P.data_connections,At=xt.concat(kt).concat(wt).concat(_t);l=bt.filter(function(e){return 1===e.render}),fundingConnections=xt.filter(function(e){return 1===e.render}),p=kt.filter(function(e){return 1===e.render}),u=wt.filter(function(e){return 1===e.render}),d=_t.filter(function(e){return 1===e.render});var Et=(fundingConnections.concat(p).concat(u).concat(d),d3.layout.force().nodes(bt).size([y,h]).links(At).linkStrength(0).charge(function(e){return 1===e.render?null!==e.employees?-6*G(e.employees):-25:0}).linkDistance(50)),ht=Et.drag().on("dragstart",ht).on("drag",ht).on("dragend",mt);fundLink=L.selectAll(".fund").data(fundingConnections).enter().append("line").attr("class","fund").style("stroke","rgb(111,93,168)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible");var $t=L.selectAll(".invest").data(p).enter().append("line").attr("class","invest").style("stroke","rgb(38,114,114)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible");porucsLink=L.selectAll(".porucs").data(u).enter().append("line").attr("class","porucs").style("stroke","rgb(235,232,38)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible");var It=L.selectAll(".data").data(d).enter().append("line").attr("class","data").style("stroke","rgb(191,72,150)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible");nodeInit=L.selectAll(".node").data(l).enter().append("g").attr("class","node").style("visibility","visible").on("dblclick",N).call(ht),Et.on("tick",gt).start(),a=L.selectAll(".node").filter(function(e){return"For-Profit"===e.type}).sort(function(e,t){return e.weight-t.weight}),o=L.selectAll(".node").filter(function(e){return"Non-Profit"===e.type}).sort(function(e,t){return e.weight-t.weight}),r=L.selectAll(".node").filter(function(e){return"Individual"===e.type}).sort(function(e,t){return e.weight-t.weight}),c=L.selectAll(".node").filter(function(e){return"Government"===e.type}).sort(function(e,t){return e.weight-t.weight}),a.each(function(e,t){t>=a[0].length-5&&(m[e.name]=e.weight)}),o.each(function(e,t){t>=o[0].length-5&&(g[e.name]=e.weight)}),r.each(function(e,t){t>=r[0].length-5&&(b[e.name]=e.weight)}),c.each(function(e,t){t>=c[0].length-5&&(k[e.name]=e.weight)});var Ct=L.selectAll(".node").append("text").text(function(e){return e.nickname}).attr("x",0).attr("dy","0.1em").attr("y",function(e){return null!==e.employees?G(e.employees)+10:17}).style("opacity",function(e){var t;return"For-Profit"===e.type&&(t=m.hasOwnProperty(e.name)?1:0),"Non-Profit"===e.type&&(t=g.hasOwnProperty(e.name)?1:0),"Individual"===e.type&&(t=b.hasOwnProperty(e.name)?1:0),"Government"===e.type&&(t=k.hasOwnProperty(e.name)?1:0),t}).style("font-size","14px").style("color","#FFFFFF").style("pointer-events","none"),Ft=nodeInit.append("circle").attr("r",function(e){return null!==e.employees?G(e.employees):"7"}).style("fill",function(e){if(null!==e.type){if("Individual"===e.type)return"rgb(255,185,0)";if("Non-Profit"===e.type)return"rgb(0,164,239)";if("For-Profit"===e.type)return"rgb(127,186,0)";if("Government"===e.type)return"rgb(242,80,34)"}}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).style("stroke-width","1.5px").style("stroke","white").on("mouseover",vt).on("mouseout",ft).on("click",yt);for(Ct.call(e,80);Et.alpha()>.025;)Et.tick();d3.selectAll("#edit").on("click",T);var St=[],Lt=[],Pt=[],Nt=[];ct(),d3.selectAll(".for-profit-entity").on("click",function(e,t){yt(St[t])}),d3.selectAll(".non-profit-entity").on("click",function(e,t){yt(Lt[t])}),d3.selectAll(".individual-entity").on("click",function(e,t){yt(Nt[t])}),d3.selectAll(".government-entity").on("click",function(e,t){yt(Pt[t])}),d3.selectAll(".click-location").on("click",function(){dt(this.innerHTML)}),ut(),d3.selectAll("#search-text").on("keydown",function(){13===d3.event.keyCode&&dt(this.value)}).on("keyup",function(){dt(this.value)}),d3.selectAll("option").on("keydown",function(e,t){if(13===d3.event.keyCode){var n=d3.selectAll("option")[0][t].value;dt(n)}}),v=pt(C),f=pt(F);var Bt=function(){for(var e={},t=0;t<nodeInit[0].length;t++)"visible"===nodeInit[0][t].style.visibility&&(e[nodeInit[0][t].__data__.ID]=nodeInit[0][t]);return e},qt=function(){var e=[".invest",".fund",".porucs",".data"];d3.selectAll(".group-items.connections input")[0].forEach(function(t,n){d3.selectAll("#"+t.id).on("click",function(t,n){return function(){var i=Bt();$("#"+t.id).is(":checked")?Gt(e[n],i):Yt(e[n]),Dt(e[n],i)}}(t,n))})},Gt=function(e,t){d3.selectAll(e).style("visibility",function(e){return e.source.index in t&&e.target.index in t&&"hidden"===this.style.visibility?"visible":"hidden"})},Yt=function(e){d3.selectAll(e).style("visibility",function(){return"hidden"})},Dt=function(e,t){(0===t.length||$("#cb_individ").is("checked")&&$("#cb_forpro").is("checked")&&$("#cb_nonpro").is("checked")&&$("#cb_gov").is("checked"))&&$(e).attr("checked",!1)};qt();var Rt=function(){d3.selectAll("#cb_forpro, #cb_nonpro, #cb_gov, #cb_individ").on("click",function(){$("#cb_forpro").is(":checked")?Tt("For-Profit","visible"):Tt("For-Profit","hidden"),$("#cb_nonpro").is(":checked")?Tt("Non-Profit","visible"):Tt("Non-Profit","hidden"),$("#cb_gov").is(":checked")?Tt("Government","visible"):Tt("Government","hidden"),$("#cb_individ").is(":checked")?Tt("Individual","visible"):Tt("Individual","hidden");var e=Bt();jt(e)})},Tt=function(e,t){d3.selectAll(".node").filter(function(t){return t.type===e?this:void 0}).style("visibility",t)},Ot=function(e,t,n,i){if(t.source.ID in n&&t.target.ID in n)switch(i){case"Funding":$("#cb_fund").is(":checked")?d3.select(e).style("visibility","visible"):d3.select(e).style("visibility","hidden");break;case"Investment":$("#cb_invest").is(":checked")?d3.select(e).style("visibility","visible"):d3.select(e).style("visibility","hidden");break;case"Collaboration":$("#cb_porucs").is(":checked")?d3.select(e).style("visibility","visible"):d3.select(e).style("visibility","hidden");break;case"Data":$("#cb_data").is(":checked")?d3.select(e).style("visibility","visible"):d3.select(e).style("visibility","hidden")}else d3.select(e).style("visibility","hidden")},jt=function(e){fundLink.filter(function(){Ot(this,this.__data__,e,"Funding")}),$t.filter(function(){Ot(this,this.__data__,e,"Investment")}),porucsLink.filter(function(){Ot(this,this.__data__,e,"Collaboration")}),It.filter(function(){Ot(this,this.__data__,e,"Data")}),zt()},zt=function(){var e=fundLink.filter(function(){return"visible"===d3.select(this).style("visibility")}),t=$t.filter(function(){return"visible"===d3.select(this).style("visibility")}),n=porucsLink.filter(function(){return"visible"===d3.select(this).style("visibility")}),i=It.filter(function(){return"visible"===d3.select(this).style("visibility")});0===e[0].length&&$("#cb_fund").attr("checked",!1),0===t[0].length&&$("#cb_invest").attr("checked",!1),0===n[0].length&&$("#cb_porucs").attr("checked",!1),0===i[0].length&&$("#cb_data").attr("checked",!1)};Rt(),d3.selectAll("#cb_emp, #cb_numtwit").on("click",function(){document.getElementById("cb_emp").checked&&(Ft.transition().duration(350).delay(0).attr("r",function(e){return null!==e.employees?G(e.employees):"7"}),Ct.attr("transform",function(e){return null!==e.employees?n(0,-G(e.employees)):n(0,-7)})),document.getElementById("cb_numtwit").checked&&(Ft.transition().duration(350).delay(0).attr("r",function(e){return null!==e.followers?e.followers>1e6?"50":Y(e.followers):"7"}),Ct.attr("transform",function(e){return null!==e.followers?n(0,-Y(e.followers)):n(0,-7)}))}),d3.select("svg").on("click",function(){d3.mouse(this);if(1===w){d3.event.preventDefault(),ft(),d3.selectAll("g").classed("fixed",function(e){e.fixed=!1}),d3.selectAll("g").call(ht),A=jQuery.extend(!0,{},{});{d3.layout.force().nodes(bt).size([y,h]).links(At).linkStrength(0).charge(function(e){return 1===e.render?null!==e.employees?-6*G(e.employees):-25:0}).linkDistance(50).on("tick",gt).start()}}w=1})})}function n(){var e=960,t=500,n=d3.geo.albers().scale(1e3).translate([e/2-40,t/2+30]),i=d3.geo.path().projection(n),l=d3.select(".content").append("svg").attr("width",e).attr("height",t).attr("id","map");d3.json("../data/us.json",function(e,t){l.insert("path",".graticule").datum(topojson.feature(t,t.objects.land)).attr("class","land").attr("d",i),l.insert("path",".graticule").datum(topojson.mesh(t,t.objects.states,function(e,t){return e!==t})).attr("class","state-boundary").attr("d",i);var a={};d3.json("../data/civicgeo.json",function(e,t){if(console.log("asdasd"),console.log(e),e)return console.warn(e);data=t,data.nodes.forEach(function(e){null!=e.coordinates&&e.coordinates.forEach(function(e){key=e[0]+":"+e[1],key in a?a[key]++:a[key]=1})});var i=0;locationData=[];for(var o in a){var s={};coor=o.split(":"),s.val=a[o],s.lat=coor[0],s.lon=coor[1],locationData[locationData.length]=s,s.val>i&&(i=s.val)}radiusScale=d3.scale.linear().domain([0,i]).range([3,10]),l.selectAll("circle").data(locationData).enter().append("circle").attr("cx",function(e){return n([e.lon,e.lat])[0]}).attr("cy",function(e){return n([e.lon,e.lat])[1]}).attr("r",function(e){return radiusScale(e.val)}).style("fill","red")})}),d3.select(self.frameElement).style("height",t+"px")}var i=e().view;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})},"map"==i?(n(),document.getElementById("cb_mapview").checked=!0,document.getElementById("cb_networkview").checked=!1):"network"==i?(t(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0):(t(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0),d3.selectAll("#cb_networkview").on("click",function(){if(document.getElementById("cb_networkview").checked){t();var e=document.getElementById("map");e.parentNode.removeChild(e),console.log("asd")}}),d3.selectAll("#cb_mapview").on("click",function(){if(document.getElementById("cb_mapview").checked){var e=document.getElementById("network");e.parentNode.removeChild(e),n()
}})}();