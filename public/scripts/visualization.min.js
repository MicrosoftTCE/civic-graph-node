!function(){function t(){for(var t={},e=window.location.search.substring(1),n=e.split("&"),i=0;i<n.length;i++){var o=n[i].split("=");if("undefined"==typeof t[o[0]])t[o[0]]=o[1];else if("string"==typeof t[o[0]]){var r=[t[o[0]],o[1]];t[o[0]]=r}else t[o[0]].push(o[1])}return t}function e(){function t(t,e){t.each(function(){for(var t,n=d3.select(this),i=n.text().split(/\s+/).reverse(),o=[],r=0,l=1.1,a=parseFloat(n.attr("dy")),s=d3.select(this)[0][0].__data__,c=n.text(null).append("tspan").attr("x",0).attr("y",function(){return null!==s.employees?L(s.employees)+10:17}).attr("dy",a+"em");t=i.pop();)o.push(t),c.text(o.join(" ")),c.node().getComputedTextLength()>e&&(o.pop(),c.text(o.join(" ")),o=[t],r++,c=n.append("tspan").attr("x",0).attr("y",function(){return null!==s.employees?L(s.employees)+5:12}).attr("dy",r*l+a+"em").text(t))})}function e(t){return"translate("+t.x+","+t.y+")"}function n(t,e){return"translate("+t+","+e+")"}function i(t){t+="",x=t.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1,$2");return x1+x2}var o,r,l,a,c,d,u,h,y,p,f,m=1e3,v=1e3,g={},b={},w={},k={},A=1,E={},I={},P={},C=[],S=[],N=[],B=d3.select(".content").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("id","network").attr("height",v).attr("width",m).style("top","-50px").style("position","relative");d3.select("body > nav > nav > div").append("div").attr("id","editBox").append("p").text("Edit").style("color","#2e92cf");var q=m/v,F=$("#network"),D=F.parent();$(window).on("resize",function(){var t=D.width();F.attr("width",t),F.attr("height",Math.round(t/q))}).trigger("resize");var G="0 0 "+m+" "+v;B.attr("viewBox",G).attr("preserveAspectRatio","xMidYMid");var L=d3.scale.sqrt().domain([10,13e4]).range([10,50]),O=d3.scale.sqrt().domain([10,1e6]).range([10,50]);d3.json("/athena",function(x,q){function F(t){d3.select(this).classed("fixed",function(t){t.fixed=!1}),d3.select(this).on("mousedown.drag",null);{var e=(d3.select(this).data()[0],parseInt(B.style("width").substring(0,(B.style("width").length+1)/2))),n=parseInt(B.style("height").substring(0,(B.style("height").length+1)/2));parseInt(e/2),parseInt(n/2)}multiplierX=e/m,multiplierY=n/v,scaledDX=multiplierX*t.x,scaledDY=multiplierY*t.y,E=jQuery.extend(!0,{},t),E.x=m/2-10,E.y=v/2-60;d3.layout.force().nodes(J).size([m,v]).links(ne).linkStrength(0).charge(function(t){return 1===t.render?null!==t.employees?-6*L(t.employees):-25:0}).linkDistance(50).on("tick",H).start()}function D(t){s=R(t),webform=G(t),d3.select("#edit").html(webform),d3.select("#info").html(s).style("list-style","square"),d3.selectAll("#editCurrentInfo").on("click",function(){alert("Thank you for visiting the Civic Graph. We’re making some updates and are temporarily not accepting new information. Please check back next week!")}).on("mouseover",function(){return d3.select(this).style("cursor","pointer"),d3.select("#editBox").style("visibility","visible")}).on("mousemove",function(){return d3.select("#editBox").style("top",d3.event.pageY+4+"px").style("left",d3.event.pageX+16+"px")}).on("mouseout",function(){return d3.select("#editBox").style("visibility","hidden")})}function G(){var t="";return t+='<h1 id="edit-add-info"><i class="icon-plus on-left"></i>Add Information</h1>'}function R(t){var e="";if(e+='<div style="height:30px"><a style="float:right;"><i id="editCurrentInfo" class="icon-pencil on-left"></i></a></div>',e+='<h1><a href="'+t.url+'" target="_blank">'+t.name+"</a></h1>",e+="<h6>Type of Entity: </h6> <h5>"+t.type+"</h5>",null!==t.location){e+="<br/><h6> Location:  </h6>";var n=[];if(-1!==t.location.indexOf("; ")){e+="<br/> <h5><ul>",n=t.location.split("; ");for(var o=0;o<n.length;o++)e+='<li style="display:block;"><h5><a class="click-location" style="cursor:pointer;">'+n[o]+"</h5></a></li>"}else e+="<h5><ul>",e+='<li style="display:inline-block;"><h5><a class="click-location" style="cursor:pointer;">'+t.location+"</h5></a></li>";e+="</h5></ul><br/>"}else e+="<br/><h6> Location:  </h6> <h5>N/A</h5><br/>";if("Individual"!==t.type&&(e+=null!==t.employees?"<h6>Employees: </h6> <h5>"+i(t.employees.toString())+"</h5><br/>":"<h6>Employees: </h6> <h5>N/A</h5><br/>"),null===t.twitter_handle)e+="<h6>Twitter:  </h6> <h5>N/A</h5><br/>",e+="<h6>Twitter Followers: </h6> <h5>N/A</h5><br/>";else{var r=t.twitter_handle.replace("@","");r="https://twitter.com/"+r,e+='<h6>Twitter:  </h6> <h5><a href="'+r+'" target="_blank">'+t.twitter_handle+"</h5></a><br/>",e+=null!==t.followers?"<h6>Twitter Followers:  </h6> <h5>"+i(t.followers.toString())+"</h5><br/>":"<h6>Twitter Followers:  </h6> <h5>N/A</h5><br/>"}if(null!==t.key_people){e+="<br/><h6>Key People:</h6><ul><h5>";for(var o=0;o<t.key_people.length;o++)e+='<li><a href="http://www.bing.com/search?q='+t.key_people[o].name.replace(" ","%20")+"%20"+t.nickname.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.key_people[o].name+"</a></li>";e+="</h5></ul>"}return null===t.funding_received?e+="<br/><h6>No known funding received.</h6><br/>":(e+="<br/><h6>Received funding from:</h6><ul>",t.funding_received.forEach(function(t){e+=0===t.amount||null===t.amount?'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>",null===t.year}),e+="</ul>"),null===t.funding_given?e+="<br/><h6>No known funding provided.</h6><br/>":(e+="<br/><h6>Gave funding to:</h6><ul>",t.funding_given.forEach(function(t){e+=0===t.amount||null===t.amount?'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>",null===t.year}),e+="</ul>"),null===t.investments_received?e+="<br/><h6>No known investments received.</h6><br/>":(e+="<br/><h6>Received investments from:</h6><ul>",t.investments_received.forEach(function(t){e+=0===t.amount||null===t.amount?'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>",null===t.year}),e+="</ul>"),null===t.investments_made?e+="<br/><h6>No known investments made.</h6><br/>":(e+="<br/><h6>Invested in:</h6><ul>",t.investments_made.forEach(function(t){e+=0===t.amount||null===t.amount?'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':'<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+'</a></h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>",null===t.year}),e+="</ul>"),null===t.collaborations?e+="<br/><h6>No known collaborations.</h6><br/>":(e+="<br/><h6>Collaborated with:</h6><ul>",t.collaborations.forEach(function(t){e+='<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+"</a></h5></li>"}),e+="</ul>"),null===t.data?e+="<br/><h6>No known external data usage.</h6><br/>":(e+="<br/><h6>Obtained data from:</h6><ul>",t.data.forEach(function(t){e+='<li><h5><a href="http://www.bing.com/search?q='+t.entity.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+t.entity+"</a></h5></li>"}),e+="</ul>"),null===t.revenue?e+="<br/><h6>No known revenue information.</h6><br/>":(e+="<br/><h6>Revenue:</h6><ul>",t.revenue.forEach(function(t){e+=0===t.amount||null===t.amount?null===t.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+t.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===t.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>":"<li><h5>"+t.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>"}),e+="</ul>"),null===t.expenses?e+="<br/><h6>No known expenses information.</h6><br/>":(e+="<br/><h6>Expenses:</h6><ul>",t.expenses.forEach(function(t){e+=0===t.amount||null===t.amount?null===t.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':"<li><h5>"+t.year+'</h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>':null===t.year?'<li><h5>Unknown Year</h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>":"<li><h5>"+t.year+'</h5>: <strong style="color:rgb(127,186,0);">$'+i(t.amount.toString())+"</strong></li>"}),e+="</ul>"),T(t),e}function T(){return s='<h2 id="webform-head">Information</h2><hr/><div class="webform-content"><div class="input-control text" data-role="input-control"><input type="text" name="name" id="name" placeholder="Name of Entity" list="list-name"/><datalist id="list-name"></datalist></div><h3 class="form-header">What type of entity?</h3><div class="webform-entities"><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span><h4 class="webform-labels">For-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span><h4 class="webform-labels">Non-Profit</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span><h4 class="webform-labels">Government</h4></label></div><div data-role="input-control" class="input-control radio default-style webform"><label><input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span><h4 class="webform-labels">Individual</h4></label></div></div><h3 class="form-header">What kind of work do they do?</h3><h4>(Select All That Apply)</h4><div class="webform-categories"><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_gen" type="checkbox" name="gen" data-show="general" value="General"/><span class="check"></span><h4 class="webform-labels">General Civic Tech</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_datat" type="checkbox" name="datat" data-show="datalytics" value="DataAnalytics"/><span class="check"></span><h4 class="webform-labels">Data & Analytics</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_eced" type="checkbox" name="eced" data-show="econedu" value="EconGrowthEdu"/><span class="check"></span><h4 class="webform-labels">Jobs & Education</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_src" type="checkbox" name="srcities" data-show="srcities" value="SRCities"/><span class="check"></span><h4 class="webform-labels">Smart & Resilient Cities</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_socs" type="checkbox" name="socserv" data-show="socserv" value="SocialServ"/><span class="check"></span><h4 class="webform-labels">Social Services</h4></label></div><div data-role="input-control" class="input-control checkbox webform"><label><input id="cb_govt" type="checkbox" name="govtech" data-show="govtech" value="GovTech"/><span class="check"></span><h4 class="webform-labels">GovTech</h4></label></div></div><div class="input-control text" data-role="input-control"><input type="text" name="location" id="location" placeholder="City, State" list="list-location"/><datalist id="list-location"></datalist></div><div class="input-control text" data-role="input-control"><input type="text" name="website" id="website" placeholder="Website"/></div><h3 class="form-header" style="display:inline-block;">Number of Employees</h3><div class="input-control text" data-role="input-control" style="width:27% !important; display:inline-block; float:right; margin-top: 2%;"><input type="text" name="employees" id="employee" maxlength="6" style="width:100% !important;"/></div><h3 class="form-header">Key People?</h3><div id="key-people-0" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div><h3 class="form-header">Who funds them via grants?</h3><div id="funding-0"><div class="fund-input input-control text" data-role="input-control"><input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;" list="funding-received-list"/><datalist id="funding-received-list"></datalist><input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who invests in them via equity stakes (stock)?</h3><div id="investing-0"><div class="invest-input input-control text" data-role="input-control"><input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;" list="investment-received-list"/><datalist id="investment-received-list"></datalist><input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they fund via grants?</h3><div id="fundinggiven-0"><div class="fundgiven-input input-control text" data-role="input-control"><input type="text" name="fundgiven" class="fundee" placeholder="Fundee" style="display:inline-block; width:50%;" list="funding-given-list"/><datalist id="funding-given-list"></datalist><input type="text" name="fundgiven_amt" class="fundgiven_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="fundgiven_year" class="fundgiven_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who do they invest in via equity stakes (stock)?</h3><div id="investmentmade-0"><div class="investmade-input input-control text" data-role="input-control"><input type="text" name="investmade" class="investee" placeholder="Investee" style="display:inline-block; width:50%;" list="investment-made-list"/><datalist id="investment-made-list"></datalist><input type="text" name="investmade_amt" class="investmade_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/><input type="text" name="investmade_year" class="investmade_year" placeholder="Year" style="display:inline-block; width: 20%;"/></div></div><h3 class="form-header">Who provides them with data?</h3><div id="data-0" class="input-control text" data-role="input-control"><input type="text" name="data" class="data-entity" placeholder="Data Resource" list="data-received-list"/><datalist id="data-received-list"></datalist></div><div id="nextPhase"><button type="button" id="submit-A" href="javascript: check_empty()">Next</button></div></div><hr/><div class="webform-footer"><span id="">Some entities lack adequate information. Would you like to help?</span><br/><span id="toFormC">Click here!</span></div>',s}function j(){for(var t="",e=[0,0,0,0],n=[],i=[],r=[],l=[],a=0;a<o.length;a++)"Individual"===o[a].type&&(l.push(o[a].name),pe.push(o[a]),e[3]++),"Non-Profit"===o[a].type&&(i.push(o[a].name),he.push(o[a]),e[1]++),"For-Profit"===o[a].type&&(n.push(o[a].name),ue.push(o[a]),e[0]++),"Government"===o[a].type&&(r.push(o[a].name),ye.push(o[a]),e[2]++);t+="<h3 style='padding-bottom:10px;'>The Data</h3>",d3.select("#info").html(t).style("list-style","square"),d3.select("#info").append("div").attr("id","breakdown").style("width","100%");var a=d3.scale.linear().domain([0,d3.max(e)]).range([0,$("#breakdown").width()]),s=0,c=0;d3.select("#breakdown").selectAll("div").data(e).enter().append("div").style("width",function(t){return a(t)/5+"%"}).style("height","20px").style("font","8px sans-serif").style("background-color",function(){return 0===s?(s++,"rgb(127,186,0)"):1===s?(s++,"rgb(0,164,239)"):2===s?(s++,"rgb(242,80,34)"):3===s?(s++,"rgb(255,185,0)"):void 0}).style("text-align","right").style("padding","3px").style("margin","1px").style("color","white").text(function(){return 0===c?void c++:1===c?void c++:2===c?void c++:3===c?void c++:void 0});var d="";d+="<h3 style='padding-top:15px; color:rgb(127,186,0);'>For-Profit ("+e[0]+"):</h3> ";for(var a=0;a<n.length;a++)d+=a===n.length-1?"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[a]+"</a>":"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[a]+", </a>";d+="<h3 style='padding-top:15px; color:rgb(0,164,239);'>Non-Profit ("+e[1]+"):</h3> ";for(var a=0;a<i.length;a++)d+=a===i.length-1?"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[a]+"</a>":"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[a]+", </a>";d+="<h3 style='padding-top:15px; color:rgb(242,80,34);'>Government ("+e[2]+"):</h3> ";for(var a=0;a<r.length;a++)d+=a===r.length-1?"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+r[a]+"</a>":"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+r[a]+", </a>";d+="<h3 style='padding-top:15px; color:rgb(255,185,0);'>Individual ("+e[3]+"):</h3> ";for(var a=0;a<l.length;a++)d+=a===l.length-1?"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+l[a]+"</a>":"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+l[a]+", </a>";d3.select("#info").append("text").style("padding-bottom","20px").html(d)}function z(){var t="";o.forEach(function(t){name=t.name.toLowerCase(),nickname=t.nickname.toLowerCase();var e=t.location.split("; ");name in I||(I[name]=t,C.push(t.name)),nickname in I||(I[nickname]=t,C.push(t.nickname)),e.forEach(function(e){var n=e.toLowerCase();n in P?P[n].push(t):(P[n]=[],P[n].push(t),S.push(e))})}),C=_.sortBy(C,function(t){return t.toLowerCase()}),S=_.sortBy(S,function(t){return t.toLowerCase()}),N=_.sortBy(C.concat(S),function(t){return t});for(var e=0;e<N.length;e++)t+='<option value="'+N[e]+'">';d3.select(".filter-name-location datalist").html(t)}function Q(t){t=t.toLowerCase(),t in I&&U(I[t]),t in P&&(oe.style("opacity",function(e){return e.source.location.toLowerCase()===t&&e.target.location.toLowerCase()===t?1:.05}),re.style("opacity",function(e){return e.source.location.toLowerCase()===t&&e.target.location.toLowerCase()===t?1:.05}),le.style("opacity",function(e){return e.source.location.toLowerCase()===t&&e.target.location.toLowerCase()===t?1:.05}),ae.style("opacity",function(e){return e.source.location.toLowerCase()===t&&e.target.location.toLowerCase()===t?1:.05}),d3.selectAll("circle").style("stroke","white"),d3.selectAll(".node").style("opacity",function(e){return-1===e.location.toLowerCase().indexOf(t)?.05:1}).select("text").style("opacity",1),de.on("mouseout",null).on("mouseover",null).on("click",null),de.filter(function(t,e){return 1==se[0][e].style.opacity}).on("mouseover",D))}function Y(t){for(var e="",n=0;n<t.length;n++)e+='<option value="'+t[n]+'">';return e}function W(t){var e=R(t);webform=G(t),d3.select("#edit").html(webform),d3.select("#info").html(e).style("list-style","square"),oe.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?1:.05}),re.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?1:.05}),le.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?1:.05}),ae.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?1:.05});var n=function(t,e){return t.target.index===e.index},i=function(t,e){return t.source.index===e.index},o={};o[t.ID]=1,h.forEach(function(e){i(e,t)&&(o[e.target.index]=1),n(e,t)&&(o[e.source.index]=1)}),y.forEach(function(e){i(e,t)&&(o[e.target.index]=1),n(e,t)&&(o[e.source.index]=1)}),d.forEach(function(e){i(e,t)&&(o[e.target.index]=1),n(e,t)&&(o[e.source.index]=1)}),u.forEach(function(e){i(e,t)&&(o[e.target.index]=1),n(e,t)&&(o[e.source.index]=1)}),d3.select(this).style("stroke","rgba(0,0,0,0.6)"),B.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(t){return t.ID in o?"1":"0.05"}).select("text").style("opacity",1),d3.select(this.parentNode).select("text").transition().duration(350).delay(0).style("opacity",1).style("font-weight","bold")}function M(){de.style("stroke","white").on("mouseover",W).on("mouseout",M).on("click",U),oe.transition().duration(350).delay(0).style("stroke","rgb(111,93,168)").style("opacity","0.2").style("stroke-width","1px"),re.transition().duration(350).delay(0).style("stroke","rgb(38,114,114)").style("opacity","0.2").style("stroke-width","1px"),le.transition().duration(350).delay(0).style("stroke","rgb(235,232,38)").style("opacity","0.2").style("stroke-width","1px"),ae.transition().duration(350).delay(0).style("stroke","rgb(191,72,150)").style("opacity","0.2").style("stroke-width","1px"),d3.selectAll(".node").transition().duration(350).delay(0).style("opacity","1"),d3.selectAll(".node").selectAll("text").transition().duration(350).delay(0).style("opacity",function(t){var e;return"For-Profit"===t.type&&(e=g.hasOwnProperty(t.name)?1:0),"Non-Profit"===t.type&&(e=b.hasOwnProperty(t.name)?1:0),"Individual"===t.type&&(e=w.hasOwnProperty(t.name)?1:0),"Government"===t.type&&(e=k.hasOwnProperty(t.name)?1:0),e}).style("font-size","14px").style("font-weight","normal")}function U(t){A=0,D(t),oe.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?"1":"0.05"}),re.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?"1":"0.05"}),le.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?"1":"0.05"}),ae.transition().duration(350).delay(0).style("opacity",function(e){return t===e.source||t===e.target?"1":"0.05"}),de.style("stroke",function(e){return e!==t?"white":"black"}).on("mouseout",null),de.filter(function(e){return e!==t?e:void 0}).on("mouseover",null);var e=q.funding_connections.filter(function(e){return e.source.index===t.index||e.target.index===t.index}).map(function(e){return e.source.index===t.index?e.target.index:e.source.index}),n=q.investment_connections.filter(function(e){return e.source.index===t.index||e.target.index===t.index}).map(function(e){return e.source.index===t.index?e.target.index:e.source.index}),i=q.collaboration_connections.filter(function(e){return e.source.index===t.index||e.target.index===t.index}).map(function(e){return e.source.index===t.index?e.target.index:e.source.index}),o=q.data_connections.filter(function(e){return e.source.index===t.index||e.target.index===t.index}).map(function(e){return e.source.index===t.index?e.target.index:e.source.index});B.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(r){return e.indexOf(r.index)>-1||n.indexOf(r.index)>-1||i.indexOf(r.index)>-1||o.indexOf(r.index)>-1||r===t?1:.05}).select("text").style("opacity",1),de.filter(function(r){return e.indexOf(r.index)>-1||n.indexOf(r.index)>-1||i.indexOf(r.index)>-1||o.indexOf(r.index)>-1||r===t}).on("mouseover",D).on("click",function(){})}function X(){de.on("mouseover",null).on("mouseout",null).on("click",null)}function K(){d3.select(this).classed("fixed",function(t){t.fixed=!0}),de.on("mouseover",W).on("mouseout",M).on("click",U)}function H(t){var n=8*t.alpha;o.forEach(function(t){null!==t.type&&("Individual"===t.type&&(t.x+=n+n,t.y+=n+n),"Non-Profit"===t.type&&(t.x+=-n-n,t.y+=n+n),"For-Profit"===t.type&&(t.x+=n+n,t.y+=-n-n),"Government"===t.type&&(t.x+=-n-n,t.y+=-n-n))}),_.isEmpty(E)?(oe.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),re.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),le.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),ae.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),de.attr("cx",function(t){return t.x=t.x}).attr("cy",function(t){return t.y=t.y}),ce.attr("transform",e)):(oe.attr("x1",function(t){return t.source===E?(t.source.x=E.x,t.source.x):t.source.x}).attr("y1",function(t){return t.source===E?(t.source.y=E.y,t.source.y):t.source.y}).attr("x2",function(t){return t.target===E?(t.target.x=E.x,t.target.x):t.target.x}).attr("y2",function(t){return t.target===E?(t.target.y=E.y,t.target.y):t.target.y}),re.attr("x1",function(t){return t.source===E?(t.source.x=E.x,t.source.x):t.source.x}).attr("y1",function(t){return t.source===E?(t.source.y=E.y,t.source.y):t.source.y}).attr("x2",function(t){return t.target===E?(t.target.x=E.x,t.target.x):t.target.x}).attr("y2",function(t){return t.target===E?(t.target.y=E.y,t.target.y):t.target.y}),le.attr("x1",function(t){return t.source===E?(t.source.x=E.x,t.source.x):t.source.x}).attr("y1",function(t){return t.source===E?(t.source.y=E.y,t.source.y):t.source.y}).attr("x2",function(t){return t.target===E?(t.target.x=E.x,t.target.x):t.target.x}).attr("y2",function(t){return t.target===E?(t.target.y=E.y,t.target.y):t.target.y}),ae.attr("x1",function(t){return t.source===E?(t.source.x=E.x,t.source.x):t.source.x}).attr("y1",function(t){return t.source===E?(t.source.y=E.y,t.source.y):t.source.y}).attr("x2",function(t){return t.target===E?(t.target.x=E.x,t.target.x):t.target.x}).attr("y2",function(t){return t.target===E?(t.target.y=E.y,t.target.y):t.target.y}),de.attr("cx",function(t,e){return d3.select(de)[0][0].data()[e].name===E.name?(t.x=E.x,t.x):t.x=t.x}).attr("cy",function(t,e){return d3.select(de)[0][0].data()[e].name===E.name?(t.y=E.y,t.y):t.y=t.y}),ce.attr("transform",e))}var J=q.nodes,V=q.funding_connections,Z=q.investment_connections,te=q.collaboration_connections,ee=q.data_connections,ne=V.concat(Z).concat(te).concat(ee);o=J.filter(function(t){return 1===t.render}),h=V.filter(function(t){return 1===t.render}),y=Z.filter(function(t){return 1===t.render}),d=te.filter(function(t){return 1===t.render}),u=ee.filter(function(t){return 1===t.render});var ie=(h.concat(y).concat(d).concat(u),d3.layout.force().nodes(J).size([m,v]).links(ne).linkStrength(0).charge(function(t){return 1===t.render?null!==t.employees?-6*L(t.employees):-25:0}).linkDistance(50)),X=ie.drag().on("dragstart",X).on("drag",X).on("dragend",K),oe=B.selectAll(".fund").data(h).enter().append("line").attr("class","fund").style("stroke","rgb(111,93,168)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),re=B.selectAll(".invest").data(y).enter().append("line").attr("class","invest").style("stroke","rgb(38,114,114)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),le=B.selectAll(".porucs").data(d).enter().append("line").attr("class","porucs").style("stroke","rgb(235,232,38)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),ae=B.selectAll(".data").data(u).enter().append("line").attr("class","data").style("stroke","rgb(191,72,150)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),se=B.selectAll(".node").data(o).enter().append("g").attr("class","node").style("visibility","visible").on("dblclick",F).call(X);ie.on("tick",H).start(),r=B.selectAll(".node").filter(function(t){return"For-Profit"===t.type}).sort(function(t,e){return t.weight-e.weight}),l=B.selectAll(".node").filter(function(t){return"Non-Profit"===t.type}).sort(function(t,e){return t.weight-e.weight}),a=B.selectAll(".node").filter(function(t){return"Individual"===t.type}).sort(function(t,e){return t.weight-e.weight}),c=B.selectAll(".node").filter(function(t){return"Government"===t.type}).sort(function(t,e){return t.weight-e.weight}),r.each(function(t,e){e>=r[0].length-5&&(g[t.name]=t.weight)}),l.each(function(t,e){e>=l[0].length-5&&(b[t.name]=t.weight)}),a.each(function(t,e){e>=a[0].length-5&&(w[t.name]=t.weight)}),c.each(function(t,e){e>=c[0].length-5&&(k[t.name]=t.weight)});var ce=B.selectAll(".node").append("text").text(function(t){return t.nickname}).attr("x",0).attr("dy","0.1em").attr("y",function(t){return null!==t.employees?L(t.employees)+10:17}).style("opacity",function(t){var e;return"For-Profit"===t.type&&(e=g.hasOwnProperty(t.name)?1:0),"Non-Profit"===t.type&&(e=b.hasOwnProperty(t.name)?1:0),"Individual"===t.type&&(e=w.hasOwnProperty(t.name)?1:0),"Government"===t.type&&(e=k.hasOwnProperty(t.name)?1:0),e}).style("font-size","14px").style("color","#FFFFFF").style("pointer-events","none"),de=se.append("circle").attr("r",function(t){return null!==t.employees?L(t.employees):"7"}).style("fill",function(t){if(null!==t.type){if("Individual"===t.type)return"rgb(255,185,0)";if("Non-Profit"===t.type)return"rgb(0,164,239)";if("For-Profit"===t.type)return"rgb(127,186,0)";if("Government"===t.type)return"rgb(242,80,34)"}}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("stroke-width","1.5px").style("stroke","white").on("mouseover",W).on("mouseout",M).on("click",U);for(ce.call(t,80);ie.alpha()>.025;)ie.tick();d3.selectAll("#edit").on("click",function(){alert("Thank you for visiting the Civic Graph. We’re making some updates and are temporarily not accepting new information. Please check back next week!")});var ue=[],he=[],ye=[],pe=[];j(),d3.selectAll(".for-profit-entity").on("click",function(t,e){U(ue[e])}),d3.selectAll(".non-profit-entity").on("click",function(t,e){U(he[e])}),d3.selectAll(".individual-entity").on("click",function(t,e){U(pe[e])}),d3.selectAll(".government-entity").on("click",function(t,e){U(ye[e])}),d3.selectAll(".click-location").on("click",function(){Q(this.innerHTML)}),z(),d3.selectAll("#search-text").on("keydown",function(){13===d3.event.keyCode&&Q(this.value)}).on("keyup",function(){Q(this.value)}),d3.selectAll("option").on("keydown",function(t,e){if(13===d3.event.keyCode){var n=d3.selectAll("option")[0][e].value;Q(n)}}),p=Y(C),f=Y(S);var fe=function(){for(var t={},e=0;e<se[0].length;e++)"visible"===se[0][e].style.visibility&&(t[se[0][e].__data__.ID]=se[0][e]);return t},me=function(){var t=[".invest",".fund",".porucs",".data"];d3.selectAll(".group-items.connections input")[0].forEach(function(e,n){d3.selectAll("#"+e.id).on("click",function(e,n){return function(){var i=fe();$("#"+e.id).is(":checked")?ve(t[n],i):ge(t[n]),be(t[n],i)}}(e,n))})},ve=function(t,e){d3.selectAll(t).style("visibility",function(t){return t.source.index in e&&t.target.index in e&&"hidden"===this.style.visibility?"visible":"hidden"
})},ge=function(t){d3.selectAll(t).style("visibility",function(){return"hidden"})},be=function(t,e){(0===e.length||$("#cb_individ").is("checked")&&$("#cb_forpro").is("checked")&&$("#cb_nonpro").is("checked")&&$("#cb_gov").is("checked"))&&$(t).attr("checked",!1)};me();var xe=function(){d3.selectAll("#cb_forpro, #cb_nonpro, #cb_gov, #cb_individ").on("click",function(){$("#cb_forpro").is(":checked")?we("For-Profit","visible"):we("For-Profit","hidden"),$("#cb_nonpro").is(":checked")?we("Non-Profit","visible"):we("Non-Profit","hidden"),$("#cb_gov").is(":checked")?we("Government","visible"):we("Government","hidden"),$("#cb_individ").is(":checked")?we("Individual","visible"):we("Individual","hidden");var t=fe();_e(t)})},we=function(t,e){d3.selectAll(".node").filter(function(e){return e.type===t?this:void 0}).style("visibility",e)},ke=function(t,e,n,i){if(e.source.ID in n&&e.target.ID in n)switch(i){case"Funding":$("#cb_fund").is(":checked")?d3.select(t).style("visibility","visible"):d3.select(t).style("visibility","hidden");break;case"Investment":$("#cb_invest").is(":checked")?d3.select(t).style("visibility","visible"):d3.select(t).style("visibility","hidden");break;case"Collaboration":$("#cb_porucs").is(":checked")?d3.select(t).style("visibility","visible"):d3.select(t).style("visibility","hidden");break;case"Data":$("#cb_data").is(":checked")?d3.select(t).style("visibility","visible"):d3.select(t).style("visibility","hidden")}else d3.select(t).style("visibility","hidden")},_e=function(t){oe.filter(function(){ke(this,this.__data__,t,"Funding")}),re.filter(function(){ke(this,this.__data__,t,"Investment")}),le.filter(function(){ke(this,this.__data__,t,"Collaboration")}),ae.filter(function(){ke(this,this.__data__,t,"Data")}),Ae()},Ae=function(){var t=oe.filter(function(){return"visible"===d3.select(this).style("visibility")}),e=re.filter(function(){return"visible"===d3.select(this).style("visibility")}),n=le.filter(function(){return"visible"===d3.select(this).style("visibility")}),i=ae.filter(function(){return"visible"===d3.select(this).style("visibility")});0===t[0].length&&$("#cb_fund").attr("checked",!1),0===e[0].length&&$("#cb_invest").attr("checked",!1),0===n[0].length&&$("#cb_porucs").attr("checked",!1),0===i[0].length&&$("#cb_data").attr("checked",!1)};xe(),d3.selectAll("#cb_emp, #cb_numtwit").on("click",function(){document.getElementById("cb_emp").checked&&(de.transition().duration(350).delay(0).attr("r",function(t){return null!==t.employees?L(t.employees):"7"}),ce.attr("transform",function(t){return null!==t.employees?n(0,-L(t.employees)):n(0,-7)})),document.getElementById("cb_numtwit").checked&&(de.transition().duration(350).delay(0).attr("r",function(t){return null!==t.followers?t.followers>1e6?"50":O(t.followers):"7"}),ce.attr("transform",function(t){return null!==t.followers?n(0,-O(t.followers)):n(0,-7)}))}),d3.select("svg").on("click",function(){d3.mouse(this);if(1===A){d3.event.preventDefault(),M(),d3.selectAll("g").classed("fixed",function(t){t.fixed=!1}),d3.selectAll("g").call(X),E=jQuery.extend(!0,{},{});{d3.layout.force().nodes(J).size([m,v]).links(ne).linkStrength(0).charge(function(t){return 1===t.render?null!==t.employees?-6*L(t.employees):-25:0}).linkDistance(50).on("tick",H).start()}}A=1})})}function n(){var t=960,e=500,n=d3.geo.albers().scale(1e3).translate([t/2-40,e/2+30]),i=d3.geo.path().projection(n),o=d3.select(".content").append("svg").attr("width",t).attr("height",e).attr("id","map");d3.json("../data/us.json",function(t,e){o.insert("path",".graticule").datum(topojson.feature(e,e.objects.land)).attr("class","land").attr("d",i),o.insert("path",".graticule").datum(topojson.mesh(e,e.objects.states,function(t,e){return t!==e})).attr("class","state-boundary").attr("d",i);var r={};d3.json("../data/civicgeo.json",function(t,e){if(console.log("asdasd"),console.log(t),t)return console.warn(t);data=e,data.nodes.forEach(function(t){null!=t.coordinates&&t.coordinates.forEach(function(t){key=t[0]+":"+t[1],key in r?r[key]++:r[key]=1})});var i=0;locationData=[];for(var l in r){var a={};coor=l.split(":"),a.val=r[l],a.lat=coor[0],a.lon=coor[1],locationData[locationData.length]=a,a.val>i&&(i=a.val)}radiusScale=d3.scale.linear().domain([0,i]).range([3,10]),o.selectAll("circle").data(locationData).enter().append("circle").attr("cx",function(t){return n([t.lon,t.lat])[0]}).attr("cy",function(t){return n([t.lon,t.lat])[1]}).attr("r",function(t){return radiusScale(t.val)}).style("fill","red")})}),d3.select(self.frameElement).style("height",e+"px")}var i=t().view;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},"map"==i?(n(),document.getElementById("cb_mapview").checked=!0,document.getElementById("cb_networkview").checked=!1):"network"==i?(e(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0):(e(),document.getElementById("cb_mapview").checked=!1,document.getElementById("cb_networkview").checked=!0),d3.selectAll("#cb_networkview").on("click",function(){if(document.getElementById("cb_networkview").checked){e();var t=document.getElementById("map");t.parentNode.removeChild(t),console.log("asd")}}),d3.selectAll("#cb_mapview").on("click",function(){if(document.getElementById("cb_mapview").checked){var t=document.getElementById("network");t.parentNode.removeChild(t),n()}})}();