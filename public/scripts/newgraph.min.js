function transform(e){return"translate("+e.x+","+e.y+")"}function translateSVG(e,t){return"translate("+e+","+t+")"}function numCommas(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2}function getSVG(e){return e}var dblclickobject,centerNodeFundLink=[],centerNodeInvestLink=[],centerNodePorucsLink=[],centerNodeDataLink=[],color=d3.scale.category20(),width=960,height=960,testNode,organizations={},filteredNodes={},porucsCon={},dataCon={},fundingCon={},investingCon={},fundLink={},investLink={},porucsLink={},dataLink={},newCenterFundLink=[],newCenterPorucsLink=[],newCenterInvestLink=[],newCenterDataLink=[],nodeInit,controlForce={init:!0,dblclick:!1},centeredNode={},fundLinkX1=[],fundLinkX2=[],investLinkX1=[],investLinkX2=[],porucsLinkX1=[],porucsLinkX2=[],dataLinkX1=[],dataLinkX2=[],fundLinkY1=[],fundLinkY2=[],investLinkY1=[],investLinkY2=[],porucsLinkY1=[],porucsLinkY2=[],dataLinkY1=[],dataLinkY2=[],nodeX=[],nodeY=[],node,flag=1,didDBLClick=0,svg=d3.select(".content").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("id","network").attr("height",height).attr("width",width).style("position","fixed"),aspect=width/height,network=$("#network"),container=network.parent();$(window).on("resize",function(){var e=container.width();network.attr("width",e),network.attr("height",Math.round(e/aspect))}).trigger("resize");var viewBoxParameters="0 0 "+width+" "+height;svg.attr("viewBox",viewBoxParameters).attr("preserveAspectRatio","xMidYMid");var empScale=d3.scale.sqrt().domain([10,13e4]).range([10,50]),twitScale=d3.scale.sqrt().domain([10,1e6]).range([10,50]);d3.json("data/final_data.json",function(e,t){function n(e){d3.select(this).classed("fixed",function(e){e.fixed=!1}),d3.select(this).on("mousedown.drag",null),dblclickobject=d3.select(this).data()[0];{var t=parseInt(svg.style("width").substring(0,(svg.style("width").length+1)/2)),n=parseInt(svg.style("height").substring(0,(svg.style("height").length+1)/2));parseInt(t/2),parseInt(n/2)}multiplierX=t/width,multiplierY=n/height,scaledDX=multiplierX*e.x,scaledDY=multiplierY*e.y,centeredNode=jQuery.extend(!0,{},e),centeredNode.x=width/2-10,centeredNode.y=height/2-60;d3.layout.force().nodes(filteredNodes).size([width,height]).links(fundingCon.concat(investingCon).concat(porucsCon).concat(dataCon)).linkStrength(0).charge(function(e){return null!==e.numemp?-5*empScale(parseInt(e.numemp)):-50}).on("tick",G).start()}function i(e){s=l(e),webform=o(e),d3.select("#edit").html(webform),d3.select("#info").html(s).style("list-style","square")}function o(){var e="";return e+='<h1 id="edit-add-info"><i class="icon-pencil on-left"></i>Edit or Add Information</h1>'}function l(e){var t="";if(t+='<h1><a href="'+e.weblink+'" target="_blank">'+e.name+"</a></h1>",t+="<h6>Type of Entity: </h6> <h5>"+e.type+"</h5>",null!==e.location){t+="<br/><h6> Location:  </h6>";var n=[];if(-1!==e.location.indexOf("; ")){t+="<br/> <h5><ul>",n=e.location.split("; ");for(var i=0;i<n.length;i++)t+='<li style="display:block;"><h5><a class="click-location" style="cursor:pointer;">'+n[i]+"</h5></a></li>"}else t+="<h5><ul>",t+='<li style="display:inline-block;"><h5><a class="click-location" style="cursor:pointer;">'+e.location+"</h5></a></li>";t+="</h5></ul><br/>"}else t+="<br/><h6> Location:  </h6> <h5>N/A</h5><br/>";if("Individual"!==e.type&&(t+=null!==e.numemp?"<h6>Employees: </h6> <h5>"+numCommas(e.numemp)+"</h5><br/>":"<h6>Employees: </h6> <h5>N/A</h5><br/>"),null===e.twitterH)t+="<h6>Twitter:  </h6> <h5>N/A</h5><br/>",t+="<h6>Twitter Followers: </h6> <h5>N/A</h5><br/>";else{var o=e.twitterH.replace("@","");o="https://twitter.com/"+o,t+='<h6>Twitter:  </h6> <h5><a href="'+o+'">'+e.twitterH+"</h5></a><br/>",t+="<h6>Twitter Followers:  </h6> <h5>"+numCommas(e.followers)+"</h5><br/>"}var l=[];if(null!==e.people){t+="<br/><h6>Key People:</h6><ul><h5>",l=e.people.split(", ");for(var i=0;i<l.length;i++)t+='<li><a href="http://www.bing.com/search?q='+l[i].replace(" ","%20")+"%20"+e.nickname.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+l[i]+"</a></li>";t+="</h5></ul>"}var r=[],a=[];if(null===e.fundingR)t+="<br/> <h6>No known funding.</h6><br/>";else{var c,s,d=0,u=[],p=[];if(-1!==e.fundingR.indexOf("; ")){u=e.fundingR.split("; ");for(var i=0;i<u.length;i++)p=u[i].split(":"),r.push(p[0]),a.push(p[1]),"Total"!==r[i]?"Individuals"!==r[i]?"null"===a[i]?(0===d&&(t+="<br/><h6> Received funding from:</h6><ul>",d++),t+='<li><h5><a href="http://www.bing.com/search?q='+r[i].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+r[i]+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>'):(0===d&&(t+="<br/><h6> Received funding from:</h6><ul>",d++),t+='<li><h5><a href="http://www.bing.com/search?q='+r[i].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+r[i]+'</a></h5>: $<strong style="color:rgb(127,186,0);">'+numCommas(a[i])+"</strong></li>"):s=a[i]:c=a[i]}else u=e.fundingR.split(":"),"Total"===u[0]?(t+="<br/>",c=u[1]):"Individuals"===u[0]?(t+="<br/>",s=u[1]):(t+="<br/><h6> Received funding from:</h6><ul>",t+='<li><h5><a href="http://www.bing.com/search?q='+u[0].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+u[0]+"</a></h5>",t+="null"===u[1]?': <strong style="color:rgb(255,185,0);">unknown</strong></li>':': $<strong style="color:rgb(127,186,0);">'+numCommas(u[1])+"</strong></li>");t+="</ul>",isNaN(s)||(t+='<h6>Individuals provided </h6> $<strong style="color:rgb(127,186,0);">'+numCommas(s)+"</strong></h5><h6> in fundings.</h6><br/>"),isNaN(c)||(t+='<h6>Total funding received: </h6> $<strong style="color:rgb(127,186,0);">'+numCommas(c)+"</strong></h5><br/>")}var f,h,y=[],m=[];if(null===e.investmentR)t+="<br/> <h6>No known investments.</h6> <br/>";else{var d=0,v=[],g=[];if(-1!==e.investmentR.indexOf("; ")){v=e.investmentR.split("; ");for(var i=0;i<v.length;i++)g=v[i].split(":"),y.push(g[0]),m.push(g[1]),"Total"!==y[i]?"Individuals"!==y[i]?"null"===m[i]?(0===d&&(t+="<br/><h6> Received investments from:</h6><ul>",d++),t+='<li><h5><a href="http://www.bing.com/search?q='+y[i].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+y[i]+'</a></h5>: <strong style="color:rgb(255,185,0);">unknown</strong></li>'):(0===d&&(t+="<br/><h6> Received investments from:</h6><ul>",d++),t+='<li><h5><a href="http://www.bing.com/search?q='+y[i].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+y[i]+'</a></h5>: $<strong style="color:rgb(127,186,0);">'+numCommas(m[i])+"</strong></li>"):h=m[i]:f=m[i]}else v=e.investmentR.split(":"),"Total"===v[0]?(t+="<br/>",f=m[1]):"Individuals"===v[0]?(t+="<br/>",h=m[1]):(t+="<br/><h6> Received investments from:</h6><ul>",t+='<li><h5><a href="http://www.bing.com/search?q='+v[0].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+v[0]+"</a></h5>",t+="null"===v[1]?': <strong style="color:rgb(255,185,0);">unknown</strong></li>':': $<strong style="color:rgb(127,186,0);">'+numCommas(v[1])+"</strong></li>");t+="</ul>",isNaN(h)||(t+='<h6>Individuals provided </h6> $<strong style="color:rgb(127,186,0);">'+numCommas(h)+"</strong> in investments.<br/>"),isNaN(f)||(t+='<h6>Total investments received: </h6> $<strong style="color:rgb(127,186,0);">'+numCommas(f)+"</strong>.<br/>")}if(null===e.relatedto)t+="<br/><h6>No known relations.</h6><br/>";else{t+="<br/><h6>Related To:  </h6> <ul>";var x=[];if(-1!==e.relatedto.indexOf(", ")){x=e.relatedto.split(", ");for(var i=0;i<x.length;i++)t+='<li><h5><a href="http://www.bing.com/search?q='+x[i].replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+x[i]+"</a></h5></li>"}else t+='<li><h5> <a href="http://www.bing.com/search?q='+e.relatedto.replace(" ","%20")+'&go=Submit&qs=bs&form=QBRE" target="_blank">'+e.relatedto+"</a></h5></li>";t+="</ul>"}return b(e),t}function r(){d3.select("#edit-add-info").html('<i class=" icon-file on-left"></i>Reset Form').on("click",r),sa=b(),d3.select("#info").html(sa),d3.select('#key-people-0 input[name="kpeople"]').on("keyup",function(){u(0)}),d3.select('#funding-0 input[name="fund"]').on("keyup",function(){p(0)}),d3.select('#investing-0 input[name="invest"]').on("keyup",function(){f(0)}),d3.select('#data-0 input[name="data"]').on("keyup",function(){h(0)}),d3.select("#toFormC").on("click",function(){displayFormC()}),d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),d()})}function a(){var e={type:null,categories:null,name:null,nickname:null,location:null,weblink:null,numemp:null,people:null,twitterH:null,followers:null,data:null,relatedto:null,poruc:null,fundingR:null,yearFR:null,investmentR:null,yearIR:null,rande:null,randeY:null,grantsG:null,yearG:null,golr:null};return""===$('input[name="name"]').val()&&""===$('input[name="location"]').val()?(console.log("The entity name and location have not been filled out."),{name:"empty",location:"empty",errorMessage:"The entity name and location have not been filled out."}):""===$('input[name="name"]').val()?(console.log("The entity name has not been filled out."),{name:"empty",errorMessage:"The entity name has not been filled out."}):""===$('input[name="location"]').val()?(console.log("The location has not been filled out."),{location:"empty",errorMessage:"The location has not been filled out."}):(e.type=$("input#rb_forpro").is(":checked")?"For-Profit":$("input#rb_nonpro").is(":checked")?"Non-Profit":$("input#rb_gov").is(":checked")?"Government":"Individual",e.name=d3.select(".webform-content input[name='name']")[0][0].value,e.categories="",d3.selectAll(".webform-categories input").filter(function(){if(this.checked===!0)switch(""!==e.categories&&(e.categories+=", "),this.value){case"General":e.categories+="General";break;case"DataTrans":e.categories+="Data Transparency";break;case"CJobsOpp":e.categories+="21st Century Jobs and Opportunities";break;case"SRCities":e.categories+="Smart and Resilient Cities"}}),""===e.categories&&(e.categories=null),e.location=d3.select("input[name='location']")[0][0].value,e.weblink="",e.weblink=""===e.weblink?null:d3.select("input[name='website']")[0][0].value,e.numemp="",e.numemp=""===e.numemp?null:d3.select("input[name='employees']")[0][0].value,e.people="",d3.selectAll(".kpeople").filter(function(){""!==this.value&&(""!==e.people&&(e.people+=", "),e.people+=this.value)}),""===e.people&&(e.people=null),e.fundingR="",e.yearFR="",d3.selectAll(".fund-input .funder").filter(function(t,n){""!==this.value&&(""!==e.fundingR&&(e.fundingR+="; "),e.fundingR+=""===d3.selectAll(".fund_amt")[0][n].value?this.value+":null":this.value+":"+d3.selectAll(".fund_amt")[0][n].value)}),d3.selectAll(".fund-input .fund_year").filter(function(t,n){""!==e.yearFR&&n!==d3.selectAll(".fund-input .fund_year")[0].length-1&&(e.yearFR+=", "),e.yearFR+=""===this.value&&n!==d3.selectAll(".fund-input .fund_year")[0].length-1?"null":this.value}),""===e.fundingR&&(e.fundingR=null),""===e.yearFR&&(e.yearFR=null),e.investmentR="",e.yearIR="",d3.selectAll(".invest-input .investor").filter(function(t,n){""!==this.value&&(""!==e.investmentR&&(e.investmentR+="; "),e.investmentR+=""===d3.selectAll(".invest_amt")[0][n].value?this.value+":null":this.value+":"+d3.selectAll(".invest_amt")[0][n].value)}),d3.selectAll(".invest-input .invest_year").filter(function(t,n){""!==e.yearIR&&n!==d3.selectAll(".invest-input .invest_year")[0].length-1&&(e.yearIR+=", "),e.yearIR+=""===this.value&&n!==d3.selectAll(".invest-input .invest_year")[0].length-1?"null":this.value}),""===e.investmentR&&(e.investmentR=null),""===e.yearIR&&(e.yearIR=null),e.data="",d3.selectAll(".data-entity").filter(function(){""!==e.data&&(e.data+=", "),e.data+=this.value}),""===e.data&&(e.data=null),e)}function c(e){e.nickname=d3.select(".webform-content input[name='nickname']")[0][0].value,""===e.nickname&&(e.nickname=e.name),e.twitterH=d3.select(".webform-content input[name='twitterhandle']")[0][0].value,""===e.twitterH&&(e.twitterH=null),e.golr=$(".webform-influence input#rb_local").is(":checked")?"0":"1",e.poruc="",d3.selectAll(".collaborator").filter(function(){""!==this.value&&(""!==e.poruc&&(e.poruc+="; "),e.poruc+=this.value)}),""===e.poruc&&(e.poruc=null),e.rande="",e.randeY="",d3.selectAll(".revenue-input .revenue_amt").filter(function(t,n){""!==this.value&&(""!==e.rande&&(e.rande+="; "),e.rande+=""===d3.selectAll(".revenue_amt")[0][n].value?"Revenue:null":"Revenue:"+this.value)}),d3.selectAll(".revenue-input .revenue_year").filter(function(t,n){""!==e.randeY&&n!==d3.selectAll(".revenue-input .revenue_year")[0].length-1&&(e.randeY+=", "),e.randeY+=""===this.value&&n!==d3.selectAll(".revenue-input .revenue_year")[0].length-1?"null":this.value}),(""===e.rande||"null"===e.rande)&&(e.rande=null),(""===e.randeY||"null"===e.randeY)&&(e.randeY=null);var t="; ",n=", ";return d3.selectAll(".expense-input .expense_amt").filter(function(e,n){""!==this.value&&("; "!==t&&(t+="; "),t+=""===d3.selectAll(".expense_amt")[0][n].value?"Expense:null":"Expense:"+this.value)}),d3.selectAll(".expense-input .expense_year").filter(function(e,t){", "!==n&&t!==d3.selectAll(".expense-input .expense_year")[0].length-1&&(n+=", "),n+=""===this.value&&t!==d3.selectAll(".expense-input .expense_year")[0].length-1?"null":this.value}),"; "===t&&(t=""),", "===n&&(n=""),e.rande+=t,e.randeY+=n,"null"===e.rande&&(e.rande=null),"null"===e.randeY&&(e.randeY=null),e.grantsG="",e.yearG="",d3.selectAll(".grant-input .grant_amt").filter(function(t,n){""!==this.value&&(""!==e.grantsG&&(e.grantsG+=", "),e.grantsG+=""===d3.selectAll(".grant_amt")[0][n].value?"null":this.value)}),d3.selectAll(".grant-input .grant_year").filter(function(t,n){""!==e.yearG&&n!==d3.selectAll(".grant-input .grant_year")[0].length-1&&(e.yearG+=", "),e.yearG+=""===this.value&&n!==d3.selectAll(".grant-input .grant_year")[0].length-1?"null":this.value}),""===e.grantsG&&(e.grantsG=null),""===e.yearG&&(e.yearG=null),console.log(e),e}function d(){var e=a();"empty"!==e.location&&"empty"!==e.name?(counterKey=0,counterK=0,counterFund=0,counterF=0,s="",s+='<h2 id="webform-head">Information</h2><hr/>            <div class="webform-content">            <div class="input-control text" data-role="input-control">              <input type="text" name="name" id="name" placeholder="Name of Entity"/>            </div>            <h3 class="form-header">Entity Type</h3>            <div class="webform-entities">              <div data-role="input-control" class="input-control radio default-style webform">                <label>                  <input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span>                  <h4 class="webform-labels">For-Profit</h4>                </label>              </div>              <div data-role="input-control" class="input-control radio default-style webform">                <label>                  <input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span>                  <h4 class="webform-labels">Non-Profit</h4>                </label>              </div>              <div data-role="input-control" class="input-control radio default-style webform">                <label>                  <input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span>                  <h4 class="webform-labels">Government</h4>                </label>              </div>             <div data-role="input-control" class="input-control radio default-style webform">                <label>                  <input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span>                  <h4 class="webform-labels">Individual</h4>                </label>              </div>            </div>            <div class="input-control text" data-role="input-control">              <input type="text" name="location" id="location" placeholder="City, State"/>            </div>            ',s+='<hr/>          <div class = "input-control text" data-role="input-control">            <input type="text" name="nickname" id="nickname" placeholder="Nickname/Abbr."/>          </div>          <div class = "input-control text" data-role="input-control">            <input type="text" name="twitterhandle" id="twitterhandle" placeholder="Twitter Handle"/>          </div>          <h3 class="form-header" style="display:inline-block;">Circle of Influence: </h3>          <div class="webform-influence">            <div data-role="input-control" class="input-control radio default-style webform">              <label>                <input id="rb_local" type="radio" name="influence-type" value="Local Influence" checked="checked"/><span class="check"></span>                <h4 class="webform-labels">Local Influence</h4>              </label>            </div>            <div data-role="input-control" class="input-control radio default-style webform">              <label>                <input id="rb_global" type="radio" name="influence-type" value="Global Influence" checked="checked"/><span class="check"></span>                <h4 class="webform-labels">Global Influence</h4>              </label>            </div>          </div>          <h3 class="form-header">Collaboration</h3>          <div id="collaboration-0" class="input-control text" data-role="input-control">          <input type="text" name="collaboration" class="collaborator" placeholder="Collaborator"/>          </div>          <h3 class="form-header">Revenue</h3>          <div id="revenue-0">          <div class="revenue-input input-control text" data-role="input-control">          <input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>          <input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/>          </div>          </div>          <h3 class="form-header">Expenses</h3>          <div id="expense-0">          <div class="expense-input input-control text" data-role="input-control">          <input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>          <input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/>          </div>          </div>          <h3 class="form-header">Grants</h3>          <div id="grant-0">          <div class="grant-input input-control text" data-role="input-control">          <input type="text" name="grant_amt" class="grant_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>          <input type="text" name="grant_year" class="grant_year" placeholder="Year" style="display:inline-block; width: 20%;"/>          </div>          </div>          <button type="button" id="submit-B" href="javascript: check_empty()">Submit</button>          </div>',d3.select("#info").html(s),d3.selectAll("#name").text(function(){console.log(e.name),this.value=e.name}).attr("disabled",!0),d3.selectAll("#location").text(function(){this.value=e.location}).attr("disabled",!0).style("margin-top","10px"),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===e.type?!0:!1,this.disabled=!0}),d3.selectAll('input[name="collaboration"]').on("keyup",function(){y(0)}),d3.selectAll('input[name="revenue_amt"]').on("keyup",function(){m(0)}),d3.selectAll('input[name="expense_amt"]').on("keyup",function(){v(0)}),d3.selectAll('input[name="grant_amt"]').on("keyup",function(){g(0)}),d3.selectAll("#submit-B").on("click",function(){k(e)})):"empty"===e.name&&"empty"===e.location?(d3.select("#name").style("border-color","#e51400"),d3.select("#location").style("border-color","#e51400")):"empty"===e.name?d3.select("#name").style("border-color","#e51400"):d3.select("#location").style("border-color","#e51400")}function u(e){""!==$("#key-people-"+e+' input[name="kpeople"]').val()&&(d3.select("#key-people-"+e+' input[name="kpeople"]').on("keyup",null),e++,console.log(e),$("#key-people-"+(e-1)).after('<div id="key-people-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/></div>'),d3.select("#key-people-"+e+" input[name='kpeople']").on("keyup",function(){u(e)}))}function p(e){""!==$("#funding-"+e+' input[name="fund"]').val()&&(d3.select("#funding-"+e+' input[name="fund"]').on("keyup",null),e++,console.log(e),$("#funding-"+(e-1)).after('<div id="funding-'+e+'"><div class="fund-input input-control text" data-role="input-control">          <input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;"/>          <input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/>          <input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/>      </div></div>'),d3.select("#funding-"+e+" input[name='fund']").on("keyup",function(){p(e)}))}function f(e){""!==$("#investing-"+e+' input[name="invest"]').val()&&(d3.select("#investing-"+e+' input[name="invest"]').on("keyup",null),e++,console.log(e),$("#investing-"+(e-1)).after('<div id="investing-'+e+'"><div class="invest-input input-control text" data-role="input-control">          <input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;"/>          <input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/>          <input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/>      </div></div>'),d3.select("#investing-"+e+" input[name='invest']").on("keyup",function(){f(e)}))}function h(e){""!==$("#data-"+e+' input[name="data"]').val()&&(d3.select("#data-"+e+' input[name="data"]').on("keyup",null),e++,console.log(e),$("#data-"+(e-1)).after('<div id="data-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="data" class="data" placeholder="Data Resource"/></div>'),d3.select("#data-"+e+" input[name='data']").on("keyup",function(){h(e)}))}function y(e){""!==$("#collaboration-"+e+' input[name="collaboration"]').val()&&(d3.select("#collaboration-"+e+' input[name="collaboration"]').on("keyup",null),e++,console.log(e),$("#collaboration-"+(e-1)).after('<div id="collaboration-'+e+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator"/></div>'),d3.select("#collaboration-"+e+" input[name='collaboration']").on("keyup",function(){y(e)}))}function m(e){""!==$("#revenue-"+e+' input[name="revenue_amt"]').val()&&(d3.select("#revenue-"+e+' input[name="revenue_amt"]').on("keyup",null),e++,console.log(e),$("#revenue-"+(e-1)).after('<div id="revenue-'+e+'"><div class="revenue-input input-control text" data-role="input-control">          <input type="text" name="revenue_amt" class="revenue_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>        <input type="text" name="revenue_year" class="revenue_year" placeholder="Year" style="display:inline-block; width: 20%;"/>      </div></div>'),d3.select("#revenue-"+e+" input[name=revenue_amt]").on("keyup",function(){m(e)}))}function v(e){""!==$("#expense-"+e+' input[name="expense_amt"]').val()&&(d3.select("#expense-"+e+' input[name="expense_amt"]').on("keyup",null),e++,console.log(e),$("#expense-"+(e-1)).after('<div id="expense-'+e+'"><div class="expense-input input-control text" data-role="input-control">         <input type="text" name="expense_amt" class="expense_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>        <input type="text" name="expense_year" class="expense_year" placeholder="Year" style="display:inline-block; width: 20%;"/>      </div></div>'),d3.select("#expense-"+e+" input[name=expense_amt]").on("keyup",function(){v(e)}))}function g(e){""!==$("#grant-"+e+' input[name="grant_amt"]').val()&&(d3.select("#grant-"+e+' input[name="grant_amt"]').on("keyup",null),e++,console.log(e),$("#grant-"+(e-1)).after('<div id="grant-'+e+'"><div class="grant-input input-control text" data-role="input-control">         <input type="text" name="grant_amt" class="grant_amt" placeholder="Amount" style="display:inline-block; width: 57%;"/>        <input type="text" name="grant_year" class="grant_year" placeholder="Year" style="display:inline-block; width: 20%;"/>      </div></div>'),d3.select("#grant-"+e+" input[name=grant_amt]").on("keyup",function(){g(e)}))}function b(){return s="",s+='<h2 id="webform-head">Information</h2><hr/>          <div class="webform-content">          <div class="input-control text" data-role="input-control">          <input type="text" name="name" id="name" placeholder="Name of Entity"/>          </div>          <h3 class="form-header">What type of entity?</h3>          <div class="webform-entities">          <div data-role="input-control" class="input-control radio default-style webform">            <label>              <input id="rb_forpro" type="radio" name="entitytype" value="For-Profit" checked="checked"/><span class="check"></span>              <h4 class="webform-labels">For-Profit</h4>            </label>          </div>          <div data-role="input-control" class="input-control radio default-style webform">            <label>              <input id="rb_nonpro" type="radio" name="entitytype" value="Non-Profit"/><span class="check"></span>              <h4 class="webform-labels">Non-Profit</h4>            </label>          </div>          <div data-role="input-control" class="input-control radio default-style webform">            <label>              <input id="rb_gov" type="radio" name="entitytype" value="Government"/><span class="check"></span>              <h4 class="webform-labels">Government</h4>            </label>          </div>          <div data-role="input-control" class="input-control radio default-style webform">            <label>              <input id="rb_individs" type="radio" name="entitytype" value="Individual"/><span class="check"></span>              <h4 class="webform-labels">Individual</h4>            </label>          </div>          </div>          <h3 class="form-header">What type(s) of work do they do?</h3><h4>(Select All That Apply)</h4>          <div class="webform-categories">          <div data-role="input-control" class="input-control checkbox webform">            <label>              <input id="cb_gen" type="checkbox" name="gen" data-show="general" value="General"/><span class="check"></span>              <h4 class="webform-labels">General</h4>            </label>          </div>          <div data-role="input-control" class="input-control checkbox webform">            <label>              <input id="cb_datat" type="checkbox" name="datat" data-show="datatrans" value="DataTrans"/><span class="check"></span>              <h4 class="webform-labels">Data Transparency</h4>            </label>          </div>          <div data-role="input-control" class="input-control checkbox webform">            <label>              <input id="cb_cjao" type="checkbox" name="cjao" data-show="cjobsopp" value="CJobsOpp"/><span class="check"></span>              <h4 class="webform-labels">21st Century Jobs and Opportunities</h4>            </label>          </div>          <div data-role="input-control" class="input-control checkbox webform">            <label>              <input id="cb_src" type="checkbox" name="src" data-show="srcities" value="SRCities"/><span class="check"></span>              <h4 class="webform-labels">Smart and Resilient Cities</h4>            </label>          </div>          </div>          <div class="input-control text" data-role="input-control">            <input type="text" name="location" id="location" placeholder="City, State"/>          </div>          <div class="input-control text" data-role="input-control">          <input type="text" name="website" id="website" placeholder="Website"/>          </div>          <h3 class="form-header">Number of Employees?</h3>          <div class="input-control text" data-role="input-control">            <input type="text" name="employees" id="employee" maxlength="6" style="width:30% !important;"/>          </div>          <h3 class="form-header">Key People?</h3>          <div id="key-people-0" class="input-control text" data-role="input-control">            <input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name"/>          </div>          <h3 class="form-header">Who funds them via grants?</h3>          <div id="funding-0">          <div class="fund-input input-control text" data-role="input-control">          <input type="text" name="fund" class="funder" placeholder="Funder" style="display:inline-block; width:50%;"/>          <input type="text" name="fund_amt" class="fund_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/>          <input type="text" name="fund_year" class="fund_year" placeholder="Year" style="display:inline-block; width: 20%;"/>          </div>          </div>          <h3 class="form-header">Who invests in them via equity stakes (stock)?</h3>          <div id="investing-0">          <div class="invest-input input-control text" data-role="input-control">          <input type="text" name="invest" class="investor" placeholder="Investor" style="display:inline-block; width:50%;"/>          <input type="text" name="invest_amt" class="invest_amt" placeholder="Amount" style="display:inline-block; width: 27%;"/>          <input type="text" name="invest_year" class="invest_year" placeholder="Year" style="display:inline-block; width: 20%;"/>          </div>          </div>          <h3 class="form-header">Who provides them with data?</h3>          <div id="data-0" class="input-control text" data-role="input-control">          <input type="text" name="data" class="data-entity" placeholder="Data Resource"/>          </div>          <button type="button" id="submit-A" href="javascript: check_empty()">Submit</button>          </div>          <hr/>          <div class="webform-footer">          <span id="">Some entities lack adequate information. Would you like to help?</span><br/><span id="toFormC">Click here!</span>          </div>'}function x(){var e=0,t=[];filteredNodes.forEach(function(n){_.object(_.map(n,function(t,n){return null===t&&e++,[n,t]}));"Individual"===n.type&&(e-=4),t.push({name:n.name,nullFields:e}),e=0});var n=_.max(t,function(e){return e.nullFields}),i=[];t.forEach(function(e){if(e.nullFields<=n.nullFields&&e.nullFields>=n.nullFields-3){var t=_.find(filteredNodes,function(t){return e.name===t.name});i.push(t)}}),console.log(i.length);for(var o=[];o.length<5;){var l=Math.floor(Math.random()*i.length);console.log(l),-1===o.indexOf(i[l])&&o.push(i[l])}return o}function k(e){var t=(c(e),"");t+='<h2 id="webform-head">Information</h2><hr/>            <div style="text-align:center;" class="webform-content">            <p>Thanks for submitting information to Athena!</p>            <p>Might you be interested in helping with other entities?</p>',t+='<ul id="suggestions">';var n=x();console.log(n),n.forEach(function(e){t+='<li><a style="cursor:pointer;">'+e.name+"</a></li>"}),t+="</ul>        </div>",d3.select("#info").html(t),d3.selectAll("#info ul a").on("click",function(e,t){O(n[t]),r(),w(n[t])});var i={};i.title="title",i.message="message",$.ajax({type:"POST",data:{nodes:1},dataType:"json",async:!1,contentType:"text/plain",url:"/testing",success:function(e){console.log("success"),console.log(JSON.stringify(e))}})}function w(e){if(testNode=e,d3.selectAll("#name").text(function(){this.value=e.name}),d3.selectAll("#location").text(function(){this.value=e.location}),d3.selectAll('input[name="entitytype"]').filter(function(){this.checked=this.value===e.type?!0:!1
}),null!==e.categories){var t=e.categories.split(", ");d3.selectAll(".webform-categories input").filter(function(e,n){this.checked=t.indexOf(d3.selectAll(".webform-categories h4")[0][n].textContent)>-1?!0:!1})}if(d3.selectAll("#website").text(function(){this.value=e.weblink}),d3.selectAll("#employee").text(function(){this.value=e.numemp}),null!==e.people){var n=e.people.split(", ");n.forEach(function(e,t){$("#key-people-"+t).after('<div id="key-people-'+(t+1)+'" class="input-control text" data-role="input-control"><input type="text" name="kpeople" class="kpeople" placeholder="Key Person\'s Name""/></div>'),d3.select("#key-people-"+t+' input[name="kpeople"]').on("keyup",null),d3.select("#key-people-"+t+' input[name="kpeople"]').text(function(){this.value=e})}),d3.select("#key-people-"+n.length+' input[name="kpeople"]').on("keyup",function(){u(n.length)})}d3.selectAll("#submit-A").on("click",function(){d3.select("#name").style("border-color","#d9d9d9"),d3.select("#location").style("border-color","#d9d9d9"),d(),E(e)})}function E(e){if(d3.selectAll("#nickname").text(function(){this.value=e.nickname}),d3.selectAll("#twitterhandle").text(function(){this.value=e.twitterH}),d3.selectAll('input[name="influence-type"]').filter(function(){this.checked="0"===e.golr&&"Local Influence"===this.value?!0:"1"===e.golr&&"Global Influence"===this.value?!0:!1}),null!==e.poruc){var t=e.poruc.split("; ");t.forEach(function(e,t){$("#collaboration-"+t).after('<div id="collaboration-'+(t+1)+'" class="input-control text" data-role="input-control"><input type="text" name="collaboration" class="collaborator" placeholder="Collaborator"/></div>'),d3.select("#collaboration-"+t+' input[name="collaboration"]').on("keyup",null),d3.select("#collaboration-"+t+' input[name="collaboration"]').text(function(){this.value=e})}),d3.select("#collaboration-"+t.length+' input[name="collaboration"]').on("keyup",function(){y(t.length)})}}function N(){for(var e="",t=[0,0,0,0],n=[],i=[],o=[],l=[],r=0;r<filteredNodes.length;r++)"Individual"===filteredNodes[r].type&&(l.push(filteredNodes[r].name),z.push(filteredNodes[r]),t[3]++),"Non-Profit"===filteredNodes[r].type&&(i.push(filteredNodes[r].name),Y.push(filteredNodes[r]),t[1]++),"For-Profit"===filteredNodes[r].type&&(n.push(filteredNodes[r].name),S.push(filteredNodes[r]),t[0]++),"Government"===filteredNodes[r].type&&(o.push(filteredNodes[r].name),q.push(filteredNodes[r]),t[2]++);e+="<h3 style='padding-bottom:10px;'>The Data</h3>",d3.select("#info").html(e).style("list-style","square"),d3.select("#info").append("div").attr("id","breakdown").style("width","100%");var r=d3.scale.linear().domain([0,d3.max(t)]).range([0,$("#breakdown").width()]),a=0,c=0;d3.select("#breakdown").selectAll("div").data(t).enter().append("div").style("width",function(e){return r(e)/5+"%"}).style("height","20px").style("font","8px sans-serif").style("background-color",function(){return 0===a?(a++,"rgb(127,186,0)"):1===a?(a++,"rgb(0,164,239)"):2===a?(a++,"rgb(242,80,34)"):3===a?(a++,"rgb(255,185,0)"):void 0}).style("text-align","right").style("padding","3px").style("margin","1px").style("color","white").text(function(){return 0===c?void c++:1===c?void c++:2===c?void c++:3===c?void c++:void 0});var s="";s+="<h3 style='padding-top:15px; color:rgb(127,186,0);'>For-Profit ("+t[0]+"):</h3> ";for(var r=0;r<n.length;r++)s+=r===n.length-1?"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[r]+"</a>":"<a class='for-profit-entity' style='font-size:16px; cursor:pointer;'>"+n[r]+", </a>";s+="<h3 style='padding-top:15px; color:rgb(0,164,239);'>Non-Profit ("+t[1]+"):</h3> ";for(var r=0;r<i.length;r++)s+=r===i.length-1?"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[r]+"</a>":"<a class='non-profit-entity' style='font-size:16px; cursor:pointer;'>"+i[r]+", </a>";s+="<h3 style='padding-top:15px; color:rgb(242,80,34);'>Government ("+t[2]+"):</h3> ";for(var r=0;r<o.length;r++)s+=r===o.length-1?"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+o[r]+"</a>":"<a class='government-entity' style='font-size:16px; cursor:pointer;'>"+o[r]+", </a>";s+="<h3 style='padding-top:15px; color:rgb(255,185,0);'>Individual ("+t[3]+"):</h3> ";for(var r=0;r<l.length;r++)s+=r===l.length-1?"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+l[r]+"</a>":"<a  class='individual-entity' style='font-size:16px; cursor:pointer;'>"+l[r]+", </a>";d3.select("#info").append("text").style("padding-bottom","20px").html(s)}function I(){var e="";filteredNodes.forEach(function(e){if(j.push(e.name),D.push(e.location),-1===X.indexOf(e.name)&&null!==e.name&&X.push(e.name),-1===Q.indexOf(e.location)&&null!==e.location){var t=e.location.split("; ");t.forEach(function(e){-1===Q.indexOf(e)&&Q.push(e)})}}),H=H.concat(Q),H=H.concat(X),H=H.sort();for(var t=0;t<H.length;t++)e+='<option value="'+H[t]+'">';d3.select(".filter-name-location datalist").html(e)}function A(e){var t=[],n=0;if(-1!==j.indexOf(e))j.forEach(function(t){if(t===e&&t.length===e.length){var n=j.indexOf(e);nodeInit.filter(function(e,t){t===n&&O(e)})}});else{D.forEach(function(i){if(null!==i){var o=i.split("; ");-1!==o.indexOf(e)&&t.push(n)}n++});fundLink.style("opacity",function(t){return t.source.location===e&&t.target.location===e?"1":"0.05"}),investLink.style("opacity",function(t){return t.source.location===e&&t.target.location===e?"1":"0.05"}),porucsLink.style("opacity",function(t){return t.source.location===e&&t.target.location===e?"1":"0.05"}),dataLink.style("opacity",function(t){return t.source.location===e&&t.target.location===e?"1":"0.05"}),d3.selectAll(".node").style("opacity",function(e,n){return-1===t.indexOf(n)?.05:1}).on("mouseover",null),node.on("mouseout",null).on("mouseover",null).on("click",null),node.filter(function(e,t){return 1==nodeInit[0][t].style.opacity?e:void 0}).on("mouseout",null).on("mouseover",i).on("click",null)}}function C(e){var n=l(e);webform=o(e),d3.select("#edit").html(webform),d3.select("#info").html(n).style("list-style","square"),fundLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),investLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),porucsLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),dataLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"});var i=t.fundingR.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),r=t.investingR.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),a=t.porucs.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),c=t.data.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index});d3.select(this).style("stroke","black"),svg.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(t){return i.indexOf(t.index)>-1||r.indexOf(t.index)>-1||a.indexOf(t.index)>-1||c.indexOf(t.index)>-1||t===e?"1":"0.05"})}function L(){node.style("stroke","white").on("mouseover",C).on("mouseout",L).on("click",O),fundLink.transition().duration(350).delay(0).style("stroke","rgb(111,93,168)").style("opacity","0.2").style("stroke-width","1px").style("z-index","0"),investLink.transition().duration(350).delay(0).style("stroke","rgb(38,114,114)").style("opacity","0.2").style("stroke-width","1px").style("z-index","0"),porucsLink.transition().duration(350).delay(0).style("stroke","rgb(235,232,38)").style("opacity","0.2").style("stroke-width","1px").style("z-index","0"),dataLink.transition().duration(350).delay(0).style("stroke","rgb(191,72,150)").style("opacity","0.2").style("stroke-width","1px").style("z-index","0"),d3.selectAll(".node").transition().duration(350).delay(0).style("opacity","1")}function O(e){i(e),fundLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),investLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),porucsLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),dataLink.transition().duration(350).delay(0).style("opacity",function(t){return e===t.source||e===t.target?"1":"0.05"}),node.style("stroke",function(t){return t!==e?"white":"black"}).on("mouseout",null),node.filter(function(t){return t!==e?t:void 0}).on("mouseover",null);var n=t.fundingR.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),o=t.investingR.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),l=t.porucs.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index}),r=t.data.filter(function(t){return t.source.index===e.index||t.target.index===e.index}).map(function(t){return t.source.index===e.index?t.target.index:t.source.index});svg.selectAll(".node").transition().duration(350).delay(0).style("opacity",function(t){return n.indexOf(t.index)>-1||o.indexOf(t.index)>-1||l.indexOf(t.index)>-1||r.indexOf(t.index)>-1||t===e?"1":"0.05"}),node.filter(function(t){return n.indexOf(t.index)>-1||o.indexOf(t.index)>-1||l.indexOf(t.index)>-1||r.indexOf(t.index)>-1||t===e}).on("mouseover",i).on("click",function(){})}function B(){node.on("mouseover",null).on("mouseout",null).on("click",null)}function R(){d3.select(this).classed("fixed",function(e){e.fixed=!0}),node.on("mouseover",C).on("mouseout",L).on("click",O)}function G(e){var t=8*e.alpha;filteredNodes.forEach(function(e){null!==e.type&&("Individual"===e.type&&(e.x+=t+t,e.y+=t+t),"Non-Profit"===e.type&&(e.x+=-t-t,e.y+=t+t),"For-Profit"===e.type&&(e.x+=t+t,e.y+=-t-t),"Government"===e.type&&(e.x+=-t-t,e.y+=-t-t))}),_.isEmpty(centeredNode)?(fundLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),investLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),porucsLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),dataLink.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),node.attr("cx",function(e){return e.x=e.x}).attr("cy",function(e){return e.y=e.y}),F.attr("transform",transform)):(fundLink.attr("x1",function(e){return e.source===centeredNode?(e.source.x=centeredNode.x,console.log("Test"),e.source.x):e.source.x}).attr("y1",function(e){return e.source===centeredNode?(e.source.y=centeredNode.y,console.log("Test"),e.source.y):e.source.y}).attr("x2",function(e){return e.target===centeredNode?(e.target.x=centeredNode.x,console.log("Test"),e.target.x):e.target.x}).attr("y2",function(e){return e.target===centeredNode?(e.target.y=centeredNode.y,console.log("Test"),e.target.y):e.target.y}),investLink.attr("x1",function(e){return e.source===centeredNode?(e.source.x=centeredNode.x,console.log("Test"),e.source.x):e.source.x}).attr("y1",function(e){return e.source===centeredNode?(e.source.y=centeredNode.y,console.log("Test"),e.source.y):e.source.y}).attr("x2",function(e){return e.target===centeredNode?(e.target.x=centeredNode.x,console.log("Test"),e.target.x):e.target.x}).attr("y2",function(e){return e.target===centeredNode?(e.target.y=centeredNode.y,console.log("Test"),e.target.y):e.target.y}),porucsLink.attr("x1",function(e){return e.source===centeredNode?(e.source.x=centeredNode.x,console.log("Test"),e.source.x):e.source.x}).attr("y1",function(e){return e.source===centeredNode?(e.source.y=centeredNode.y,console.log("Test"),e.source.y):e.source.y}).attr("x2",function(e){return e.target===centeredNode?(e.target.x=centeredNode.x,console.log("Test"),e.target.x):e.target.x}).attr("y2",function(e){return e.target===centeredNode?(e.target.y=centeredNode.y,console.log("Test"),e.target.y):e.target.y}),dataLink.attr("x1",function(e){return e.source===centeredNode?(e.source.x=centeredNode.x,console.log("Test"),e.source.x):e.source.x}).attr("y1",function(e){return e.source===centeredNode?(e.source.y=centeredNode.y,console.log("Test"),e.source.y):e.source.y}).attr("x2",function(e){return e.target===centeredNode?(e.target.x=centeredNode.x,console.log("Test"),e.target.x):e.target.x}).attr("y2",function(e){return e.target===centeredNode?(e.target.y=centeredNode.y,console.log("Test"),e.target.y):e.target.y}),node.attr("cx",function(e,t){return d3.select(node)[0][0].data()[t].name===centeredNode.name?(e.x=centeredNode.x,e.x):e.x=e.x}).attr("cy",function(e,t){return d3.select(node)[0][0].data()[t].name===centeredNode.name?(e.y=centeredNode.y,e.y):e.y=e.y}),F.attr("transform",transform))}function P(){for(var e=[],t=0;t<nodeInit[0].length;t++)"visible"===nodeInit[0][t].style.visibility&&e.push(t);var n=[];return nodeInit.filter(function(t,i){e.indexOf(i)>-1&&n.push(t)}),n}filteredNodes=t.nodes,fundingCon=t.fundingR,investingCon=t.investingR,porucsCon=t.porucs,dataCon=t.data;var T=d3.layout.force().nodes(filteredNodes).size([width,height]).links(fundingCon.concat(investingCon).concat(porucsCon).concat(dataCon)).linkStrength(0).charge(function(e){return null!==e.numemp?-5*empScale(parseInt(e.numemp)):-50}).on("tick",G).start(),B=T.drag().on("dragstart",B).on("drag",B).on("dragend",R);fundLink=svg.selectAll(".fund").data(fundingCon).enter().append("line").attr("class","fund").style("stroke","rgb(111,93,168)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),investLink=svg.selectAll(".invest").data(investingCon).enter().append("line").attr("class","invest").style("stroke","rgb(38,114,114)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),porucsLink=svg.selectAll(".porucs").data(porucsCon).enter().append("line").attr("class","porucs").style("stroke","rgb(235,232,38)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),dataLink=svg.selectAll(".data").data(dataCon).enter().append("line").attr("class","data").style("stroke","rgb(191,72,150)").style("stroke-width","1").style("opacity","0.2").style("visibility","visible"),nodeInit=svg.selectAll(".node").data(filteredNodes).enter().append("g").attr("class","node").style("visibility","visible").on("dblclick",n).call(B),node=nodeInit.append("circle").attr("r",function(e){return null!==e.numemp?empScale(parseInt(e.numemp)):"7"}).style("fill",function(e){if(null!==e.type){if("Individual"===e.type)return"rgb(255,185,0)";if("Non-Profit"===e.type)return"rgb(0,164,239)";if("For-Profit"===e.type)return"rgb(127,186,0)";if("Government"===e.type)return"rgb(242,80,34)"}}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).style("stroke-width","1.5px").style("stroke","white").on("mouseover",C).on("mouseout",L).on("click",O);for(var F=svg.selectAll(".node").append("text").text(function(e){return e.nickname}).attr("x",-8).attr("y",".31em").style("font","14px sans-serif").style("pointer-events","none").style("text-shadow","0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff");T.alpha()>.025;)T.tick();d3.selectAll("#edit").on("click",r);var S=[],Y=[],q=[],z=[];N(),d3.selectAll(".for-profit-entity").on("click",function(e,t){O(S[t])}),d3.selectAll(".non-profit-entity").on("click",function(e,t){O(Y[t])}),d3.selectAll(".individual-entity").on("click",function(e,t){O(z[t])}),d3.selectAll(".government-entity").on("click",function(e,t){O(q[t])}),d3.selectAll(".click-location").on("click",function(){A(this.innerHTML)});var j=[],D=[],X=[],Q=[],H=[];I(),d3.selectAll("#search-text").on("keydown",function(){if(13===d3.event.keyCode){var e=document.getElementById("search-text").value;A(e)}}),d3.selectAll("option").on("click",function(e,t){var n=d3.selectAll("option")[0][t].value;A(n)}),d3.selectAll("#cb_fund").on("click",function(){var e=P();if(document.getElementById("cb_fund").checked){var t=0;d3.selectAll(".fund").style("visibility",function(n){return e.indexOf(n.source)>-1&&e.indexOf(n.target)>-1&&"hidden"===this.style.visibility?(t++,"visible"):"hidden"})}document.getElementById("cb_fund").checked||d3.selectAll(".fund").style("visibility",function(){return"hidden"}),0!==e.length&&(document.getElementById("cb_individ").checked||document.getElementById("cb_forpro").checked||document.getElementById("cb_nonpro").checked||document.getElementById("cb_gov").checked)||(document.getElementById("cb_fund").checked=!1)}),d3.selectAll("#cb_invest").on("click",function(){var e=P();document.getElementById("cb_invest").checked&&d3.selectAll(".invest").style("visibility",function(t){return e.indexOf(t.source)>-1&&e.indexOf(t.target)>-1&&"hidden"===this.style.visibility?"visible":"hidden"}),document.getElementById("cb_invest").checked||d3.selectAll(".invest").style("visibility",function(){return"hidden"}),0!==e.length&&(document.getElementById("cb_individ").checked||document.getElementById("cb_forpro").checked||document.getElementById("cb_nonpro").checked||document.getElementById("cb_gov").checked)||(document.getElementById("cb_invest").checked=!1)}),d3.selectAll("#cb_porucs").on("click",function(){var e=P();document.getElementById("cb_porucs").checked&&d3.selectAll(".porucs").style("visibility",function(t){return e.indexOf(t.source)>-1&&e.indexOf(t.target)>-1&&"hidden"===this.style.visibility?"visible":"hidden"}),document.getElementById("cb_porucs").checked||d3.selectAll(".porucs").style("visibility",function(){return"hidden"}),0!==e.length&&(document.getElementById("cb_individ").checked||document.getElementById("cb_forpro").checked||document.getElementById("cb_nonpro").checked||document.getElementById("cb_gov").checked)||(document.getElementById("cb_porucs").checked=!1)}),d3.selectAll("#cb_data").on("click",function(){var e=P();document.getElementById("cb_data").checked&&d3.selectAll(".data").style("visibility",function(t){return e.indexOf(t.source)>-1&&e.indexOf(t.target)>-1&&"hidden"===this.style.visibility?"visible":"hidden"}),document.getElementById("cb_data").checked||d3.selectAll(".data").style("visibility",function(){return"hidden"}),0!==e.length&&(document.getElementById("cb_individ").checked||document.getElementById("cb_forpro").checked||document.getElementById("cb_nonpro").checked||document.getElementById("cb_gov").checked)||(document.getElementById("cb_data").checked=!1)}),d3.selectAll("#cb_individ, #cb_nonpro, #cb_forpro, #cb_gov").on("click",function(){function e(){for(var e=arguments,t={},n=[],i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++)t[e[i][o]]!==!0&&(n[n.length]=e[i][o],t[e[i][o]]=!0);return n}var t=[],n=[],i=[],o=[],l=[],r=[],a=[],c=[],s=[],d=[],u=[],p=[],f=[],h=[],y=[],m=[],v=[],g=[],b=[],x=[],k=[],w=[],_=[],E=[],N=[],I=[],A=[],C=[],L=[],O=[],B=[],R=[],G=[],P=[],T=[],F=[],S=[],$=[],Y=[],q=[];document.getElementById("cb_individ").checked&&(d3.selectAll(".node").filter(function(e){return"Individual"===e.type?this:void 0}).style("visibility","visible"),l=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(fundingCon.forEach(function(n){(e===n.source||e===n.target)&&t.push(l),l++}),l=0)}),l=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(investingCon.forEach(function(t){(e===t.source||e===t.target)&&n.push(l),l++}),l=0)}),l=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(porucsCon.forEach(function(t){(e===t.source||e===t.target)&&i.push(l),l++}),l=0)}),countIndex0=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(dataCon.forEach(function(t){(e===t.source||e===t.target)&&o.push(countIndex0),countIndex0++}),countIndex0=0)})),document.getElementById("cb_individ").checked||(d3.selectAll(".node").filter(function(e){return"Individual"===e.type?this:void 0}).style("visibility","hidden"),N=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(fundingCon.forEach(function(t){(e===t.source||e===t.target)&&k.push(N),N++}),N=0)}),N=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(investingCon.forEach(function(t){(e===t.source||e===t.target)&&w.push(N),N++}),N=0)}),N=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(porucsCon.forEach(function(t){(e===t.source||e===t.target)&&_.push(N),N++}),N=0)}),N=0,filteredNodes.forEach(function(e){"Individual"===e.type&&(dataCon.forEach(function(t){(e===t.source||e===t.target)&&E.push(N),N++}),N=0)})),document.getElementById("cb_nonpro").checked&&(d3.selectAll(".node").filter(function(e){return"Non-Profit"===e.type?this:void 0}).style("visibility","visible"),d=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==r.indexOf(d)||r.push(d),d++}),d=0)}),d=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==a.indexOf(d)||a.push(d),d++}),d=0)}),d=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==c.indexOf(d)||c.push(d),d++}),d=0)}),d=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==s.indexOf(d)||s.push(d),d++}),d=0)})),document.getElementById("cb_nonpro").checked||(d3.selectAll(".node").filter(function(e){return"Non-Profit"===e.type?this:void 0}).style("visibility","hidden"),O=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==I.indexOf(O)||I.push(O),O++}),O=0)}),O=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==A.indexOf(O)||A.push(O),O++}),O=0)}),O=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==C.indexOf(O)||C.push(O),O++}),O=0)}),O=0,filteredNodes.forEach(function(e){"Non-Profit"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==L.indexOf(O)||L.push(O),O++}),O=0)})),document.getElementById("cb_forpro").checked&&(d3.selectAll(".node").filter(function(e){return"For-Profit"===e.type?this:void 0}).style("visibility","visible"),y=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==u.indexOf(y)||u.push(y),y++}),y=0)}),y=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==p.indexOf(y)||p.push(y),y++}),y=0)}),y=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==f.indexOf(y)||f.push(y),y++}),y=0)}),y=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==h.indexOf(y)||h.push(y),y++}),y=0)})),document.getElementById("cb_forpro").checked||(d3.selectAll(".node").filter(function(e){return"For-Profit"===e.type?this:void 0}).style("visibility","hidden"),T=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==B.indexOf(T)||B.push(T),T++}),T=0)}),T=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==R.indexOf(T)||R.push(T),T++}),T=0)}),T=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==G.indexOf(T)||G.push(T),T++}),T=0)}),T=0,filteredNodes.forEach(function(e){"For-Profit"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==P.indexOf(T)||P.push(T),T++}),T=0)})),document.getElementById("cb_gov").checked&&(d3.selectAll(".node").filter(function(e){return"Government"===e.type?this:void 0}).style("visibility","visible"),x=0,filteredNodes.forEach(function(e){"Government"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==m.indexOf(x)||m.push(x),x++}),x=0)}),x=0,filteredNodes.forEach(function(e){"Government"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==v.indexOf(x)||v.push(x),x++}),x=0)}),x=0,filteredNodes.forEach(function(e){"Government"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==g.indexOf(x)||g.push(x),x++}),x=0)}),x=0,filteredNodes.forEach(function(e){"Government"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==b.indexOf(x)||b.push(x),x++}),x=0)})),document.getElementById("cb_gov").checked||(d3.selectAll(".node").filter(function(e){return"Government"===e.type?this:void 0}).style("visibility","hidden"),q=0,filteredNodes.forEach(function(e){"Government"===e.type&&(fundingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==F.indexOf(q)||F.push(q),q++}),q=0)}),q=0,filteredNodes.forEach(function(e){"Government"===e.type&&(investingCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==S.indexOf(q)||S.push(q),q++}),q=0)}),q=0,filteredNodes.forEach(function(e){"Government"===e.type&&(porucsCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==$.indexOf(q)||$.push(q),q++}),q=0)}),q=0,filteredNodes.forEach(function(e){"Government"===e.type&&(dataCon.forEach(function(t){e!==t.source&&e!==t.target||-1!==Y.indexOf(q)||Y.push(q),q++}),q=0)}));var z=[],j=[],D=[],X=[];0!==t.length&&(z=e(z,t)),0!==r.length&&(z=z=e(z,r)),0!==u.length&&(z=e(z,u)),0!==m.length&&(z=e(z,m)),0!==n.length&&(j=e(j,n)),0!==a.length&&(j=e(j,a)),0!==p.length&&(j=e(j,p)),0!==v.length&&(j=e(j,v)),0!==i.length&&(D=e(D,i)),0!==c.length&&(D=e(D,c)),0!==f.length&&(D=e(D,f)),0!==g.length&&(D=e(D,g)),0!==o.length&&(X=e(X,o)),0!==s.length&&(X=e(X,s)),0!==h.length&&(X=e(X,h)),0!==b.length&&(X=e(X,b));var Q=[],H=[],M=[],K=[];0!==k.length&&(Q=e(Q,k)),0!==I.length&&(Q=e(Q,I)),0!==B.length&&(Q=e(Q,B)),0!==F.length&&(Q=e(Q,F)),0!==w.length&&(H=e(H,w)),0!==A.length&&(H=e(H,A)),0!==R.length&&(H=e(H,R)),0!==S.length&&(H=e(H,S)),0!==_.length&&(M=e(M,_)),0!==C.length&&(M=e(M,C)),0!==G.length&&(M=e(M,G)),0!==$.length&&(M=e(M,$)),0!==E.length&&(K=e(K,E)),0!==L.length&&(K=e(K,L)),0!==P.length&&(K=e(K,P)),0!==Y.length&&(K=e(K,Y));var V=[],W=[],J=[],U=[];document.getElementById("cb_fund").checked||fundLink.filter(function(e,t){"hidden"===fundLink[0][t].style.visibility&&V.push(t)}),document.getElementById("cb_invest").checked||investLink.filter(function(e,t){"hidden"===investLink[0][t].style.visibility&&W.push(t)}),document.getElementById("cb_porucs").checked||porucsLink.filter(function(e,t){"hidden"===porucsLink[0][t].style.visibility&&J.push(t)}),document.getElementById("cb_data").checked||dataLink.filter(function(e,t){"hidden"===dataLink[0][t].style.visibility&&U.push(t)}),d3.selectAll(".fund").style("visibility",function(e,t){return z.indexOf(t)>-1?"visible":"hidden"}),d3.selectAll(".invest").style("visibility",function(e,t){return j.indexOf(t)>-1?"visible":"hidden"}),d3.selectAll(".porucs").style("visibility",function(e,t){return D.indexOf(t)>-1?"visible":"hidden"}),d3.selectAll(".data").style("visibility",function(e,t){return X.indexOf(t)>-1?"visible":"hidden"}),d3.selectAll(".fund").style("visibility",function(e,t){return Q.indexOf(t)>-1||V.indexOf(t)>-1?"hidden":"visible"}),d3.selectAll(".invest").style("visibility",function(e,t){return H.indexOf(t)>-1||W.indexOf(t)>-1?"hidden":"visible"}),d3.selectAll(".porucs").style("visibility",function(e,t){return M.indexOf(t)>-1||J.indexOf(t)>-1?"hidden":"visible"}),d3.selectAll(".data").style("visibility",function(e,t){return K.indexOf(t)>-1||U.indexOf(t)>-1?"hidden":"visible"});for(var Z=0,et=0;et<fundLink[0].length;et++)"hidden"===fundLink[0][et].style.visibility&&Z++;for(var tt=0,et=0;et<investLink[0].length;et++)"hidden"===investLink[0][et].style.visibility&&tt++;for(var nt=0,et=0;et<porucsLink[0].length;et++)"hidden"===porucsLink[0][et].style.visibility&&nt++;for(var it=0,et=0;et<dataLink[0].length;et++)"hidden"===dataLink[0][et].style.visibility&&it++;Z===fundLink[0].length&&document.getElementById("cb_fund").checked&&(document.getElementById("cb_fund").checked=!1),Z!==fundLink[0].length&&(document.getElementById("cb_fund").checked||(document.getElementById("cb_fund").checked=!0)),tt===investLink[0].length&&document.getElementById("cb_invest").checked&&(document.getElementById("cb_invest").checked=!1),tt!==investLink[0].length&&(document.getElementById("cb_invest").checked||(document.getElementById("cb_invest").checked=!0)),nt===porucsLink[0].length&&document.getElementById("cb_porucs").checked&&(document.getElementById("cb_porucs").checked=!1),nt!==porucsLink[0].length&&(document.getElementById("cb_porucs").checked||(document.getElementById("cb_porucs").checked=!0)),it===dataLink[0].length&&document.getElementById("cb_data").checked&&(document.getElementById("cb_data").checked=!1),it!==dataLink[0].length&&(document.getElementById("cb_data").checked||(document.getElementById("cb_data").checked=!0))}),d3.selectAll("#cb_emp, #cb_numtwit").on("click",function(){document.getElementById("cb_emp").checked&&(node.transition().duration(350).delay(0).attr("r",function(e){return null!==e.numemp?empScale(parseInt(e.numemp)):"7"}),F.attr("transform",function(e){return null!==e.numemp?translateSVG(0,-(empScale(parseInt(e.numemp))+2)):translateSVG(0,-(empScale(parseInt(7))+2))})),document.getElementById("cb_numtwit").checked&&(node.transition().duration(350).delay(0).attr("r",function(e){return null!==e.followers?parseInt(e.followers)>1e6?"50":twitScale(parseInt(e.followers)):"7"}),F.attr("transform",function(e){return null!==e.followers?parseInt(e.followers)>1e6?translateSVG(0,-52):translateSVG(0,-(twitScale(parseInt(e.followers))+2)):translateSVG(0,-(twitScale(parseInt(7))+2))}))}),d3.select("svg").on("contextmenu",function(){d3.event.preventDefault(),L(),d3.selectAll("g").classed("fixed",function(e){e.fixed=!1}),d3.selectAll("g").call(B),centeredNode=jQuery.extend(!0,{},{});d3.layout.force().nodes(filteredNodes).size([width,height]).links(fundingCon.concat(investingCon).concat(porucsCon).concat(dataCon)).linkStrength(0).charge(function(e){return null!==e.numemp?-5*empScale(parseInt(e.numemp)):-50}).on("tick",G).start()}),d3.select("svg").on("click",function(){var e=d3.mouse(this);console.log(e)})});